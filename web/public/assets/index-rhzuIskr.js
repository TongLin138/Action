var Ne=Object.defineProperty,Ve=Object.defineProperties;var Me=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var Pe=Object.prototype.hasOwnProperty,We=Object.prototype.propertyIsEnumerable;var te=(g,u,s)=>u in g?Ne(g,u,{enumerable:!0,configurable:!0,writable:!0,value:s}):g[u]=s,ne=(g,u)=>{for(var s in u||(u={}))Pe.call(u,s)&&te(g,s,u[s]);if(ee)for(var s of ee(u))We.call(u,s)&&te(g,s,u[s]);return g},oe=(g,u)=>Ve(g,Me(u));var R=(g,u,s)=>new Promise((d,B)=>{var I=h=>{try{m(s.next(h))}catch(S){B(S)}},k=h=>{try{m(s.throw(h))}catch(S){B(S)}},m=h=>h.done?d(h.value):Promise.resolve(h.value).then(I,k);m((s=s.apply(g,u)).next())});import{_ as De}from"./PageWrapper.vue_vue_type_style_index_0_lang-6T7-K44R.js";import{a7 as p,aJ as L,at as O,bW as Fe,H as He,y as v,bX as Ue,aL as je,aG as Ae,aM as Ke,a8 as y,a9 as l,aa as o,u as n,aE as le,av as Oe,aZ as Ze,aO as C,aI as x,ax as ae,aD as A,am as K,aN as Ge,aC as Je,aT as Qe,bY as Xe,an as Ye,aK as qe,bZ as et,b_ as tt,b$ as nt,bo as ot,aQ as lt,c0 as at,A as se,bx as ie,ay as st,as as re,ar as ce,c1 as it,aS as rt,bR as ct,c2 as ut,c3 as pt}from"./vendor-88CfsZ0h.js";import{c as dt,a as _t,_ as gt,d as mt}from"./index-4T0Diq52.js";import{g as ft,f as vt,s as yt,_ as ht}from"./socket-Ah8mcQrd.js";import{I as $}from"./Icon-XSH1pAjx.js";import{_ as kt}from"./index.vue_vue_type_style_index_0_lang-Vehg2Vgv.js";import bt from"./selectFile-DPXQ8LhR.js";import{u as wt}from"./useAppInject-419hDAFb.js";import{u as xt}from"./useTransition-CU7qKViR.js";import{s as $t,a as zt}from"./file-6QBU7p8s.js";import"./sharp-arrow-back-ios-T556WsKB.js";import"./useDesign-cMq_xBj1.js";import"./propTypes-XBNzJcxe.js";import"./search2-line-EAu5Rnuh.js";import"./index-sCtJ7cRV.js";import"./folderEmpty-hFJ4452i.js";import"./filePrefix-zdbXtU1-.js";const Ct={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Rt=O("path",{fill:"currentColor",d:"M13 19.3v-6.7l6-3.4V13c.7 0 1.4.1 2 .4V7.5c0-.4-.2-.7-.5-.9l-7.9-4.4c-.2-.1-.4-.2-.6-.2s-.4.1-.6.2L3.5 6.6c-.3.2-.5.5-.5.9v9c0 .4.2.7.5.9l7.9 4.4c.2.1.4.2.6.2s.4-.1.6-.2l.9-.5c-.3-.6-.4-1.3-.5-2M12 4.2l6 3.3l-2 1.1l-5.9-3.4zm-1 15.1l-6-3.4V9.2l6 3.4zm1-8.5L6 7.5l2-1.2l6 3.5zm8 4.2v3h3v2h-3v3h-2v-3h-3v-2h3v-3z"},null,-1),St=[Rt];function Tt(g,u){return p(),L("svg",Ct,[...St])}const Et={name:"mdi-package-variant-closed-plus",render:Tt},Lt={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Bt=O("path",{fill:"currentColor",d:"M8.27 3L3 8.27v7.46L8.27 21h7.46C17.5 19.24 21 15.73 21 15.73V8.27L15.73 3M9.1 5h5.8L19 9.1v5.8L14.9 19H9.1L5 14.9V9.1m6 5.9h2v2h-2zm0-8h2v6h-2z"},null,-1),It=[Bt];function Nt(g,u){return p(),L("svg",Lt,[...It])}const Vt={name:"mdi-alert-octagon-outline",render:Nt},Mt={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Pt=Fe('<g stroke="currentColor"><circle cx="12" cy="12" r="9.5" fill="none" stroke-linecap="round" stroke-width="3"><animate attributeName="stroke-dasharray" calcMode="spline" dur="1.5s" keySplines="0.42,0,0.58,1;0.42,0,0.58,1;0.42,0,0.58,1" keyTimes="0;0.475;0.95;1" repeatCount="indefinite" values="0 150;42 150;42 150;42 150"></animate><animate attributeName="stroke-dashoffset" calcMode="spline" dur="1.5s" keySplines="0.42,0,0.58,1;0.42,0,0.58,1;0.42,0,0.58,1" keyTimes="0;0.475;0.95;1" repeatCount="indefinite" values="0;-16;-59;-59"></animate></circle><animateTransform attributeName="transform" dur="2s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"></animateTransform></g>',1),Wt=[Pt];function Dt(g,u){return p(),L("svg",Mt,[...Wt])}const Ft={name:"svg-spinners-ring-resize",render:Dt},Ht={key:1},Ut=He({__name:"index",setup(g){const{message:u}=dt(),{getIsMobile:s}=wt(),{t:d}=_t(),B=v("fade-slide");xt(B);const I=v(),k=v({}),m=v({});let h=null;const S=v(""),N=v(!s.value),V=v(s.value?"on":"off"),D=v(!1),T=v(s.value?13:15),f=v([]),w=v({}),z=v(""),M=v(!1),_=v(null),P=t=>R(this,null,function*(){switch(t){case"findBox":D.value=!D.value;break;case"wordWrap":V.value=V.value==="on"?"off":"on";break;case"minimap":N.value=!N.value;break;case"showEditorShortcutsInfo":n(k.value)[`editor-${_.value.key}`].showShortCuts();break}}),ue=t=>{switch(t.item.label){case"1":ke();break}},Z=()=>R(this,null,function*(){var t;try{(t=I.value)==null||t.open()}catch(e){}}),pe=t=>{if(!_.value)return;const e=_.value.key;t!==e&&(w.value[e].content=n(k.value)[`editor-${e}`].getValue())},F=t=>{f.value.forEach(e=>{e.key===t&&(e.log.runEnd&&!e.log.isRunning&&(e.log.runEnd=!1),e.log.hasNew=!1,z.value=t,_.value=e,delete _.value.children)}),setTimeout(he,800)},de=t=>{f.value.forEach((e,r)=>{e.key===t&&(f.value.splice(r,1),delete w.value[e.key],delete k.value[`editor-${e.key}`],f.value.length>0?z.value===t&&F(f.value[f.value.length-1].key):(Q("content"),J(e.key)))})},_e=t=>{pe(t),F(t)},ge=t=>{de(t.value)},me=()=>K($,{size:24,icon:_.value.log.isRunning?"mdi:bug-stop-outline":"mdi:bug-play-outline",style:"margin-top: 4px"},{}),fe=()=>K($,{size:24,icon:"tabler:settings-code",style:"margin-top: 4px"},{}),ve=()=>K($,{size:20,icon:"mdi:application-cog-outline",style:"margin-top: 6px"},{}),ye=t=>R(this,null,function*(){f.value.find(r=>r.key===t.key)||(yield be(t.key,t.language),f.value.push(oe(ne({},t),{log:{content:"",newContent:"",id:"",runEnd:!1,isRunning:!1,hasNew:!1,env:[],option:[],isLogReachBottom:!0}}))),F(t.key)}),he=()=>{se().then(()=>{var e,r;const t=_.value;if(m.value&&m.value[`log-${t.key}`]&&((e=m.value[`log-${t.key}`].scrollbarRef)!=null&&e.containerRef)){const i=(r=m.value[`log-${t.key}`].scrollbarRef)==null?void 0:r.containerRef;i.removeEventListener("scroll",G),i.addEventListener("scroll",G)}})},G=Ue(t=>{const e=_.value;if(m.value&&m.value[`log-${e.key}`]){const r=m.value[`log-${e.key}`].$el.clientHeight,i=t.target.scrollTop,c=t.target.scrollHeight;e.log.isLogReachBottom=r+i>=c-10}},500),ke=()=>R(this,null,function*(){const t=_.value;let e;if(t.log.isRunning)e=`task stop ${t.key}`,yield yt({path:t.key}),t.log.isRunning=!1;else{e=`task run ${t.key}`;const r=t.log.option.filter(c=>c.key).map(c=>c.value?`${c.key} ${c.value}`:`${c.key}`).join(" ");r&&(e=`${e} ${r}`),e=`${e} --no-log`;const i=t.log.env.filter(c=>c.key).map(c=>`envm edit ${c.key} ${c.value||"''"}`).join(" ; ");i&&(e=`${i} >/dev/null 2>&1 ; ${e}`);try{const c=t.key,W=n(k.value)[`editor-${t.key}`].getValue();yield $t({content:W,path:c}),w.value[c]&&(w.value[c].content=W),t.log.content="",t.log.isRunning=!0,t.log.id=yield vt({cmd:e}),t.log.runEnd=!0}catch(c){}finally{}}}),be=(t,e)=>R(this,null,function*(){S.value=e||"plaintext",M.value=!0;try{const r=yield zt({path:encodeURI(t)});M.value=!1,r?w.value[t]={content:r,language:e}:(w.value[t]={content:"",language:e},u.info(d("page.script.fileContentIsEmptyMsg")))}catch(r){Q("content")}finally{M.value=!1}}),J=t=>{k.value[`editor-${t}`]&&(k.value[`editor-${t}`].dispose(),delete n(k.value)[`editor-${t}`])},Q=t=>{switch(t){case"content":_.value=null,z.value="";break}};return je(()=>{h=ft(),h==null||h.off("runLog").on("runLog",({code:t,result:e={}})=>{const r=_.value;!r||!r.log||(f.value.forEach(i=>{e.runId===i.log.id&&(i.log.content+=e.log||"",i.log.isRunning=!!t,e.over&&(i.log.isRunning=!1,i.log.id=""),i.key!==r.key&&(i.log.hasNew=!0))}),Ae(()=>{const i=_.value;i.log.content&&se().then(()=>{i.log.isLogReachBottom&&m.value&&m.value[`log-${i.key}`]&&m.value[`log-${i.key}`].scrollTo({position:"bottom",silent:!0})})}))})}),Ke(()=>{f.value.length>0&&J(f.value[0].key)}),(t,e)=>{const r=Ft,i=Ge,c=ht,W=it,b=Je,we=rt,xe=gt,$e=ct,ze=Vt,X=Qe,Ce=ut,Re=pt,Se=Xe,Te=Et,E=Ye,H=qe,U=et,Y=tt,q=nt,Ee=ot,Le=lt,Be=at,Ie=De;return p(),y(Ie,{ref:"pageWrapper","content-full":"","no-header":""},{default:l(()=>[o(H,{bordered:!n(s),class:"tab-panel",style:{height:"100%","word-break":"unset"},"content-style":"padding: 0; height: 100%"},{default:l(()=>[n(f).length>0?(p(),y(Se,{key:0,value:n(z),"onUpdate:value":e[0]||(e[0]=a=>le(z)?z.value=a:null),"drag-sort":"",style:{height:"100%",width:"100%",display:"flex","flex-direction":"column"},theme:"card",addable:n(f).length>0,onChange:_e,onAdd:e[1]||(e[1]=a=>Z()),onRemove:ge},{default:l(()=>[(p(!0),L(Ze,null,Oe(n(f),a=>(p(),y(Re,{key:a.key,value:a.key,removable:"",style:{height:"100%",width:"100%",padding:"0"},"destroy-on-hide":!1},{label:l(()=>[n(s)?(p(),y(b,{key:1,style:{gap:"4px"}},{default:l(()=>[o(i,{size:16},{default:l(()=>[(p(),y(ie(a.icon),{style:{"vertical-align":"-0.3em"}}))]),_:2},1024),C(" "+x(a.label),1)]),_:2},1024)):(p(),y(we,{key:0,placement:"top",trigger:"hover",delay:1e3},{trigger:l(()=>[o(b,{style:{gap:"4px"}},{default:l(()=>[a.log.isRunning?(p(),y(i,{key:0,size:16},{default:l(()=>[o(r,{style:{"vertical-align":"-0.3em"}})]),_:1})):(p(),L("div",Ht,[a.log.runEnd?(p(),y(i,{key:0,size:16},{default:l(()=>[o(c,{style:{color:"var(--app-success-color)","vertical-align":"-0.3em"}})]),_:1})):(p(),y(i,{key:1,size:16},{default:l(()=>[(p(),y(ie(a.icon),{style:{"vertical-align":"-0.3em"}}))]),_:2},1024))])),C(" "+x(a.label)+" ",1),a.log.hasNew?(p(),y(W,{key:2,dot:"",offset:[2,-1]})):A("",!0)]),_:2},1024)]),default:l(()=>[O("span",null,x(a.key),1)]),_:2},1024))]),default:l(()=>[o(st,{name:"fade",mode:"out-in",appear:""},{default:l(()=>[o(Ce,{direction:n(s)?"vertical":"horizontal","default-size":.7,max:1,min:0},{1:l(()=>[o(kt,{ref_for:!0,ref:j=>n(k)[`editor-${a.key}`]=j,style:{height:"100%",padding:"0","z-index":"999999"},value:{content:n(w)[a.key].content,language:n(w)[a.key].language},"word-wrap":n(V),minimap:n(N),"font-size":n(T),"find-box":n(D)},null,8,["value","word-wrap","minimap","font-size","find-box"]),o(xe,{show:n(M)},null,8,["show"])]),2:l(()=>[ce(o($e,{ref_for:!0,ref:j=>n(m)[`log-${a.key}`]=j,log:a.log.content,"font-size":n(T),"line-height":1.5,language:"naive-log",style:ae({padding:n(s)?"1em 0.6em":"1em 0 1em 1.6em",width:"100%",height:"100%"})},null,8,["log","font-size","style"]),[[re,a.log.content]]),ce(o(X,{class:"min-h-200px flex-jc-ac h-full",size:"huge","show-description":!0,description:n(d)("page.script.noLog")},{icon:l(()=>[o(i,null,{default:l(()=>[o(ze)]),_:1})]),_:2},1032,["description"]),[[re,!a.log.content]])]),_:2},1032,["direction"])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["value","addable"])):(p(),y(X,{key:1,class:"min-h-200px flex-jc-ac h-full",size:"huge","show-icon":!1,"show-description":!1},{extra:l(()=>[o(E,{block:"",strong:"",size:"large",type:"primary",secondary:"",focusable:!1,style:{"border-radius":"6px",height:"160px",width:"160px"},onClick:e[2]||(e[2]=a=>Z())},{default:l(()=>[o(b,{vertical:"",style:{gap:"20px"}},{default:l(()=>[o(i,{size:60},{default:l(()=>[o(Te,{style:{"vertical-align":"baseline"}})]),_:1}),C(" "+x(n(d)("page.script.createWorkspace")),1)]),_:1})]),_:1})]),_:1}))]),_:1},8,["bordered"]),n(z)?(p(),y(Be,{key:0,class:"sticky-tool",type:"compact",shape:"round",style:ae(n(s)?"right: 14px; bottom: 14px":"right: 24px; bottom: 24px"),"on-click":ue},{default:l(()=>[o(U,{icon:me,label:"1",popup:n(_).log.isRunning?n(d)("page.script.stopBtn"):n(d)("page.script.runBtn")},null,8,["popup"]),o(U,{icon:fe,label:"2","popup-props":{trigger:n(s)?"click":"hover",placement:n(s)?"top":"left-bottom",overlayInnerStyle:{padding:"0"}}},{popup:l(()=>[o(H,{bordered:!1,style:{width:"100%",height:"100%"},"content-style":"width: 100%; height: 100%; padding: 12px"},{default:l(()=>[o(Ee,{type:"segment",style:{"min-width":"260px"},animated:""},{default:l(()=>[o(q,{name:"1",tab:n(d)("page.script.optionConfig")},{default:l(()=>[o(Y,{value:n(_).log.option,"onUpdate:value":e[3]||(e[3]=a=>n(_).log.option=a),preset:"pair","show-sort-button":"","key-placeholder":n(d)("file.run.paramKeyPlaceholder"),"value-placeholder":n(d)("file.run.paramValuePlaceholder")},null,8,["value","key-placeholder","value-placeholder"])]),_:1},8,["tab"]),o(q,{name:"2",tab:n(d)("page.script.envConfig")},{default:l(()=>[o(Y,{value:n(_).log.env,"onUpdate:value":e[4]||(e[4]=a=>n(_).log.env=a),preset:"pair","show-sort-button":"","key-placeholder":n(d)("file.run.paramKeyPlaceholder"),"value-placeholder":n(d)("file.run.paramValuePlaceholder")},null,8,["value","key-placeholder","value-placeholder"])]),_:1},8,["tab"])]),_:1})]),_:1})]),_:1},8,["popup-props"]),o(U,{icon:ve,label:"3","popup-props":{trigger:n(s)?"click":"hover",placement:"left-bottom",overlayInnerStyle:{padding:"0"}}},{popup:l(()=>[o(H,{bordered:!1,style:{width:"100%",height:"100%"},"content-style":"width: 100%; height: 100%; padding: 8px"},{default:l(()=>[o(b,{vertical:"",style:{width:"100%"}},{default:l(()=>[o(b,{size:"small"},{default:l(()=>[o($,{size:20,icon:"ri:font-size",style:{"vertical-align":"-0.4em"}}),o(Le,{value:n(T),"onUpdate:value":e[5]||(e[5]=a=>le(T)?T.value=a:null),min:12,max:40,"button-placement":"both",size:"small",class:"max-w-94px",style:{"text-align":"center"}},null,8,["value"])]),_:1}),o(b,{size:"small"},{default:l(()=>[o($,{size:20,icon:"mdi:find-replace",style:{"vertical-align":"-0.4em"}}),o(E,{size:"small",strong:"",tertiary:"",style:{width:"94px"},onClick:e[6]||(e[6]=a=>P("findBox"))},{default:l(()=>[C(x(n(d)("editor.switch.findBtn")),1)]),_:1})]),_:1}),o(b,{size:"small"},{default:l(()=>[o($,{size:20,color:n(V)==="on"?"var(--app-primary-color)":void 0,icon:"ant-design:swap-outlined",style:{"vertical-align":"-0.4em"}},null,8,["color"]),o(E,{size:"small",strong:"",tertiary:"",style:{width:"94px"},onClick:e[7]||(e[7]=a=>P("wordWrap"))},{default:l(()=>[C(x(n(d)("editor.switch.wordWrapBtn")),1)]),_:1})]),_:1}),o(b,{size:"small"},{default:l(()=>[o($,{size:20,color:n(N)?"var(--app-primary-color)":void 0,icon:"mdi:map-outline",style:{"vertical-align":"-0.4em"}},null,8,["color"]),o(E,{size:"small",strong:"",tertiary:"",style:{width:"94px"},onClick:e[8]||(e[8]=a=>P("minimap"))},{default:l(()=>[C(x(n(d)("editor.switch.minimapBtn")),1)]),_:1})]),_:1}),n(s)?A("",!0):(p(),y(b,{key:0,size:"small"},{default:l(()=>[o($,{size:20,icon:"gg:shortcut",style:{"vertical-align":"-0.4em"}}),o(E,{size:"small",strong:"",tertiary:"",style:{width:"94px"},onClick:e[9]||(e[9]=a=>P("showEditorShortcutsInfo"))},{default:l(()=>[C(x(n(d)("editor.switch.viewShortcuts")),1)]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1},8,["popup-props"])]),_:1},8,["style"])):A("",!0),o(bt,{ref_key:"selectFileComponent",ref:I,onOnConfirmSelect:ye},null,512)]),_:1},512)}}}),rn=mt(Ut,[["__scopeId","data-v-fcae1569"]]);export{rn as default};
