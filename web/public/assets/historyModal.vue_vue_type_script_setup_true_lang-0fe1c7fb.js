import{c as $,_ as F}from"./index-35fc6cad.js";import{_ as L}from"./history-a2e47617.js";import{c as j,b as A}from"./index-a28ae7ef.js";import{u as E}from"./useAppInject-bfcb44f9.js";import{j as G,a as H}from"./file-b1173af7.js";import J from"./loading-8da2d8e0.js";import{G as O,x as P,r as T,I as U,a6 as o,a7 as s,a8 as n,ac as p,u as e,aJ as b,aL as N,aC as y,aD as I,aG as q,as as K,aw as v,aE as Q,am as W,aS as X,aN as Y,bD as Z,bf as ee,bH as ne,bu as oe}from"./vendor-605eddea.js";const te={key:1},ue=O({__name:"historyModal",setup(se,{expose:C}){const{message:u}=j(),{t:c}=A(),{getIsMobile:i}=E(),D=P(null),a=T({show:!1,loading:!0,log:""}),{show:g,loading:_,log:k}=U(a),B=async l=>{a.log="",a.loading=!0,a.show=!0;try{a.log=await S(l.logPath,l.running_status)}finally{a.loading=!1}},S=async(l,r)=>{const t=await G(l);if(t.children&&t.children.length){t.children.sort((d,f)=>{const h=d.name.replace(".log","").replace(/-/g,"");return f.name.replace(".log","").replace(/-/g,"")-h});const m=r&&t.children[1]?t.children[1]:t.children[0];return await H({path:m.path})}return u.warning(c("cron.task.message.no_latest_log")),""},z=()=>{$(a.log)?u.success(c("common.copyOk")):u.error(c("common.copyFail"))};return C({open:B}),(l,r)=>{const t=L,m=F,w=W,d=X,f=Y,h=Z,x=ee,M=ne,R=oe;return o(),s(R,{show:e(g),"onUpdate:show":r[0]||(r[0]=V=>Q(g)?g.value=V:null),preset:"dialog","auto-focus":!1,style:v({width:e(i)?"100vw":"600px",padding:e(i)?"16px":""})},{icon:n(()=>[p(e(b),null,{default:n(()=>[e(_)?(o(),s(J,{key:0})):(o(),s(t,{key:1,style:{"vertical-align":"0"}}))]),_:1})]),header:n(()=>[p(f,null,{default:n(()=>[N(y(e(c)("cron.task.history"))+" ",1),e(_)?I("",!0):(o(),s(d,{key:0,trigger:"hover"},{trigger:n(()=>[e(_)?I("",!0):(o(),s(w,{key:0,text:"",size:"tiny",type:"primary",focusable:!1,onClick:z},{icon:n(()=>[p(e(b),null,{default:n(()=>[p(m)]),_:1})]),_:1}))]),default:n(()=>[q("span",null,y(e(c)("cron.task.scriptModal.copyBtn")),1)]),_:1}))]),_:1})]),default:n(()=>[e(_)?(o(),s(h,{key:0,text:"",repeat:27,height:"16px"})):(o(),K("div",te,[e(k)?(o(),s(M,{key:1,ref_key:"logInstRef",ref:D,log:e(k),"line-height":1.5,"font-size":e(i)?14:15,language:"naive-log",style:v(`padding-top: 1em; width: 100%; height: ${e(i)?"650px":"600px"}`)},null,8,["log","line-height","font-size","style"])):(o(),s(x,{key:0},{default:n(()=>[N(y(e(c)("common.noData")),1)]),_:1}))]))]),_:1},8,["show","style"])}}});export{ue as _};
