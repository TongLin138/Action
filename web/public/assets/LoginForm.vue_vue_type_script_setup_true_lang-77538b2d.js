import{a6 as b,aH as C,as as p,x as d,h as f,u as e,c1 as P,G as ee,r as te,C as ne,aL as oe,aq as ae,ar as se,a9 as o,a8 as a,a7 as re,aN as x,aI as v,aJ as ce,aD as le,am as $,bn as ie,t as ue,al as S,c2 as de,aB as pe,a$ as me,bG as _e,c3 as ge,aR as he,aW as fe,aC as ye,bH as we}from"./vendor-339b2486.js";import{a as q,x as ve,c as be,y as ke,T as D,z as xe}from"./index-b98e63e9.js";import Se from"./lastLogin-ab8fcda0.js";const Ce={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Le=p("g",{fill:"currentColor"},[p("path",{d:"M12 1.932l9 3.375V10c0 4.118-1.62 7.113-3.535 9.074a11.407 11.407 0 0 1-2.915 2.175c-.913.468-1.826.751-2.55.751c-.724 0-1.637-.283-2.55-.75a11.41 11.41 0 0 1-2.915-2.176C4.619 17.113 3 14.118 3 10V5.307l9-3.375zM5 6.693V10c0 3.549 1.38 6.054 2.965 7.676a9.411 9.411 0 0 0 2.397 1.793c.775.397 1.362.531 1.638.531c.276 0 .863-.134 1.638-.53a9.412 9.412 0 0 0 2.397-1.794C17.619 16.054 19 13.55 19 10V6.693l-7-2.625l-7 2.625z"}),p("path",{d:"M15.707 9.293a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 1 1 1.414-1.414L11 12.586l3.293-3.293a1 1 0 0 1 1.414 0z"})],-1),Re=[Le];function Ie(n,c){return b(),C("svg",Ce,[...Re])}const ze={name:"majesticons-shield-check-line",render:Ie},$e={style:{display:"inline-block"},viewBox:"0 0 1024 1024",width:"1em",height:"1em"},Te=p("path",{fill:"currentColor",d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 1 0-56 0z"},null,-1),Me=[Te];function Ve(n,c){return b(),C("svg",$e,[...Me])}const Fe={name:"ant-design-lock-outlined",render:Ve},Ue={style:{display:"inline-block"},viewBox:"0 0 1024 1024",width:"1em",height:"1em"},He=p("path",{fill:"currentColor",d:"M858.5 763.6a374 374 0 0 0-80.6-119.5a375.63 375.63 0 0 0-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1c-.4.2-.8.3-1.2.5c-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 0 0-80.6 119.5A371.7 371.7 0 0 0 136 901.8a8 8 0 0 0 8 8.2h60c4.4 0 7.9-3.5 8-7.8c2-77.2 33-149.5 87.8-204.3c56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 0 0 8-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"},null,-1),Ae=[He];function Ne(n,c){return b(),C("svg",Ue,[...Ae])}const Be={name:"ant-design-user-outlined",render:Ne},G=""+new URL("logo-light-sub-5072ec6d.png",import.meta.url).href,O=""+new URL("logo-dark-sub-8551aab7.png",import.meta.url).href;var E=(n=>(n[n.LOGIN=0]="LOGIN",n[n.RESET_PASSWORD=1]="RESET_PASSWORD",n))(E||{});const M=d(0);function Pe(){function n(l){M.value=l}const c=f(()=>M.value);function t(){n(0)}return{setLoginState:n,getLoginState:c,handleBackLogin:t}}function De(n){const c=e(n);if(!c)return;const t=P(),l=P();return c.validate(g=>{g?l.trigger(g):t.trigger(g)}),{onSuccess:t.on,onError:l.on}}function Ge(){const{t:n}=q(),c=f(()=>T(n("sys.login.needInputUsername"))),t=f(()=>T(n("sys.login.needInputPassword"))),l=f(()=>T(n("sys.login.needInputCaptcha")));return{getFormRules:f(()=>{const y=e(c),L=e(t),R=e(l);switch(e(M)){case 1:return{username:y};default:return{captcha:R,username:y,password:L}}})}}function T(n){return[{required:!0,message:n,trigger:"change"}]}const Oe=["src"],We=ee({__name:"LoginForm",setup(n){const{apiUrl:c=""}=ve(),{t}=q(),{notification:l,dialog:g,message:y}=be(),L=ke(),{getLoginState:R}=Pe(),{getFormRules:j}=Ge(),K=f(()=>e(R)===E.LOGIN),V=d(),i=d(!1),I=d(!0),k=d(!1),F=d(),r=te({username:"",password:"",captcha:""}),z=d(document.querySelector('meta[name="theme-mode"]').content),U=d(z.value===D.LIGHT?G:O);new MutationObserver(u=>{for(const s of u)s.type==="attributes"&&s.attributeName==="content"&&(z.value=s.target.content)}).observe(document.querySelector('meta[name="theme-mode"]'),{attributes:!0}),ne(z,u=>{U.value=u===D.LIGHT?G:O}),oe(async()=>{await H()});async function H(){const u=await xe();k.value=u.showCaptcha,k&&A()}function A(){F.value=`${c}/captcha?w=120&h=30&t=${new Date().getTime()}`}async function N(){if(!r.username||!r.password){y.error(t("sys.login.needInputAuthentication"),{keepAliveOnHover:!0});return}else if(k.value&&!r.captcha){y.error(t("sys.login.needInputVerification"),{keepAliveOnHover:!0});return}const{onSuccess:u}=De(V);u(async()=>{try{i.value=!0;const s=await L.login(ue({username:r.username,password:r.password,captcha:r.captcha,mode:"none"}));if(s){const{lastLoginInfo:m}=s;m&&m.loginTime&&setTimeout(()=>{const w=l?.create({title:t("sys.login.lastLoginInfoTitle"),content:`${t("sys.login.lastLoginInfoIp")}${m.loginIp||"Unknown"}
${t("sys.login.lastLoginInfoAddress")}${m.loginAddress||"Unknown"}`,meta:m.loginTime||"Unknown",duration:void 0,closable:!1,avatar:()=>S(de,{size:"small",style:"background-color: transparent;"},{default:()=>S(pe,{color:"var(--app-primary-color)",style:"vertical-align: 0"},{default:()=>S(Se)})}),action:()=>S($,{quaternary:!0,type:"primary",size:"small",focusable:!1,onClick:()=>{w.destroy()}},{default:()=>t("sys.login.lastLoginInfoReaded")})})},1300)}}catch(s){g?.error({title:t("sys.login.failTitle"),content:s.message||t("sys.api.networkExceptionMsg"),autoFocus:!1}),await H()}finally{i.value=!1}})}return(u,s)=>{const m=Be,w=me,h=_e,W=Fe,J=ze,Q=ge,B=he,X=fe,Y=ye,Z=we;return ae((b(),C("div",null,[p("img",{src:e(U),title:"Logo",style:{width:"40%",margin:"10px auto","user-drag":"none","-webkit-user-select":"none","user-select":"none"}},null,8,Oe),o(Z,{ref_key:"formRef",ref:V,class:"p-6",model:e(r),rules:e(j),"show-label":!1,"label-placement":"left","show-require-mark":!0,onKeypress:ie(N,["enter"])},{default:a(()=>[o(h,{label:"username",path:"username"},{default:a(()=>[o(w,{value:e(r).username,"onUpdate:value":s[0]||(s[0]=_=>e(r).username=_),size:"large",placeholder:e(t)("sys.login.accountPlaceholder"),disabled:e(i)},{prefix:a(()=>[o(m)]),_:1},8,["value","placeholder","disabled"])]),_:1}),o(h,{label:"password",path:"password"},{default:a(()=>[o(w,{value:e(r).password,"onUpdate:value":s[1]||(s[1]=_=>e(r).password=_),size:"large",type:"password","show-password-on":"click",placeholder:e(t)("sys.login.passwordPlaceholder"),disabled:e(i)},{prefix:a(()=>[o(W)]),_:1},8,["value","placeholder","disabled"])]),_:1}),e(k)?(b(),re(h,{key:0,label:"captcha",path:"captcha"},{default:a(()=>[o(w,{value:e(r).captcha,"onUpdate:value":s[2]||(s[2]=_=>e(r).captcha=_),size:"large",maxlength:"4",type:"text",disabled:e(i),placeholder:e(t)("sys.login.captchaPlaceholder")},{prefix:a(()=>[o(J)]),_:1},8,["value","disabled","placeholder"]),x(" Â  "),o(B,{trigger:"hover",style:{"max-width":"200px"}},{trigger:a(()=>[o(Q,{class:"cursor-pointer",src:e(F),"preview-disabled":!0,style:{"background-color":"#f6f8fa",height:"40px","border-radius":"3px"},onClick:A},null,8,["src"])]),default:a(()=>[p("span",null,v(e(t)("sys.login.captchaTips")),1)]),_:1})]),_:1})):ce("",!0),o(Y,{justify:"space-between"},{default:a(()=>[o(h,{path:"rememberMe"},{default:a(()=>[o(X,{checked:e(I),"onUpdate:checked":s[3]||(s[3]=_=>le(I)?I.value=_:null),size:"small",disabled:e(i)},{default:a(()=>[x(v(e(t)("sys.login.rememberMe")),1)]),_:1},8,["checked","disabled"])]),_:1}),o(h,{class:"text-right"},{default:a(()=>[o(B,{placement:"left",trigger:"hover",style:{"max-width":"200px"}},{trigger:a(()=>[o(e($),{tag:"a",text:"",focusable:!1,size:"small"},{default:a(()=>[x(v(e(t)("sys.login.forgetPassword")),1)]),_:1})]),default:a(()=>[p("span",null,v(e(t)("sys.login.forgetPasswordTips")),1)]),_:1})]),_:1})]),_:1}),o(h,{"show-feedback":!1},{default:a(()=>[o(e($),{type:"primary",size:"large",block:"",focusable:!1,loading:e(i),disabled:e(i),onClick:N},{default:a(()=>[x(v(e(t)("sys.login.loginButton")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model","rules","onKeypress"])],512)),[[se,e(K)]])}}});export{We as _};
