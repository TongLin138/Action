import{a6 as w,as as x,aG as d,x as m,h,u as e,bT as P,G as X,r as J,aI as Q,aq as Y,ar as Z,ac as t,a8 as o,a7 as ee,aL as k,aC as y,aD as ne,aE as se,am as $,bj as te,t as oe,al as ae,b0 as ce,by as le,bU as re,aR as ie,aX as ue,aN as pe,bB as de}from"./vendor-605eddea.js";import{_ as _e}from"./AppLogo.vue_vue_type_style_index_0_lang-a51ffd8f.js";import{b as D,v as ge,c as me,w as he,x as fe}from"./index-bbe7d773.js";const ye={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},we=d("g",{fill:"currentColor"},[d("path",{d:"M12 1.932l9 3.375V10c0 4.118-1.62 7.113-3.535 9.074a11.407 11.407 0 0 1-2.915 2.175c-.913.468-1.826.751-2.55.751c-.724 0-1.637-.283-2.55-.75a11.41 11.41 0 0 1-2.915-2.176C4.619 17.113 3 14.118 3 10V5.307l9-3.375zM5 6.693V10c0 3.549 1.38 6.054 2.965 7.676a9.411 9.411 0 0 0 2.397 1.793c.775.397 1.362.531 1.638.531c.276 0 .863-.134 1.638-.53a9.412 9.412 0 0 0 2.397-1.794C17.619 16.054 19 13.55 19 10V6.693l-7-2.625l-7 2.625z"}),d("path",{d:"M15.707 9.293a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 1 1 1.414-1.414L11 12.586l3.293-3.293a1 1 0 0 1 1.414 0z"})],-1),ve=[we];function be(s,l){return w(),x("svg",ye,ve)}const ke={name:"majesticons-shield-check-line",render:be},xe={style:{display:"inline-block"},viewBox:"0 0 1024 1024",width:"1em",height:"1em"},Ce=d("path",{fill:"currentColor",d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 1 0-56 0z"},null,-1),Re=[Ce];function Se(s,l){return w(),x("svg",xe,Re)}const ze={name:"ant-design-lock-outlined",render:Se},Ie={style:{display:"inline-block"},viewBox:"0 0 1024 1024",width:"1em",height:"1em"},$e=d("path",{fill:"currentColor",d:"M858.5 763.6a374 374 0 0 0-80.6-119.5a375.63 375.63 0 0 0-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1c-.4.2-.8.3-1.2.5c-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 0 0-80.6 119.5A371.7 371.7 0 0 0 136 901.8a8 8 0 0 0 8 8.2h60c4.4 0 7.9-3.5 8-7.8c2-77.2 33-149.5 87.8-204.3c56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 0 0 8-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"},null,-1),Le=[$e];function Ve(s,l){return w(),x("svg",Ie,Le)}const Me={name:"ant-design-user-outlined",render:Ve};var H=(s=>(s[s.LOGIN=0]="LOGIN",s[s.RESET_PASSWORD=1]="RESET_PASSWORD",s))(H||{});const V=m(0);function Ae(){function s(r){V.value=r}const l=h(()=>V.value);function n(){s(0)}return{setLoginState:s,getLoginState:l,handleBackLogin:n}}function Fe(s){const l=e(s);if(!l)return;const n=P(),r=P();return l.validate(_=>{_?r.trigger(_):n.trigger(_)}),{onSuccess:n.on,onError:r.on}}function Ue(){const{t:s}=D(),l=h(()=>L(s("sys.login.needInputUsername"))),n=h(()=>L(s("sys.login.needInputPassword"))),r=h(()=>L(s("sys.login.needInputCaptcha")));return{getFormRules:h(()=>{const f=e(l),C=e(n),R=e(r);switch(e(V)){case 1:return{username:f};default:return{captcha:R,username:f,password:C}}})}}function L(s){return[{required:!0,message:s,trigger:"change"}]}const De=X({__name:"LoginForm",setup(s){const{apiUrl:l=""}=ge(),{t:n}=D(),{notification:r,dialog:_,message:f}=me(),C=he(),{getLoginState:R}=Ae(),{getFormRules:N}=Ue(),M=m(),i=m(!1),S=m(!0),v=m(!1),A=m(),a=J({username:"",password:"",captcha:""});Q(async()=>{await F()});const O=h(()=>e(R)===H.LOGIN);async function F(){const b=await fe();v.value=b.showCaptcha,v&&U()}function U(){A.value=`${l}/captcha?w=120&h=30&t=${new Date().getTime()}`}async function T(){if(!a.username||!a.password){f.warning(n("sys.login.needInputAuthentication"),{keepAliveOnHover:!0});return}else if(v.value&&!a.captcha){f.error(n("sys.login.needInputVerification"),{keepAliveOnHover:!0});return}const{onSuccess:b}=Fe(M);b(async()=>{try{i.value=!0;const c=await C.login(oe({username:a.username,password:a.password,captcha:a.captcha,mode:"none"}));if(c){const{lastLoginInfo:u}=c;if(u&&u.loginTime){const z=r?.info({title:n("sys.login.lastLoginInfoTitle"),content:`${n("sys.login.lastLoginInfoIp")}${u.loginIp||"Unknown"}
${n("sys.login.lastLoginInfoAddress")}${u.loginAddress||"Unknown"}`,meta:u.loginTime||"Unknown",duration:void 0,closable:!1,action:()=>ae($,{quaternary:!0,type:"primary",size:"small",focusable:!1,onClick:()=>{z.destroy()}},{default:()=>n("sys.login.lastLoginInfoRead")})})}}}catch(c){_?.error({title:n("sys.login.failTitle"),content:c.message||n("sys.api.networkExceptionMsg")}),await F()}finally{i.value=!1}})}return(b,c)=>{const u=_e,z=Me,I=ce,g=le,E=ze,G=ke,j=re,B=ie,q=ue,K=pe,W=de;return Y((w(),x("div",null,[t(u,{class:"justify-center pl-0 mb-6","is-static":"","can-go-home":!1,"logo-size":"32","title-size":"24"}),t(W,{ref_key:"formRef",ref:M,class:"p-4",model:e(a),rules:e(N),"show-label":!1,"label-placement":"left","show-require-mark":!0,onKeypress:te(T,["enter"])},{default:o(()=>[t(g,{label:"username",path:"username"},{default:o(()=>[t(I,{value:e(a).username,"onUpdate:value":c[0]||(c[0]=p=>e(a).username=p),size:"large",placeholder:e(n)("sys.login.accountPlaceholder"),disabled:e(i)},{prefix:o(()=>[t(z)]),_:1},8,["value","placeholder","disabled"])]),_:1}),t(g,{label:"password",path:"password"},{default:o(()=>[t(I,{value:e(a).password,"onUpdate:value":c[1]||(c[1]=p=>e(a).password=p),size:"large",type:"password","show-password-on":"click",placeholder:e(n)("sys.login.passwordPlaceholder"),disabled:e(i)},{prefix:o(()=>[t(E)]),_:1},8,["value","placeholder","disabled"])]),_:1}),e(v)?(w(),ee(g,{key:0,label:"captcha",path:"captcha"},{default:o(()=>[t(I,{value:e(a).captcha,"onUpdate:value":c[2]||(c[2]=p=>e(a).captcha=p),size:"large",maxlength:"4",type:"text",disabled:e(i),placeholder:e(n)("sys.login.captchaPlaceholder")},{prefix:o(()=>[t(G)]),_:1},8,["value","disabled","placeholder"]),k(" Â  "),t(B,{trigger:"hover"},{trigger:o(()=>[t(j,{class:"cursor-pointer",src:e(A),"preview-disabled":!0,style:{"background-color":"#f6f8fa",height:"40px","border-radius":"3px"},onClick:U},null,8,["src"])]),default:o(()=>[d("span",null,y(e(n)("sys.login.captchaTips")),1)]),_:1})]),_:1})):ne("",!0),t(K,{justify:"space-between"},{default:o(()=>[t(g,{path:"rememberMe"},{default:o(()=>[t(q,{checked:e(S),"onUpdate:checked":c[3]||(c[3]=p=>se(S)?S.value=p:null),size:"small",focusable:!1,disabled:e(i)},{default:o(()=>[k(y(e(n)("sys.login.rememberMe")),1)]),_:1},8,["checked","disabled"])]),_:1}),t(g,{class:"text-right"},{default:o(()=>[t(B,{placement:"bottom",trigger:"hover"},{trigger:o(()=>[t(e($),{tag:"a",text:"",type:"primary",focusable:!1,size:"small"},{default:o(()=>[k(y(e(n)("sys.login.forgetPassword")),1)]),_:1})]),default:o(()=>[d("span",null,y(e(n)("sys.login.forgetPasswordTips")),1)]),_:1})]),_:1})]),_:1}),t(g,{"show-feedback":!1},{default:o(()=>[t(e($),{type:"primary",size:"large",block:"",focusable:!1,loading:e(i),disabled:e(i),onClick:T},{default:o(()=>[k(y(e(n)("sys.login.loginButton")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model","rules","onKeypress"])],512)),[[Z,e(O)]])}}});export{De as _};
