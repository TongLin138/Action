var S=(o,r,t)=>new Promise((l,i)=>{var g=u=>{try{h(t.next(u))}catch(k){i(k)}},b=u=>{try{h(t.throw(u))}catch(k){i(k)}},h=u=>u.done?l(u.value):Promise.resolve(u.value).then(g,b);h((t=t.apply(o,r)).next())});import{o as L,p as $,v as _,r as m,j as v,b as K,e,bz as E,d as te,bA as oe,z as ne,bB as se,a4 as ae,T as q,A as re,B as ce,bC as le,ad as ie,ap as ue,a as n,w as s,c as pe,E as I,t as C,q as de,i as me,f as V,aD as _e,a7 as ge,h as z}from"./index-797c0a85.js";import he from"./lastLogin-9fec2de6.js";import{_ as fe}from"./Avatar-c373b8f2.js";import{_ as we}from"./Image-b643de14.js";import{N as ye}from"./Icon-abc31adc.js";import{_ as ve}from"./Input-c8aa899c.js";import{_ as be,a as ke}from"./FormItem-e64e13b9.js";import{a as xe}from"./Tooltip-271e10cc.js";import{_ as Se}from"./Checkbox-007ffc49.js";import{N as Ce}from"./Space-3cb079f3.js";const Le={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Re=_("g",{fill:"currentColor"},[_("path",{d:"M12 1.932l9 3.375V10c0 4.118-1.62 7.113-3.535 9.074a11.407 11.407 0 0 1-2.915 2.175c-.913.468-1.826.751-2.55.751c-.724 0-1.637-.283-2.55-.75a11.41 11.41 0 0 1-2.915-2.176C4.619 17.113 3 14.118 3 10V5.307l9-3.375zM5 6.693V10c0 3.549 1.38 6.054 2.965 7.676a9.411 9.411 0 0 0 2.397 1.793c.775.397 1.362.531 1.638.531c.276 0 .863-.134 1.638-.53a9.412 9.412 0 0 0 2.397-1.794C17.619 16.054 19 13.55 19 10V6.693l-7-2.625l-7 2.625z"}),_("path",{d:"M15.707 9.293a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 1 1 1.414-1.414L11 12.586l3.293-3.293a1 1 0 0 1 1.414 0z"})],-1),Ie=[Re];function ze(o,r){return L(),$("svg",Le,[...Ie])}const $e={name:"majesticons-shield-check-line",render:ze},Te={style:{display:"inline-block"},viewBox:"0 0 1024 1024",width:"1em",height:"1em"},Me=_("path",{fill:"currentColor",d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 1 0-56 0z"},null,-1),Ve=[Me];function Ae(o,r){return L(),$("svg",Te,[...Ve])}const Fe={name:"ant-design-lock-outlined",render:Ae},Ue={style:{display:"inline-block"},viewBox:"0 0 1024 1024",width:"1em",height:"1em"},Ne=_("path",{fill:"currentColor",d:"M858.5 763.6a374 374 0 0 0-80.6-119.5a375.63 375.63 0 0 0-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1c-.4.2-.8.3-1.2.5c-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 0 0-80.6 119.5A371.7 371.7 0 0 0 136 901.8a8 8 0 0 0 8 8.2h60c4.4 0 7.9-3.5 8-7.8c2-77.2 33-149.5 87.8-204.3c56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 0 0 8-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"},null,-1),Be=[Ne];function He(o,r){return L(),$("svg",Ue,[...Be])}const Pe={name:"ant-design-user-outlined",render:He},G=""+new URL("logo-light-sub-5072ec6d.png",import.meta.url).href,j=""+new URL("logo-dark-sub-8551aab7.png",import.meta.url).href;var W=(o=>(o[o.LOGIN=0]="LOGIN",o[o.RESET_PASSWORD=1]="RESET_PASSWORD",o))(W||{});const F=m(0);function De(){function o(l){F.value=l}const r=v(()=>F.value);function t(){o(0)}return{setLoginState:o,getLoginState:r,handleBackLogin:t}}function Oe(o){const r=e(o);if(!r)return;const t=E(),l=E();return r.validate(i=>{i?l.trigger(i):t.trigger(i)}),{onSuccess:t.on,onError:l.on}}function Ee(){const{t:o}=K(),r=v(()=>A(o("sys.login.needInputUsername"))),t=v(()=>A(o("sys.login.needInputPassword"))),l=v(()=>A(o("sys.login.needInputCaptcha")));return{getFormRules:v(()=>{const g=e(r),b=e(t),h=e(l);switch(e(F)){case 1:return{username:g};default:return{captcha:h,username:g,password:b}}})}}function A(o){return[{required:!0,message:o,trigger:"change"}]}const qe=["src"],nt=te({__name:"LoginForm",setup(o){const{apiUrl:r=""}=oe(),{t}=K(),{notification:l,dialog:i,message:g}=ne(),b=se(),{getLoginState:h}=De(),{getFormRules:u}=Ee(),k=v(()=>e(h)===W.LOGIN),U=m(),p=m(!1),T=m(!0),R=m(!1),N=m(),c=ae({username:"",password:"",captcha:""}),M=m(document.querySelector('meta[name="theme-mode"]').content),B=m(M.value===q.LIGHT?G:j);new MutationObserver(d=>{for(const a of d)a.type==="attributes"&&a.attributeName==="content"&&(M.value=a.target.content)}).observe(document.querySelector('meta[name="theme-mode"]'),{attributes:!0}),re(M,d=>{B.value=d===q.LIGHT?G:j}),ce(()=>S(this,null,function*(){yield H()}));function H(){return S(this,null,function*(){const d=yield le();R.value=d.showCaptcha,R&&P()})}function P(){N.value=`${r}/captcha?w=120&h=30&t=${new Date().getTime()}`}function D(){return S(this,null,function*(){if(!c.username||!c.password){g.error(t("sys.login.needInputAuthentication"),{keepAliveOnHover:!0});return}else if(R.value&&!c.captcha){g.error(t("sys.login.needInputVerification"),{keepAliveOnHover:!0});return}const{onSuccess:d}=Oe(U);d(()=>S(this,null,function*(){try{p.value=!0;const a=yield b.login(ge({username:c.username,password:c.password,captcha:c.captcha,mode:"none"}));if(a){const{lastLoginInfo:f}=a;f&&f.loginTime&&setTimeout(()=>{const x=l==null?void 0:l.create({title:t("sys.login.lastLoginInfoTitle"),content:`${t("sys.login.lastLoginInfoIp")}${f.loginIp||"Unknown"}
${t("sys.login.lastLoginInfoAddress")}${f.loginAddress||"Unknown"}`,meta:f.loginTime||"Unknown",duration:void 0,closable:!1,avatar:()=>z(fe,{size:"small",style:"background-color: transparent;"},{default:()=>z(ye,{color:"var(--app-primary-color)",style:"vertical-align: 0"},{default:()=>z(he)})}),action:()=>z(V,{quaternary:!0,type:"primary",size:"small",focusable:!1,onClick:()=>{x.destroy()}},{default:()=>t("sys.login.lastLoginInfoReaded")})})},1300)}}catch(a){i==null||i.error({title:t("sys.login.failTitle"),content:a.message||t("sys.api.networkExceptionMsg"),autoFocus:!1}),yield H()}finally{p.value=!1}}))})}return(d,a)=>{const f=Pe,x=ve,y=be,J=Fe,Q=$e,X=we,O=xe,Y=Se,Z=Ce,ee=ke;return ie((L(),$("div",null,[_("img",{src:e(B),title:"Logo",style:{width:"40%",margin:"10px auto","user-drag":"none","-webkit-user-select":"none","user-select":"none"}},null,8,qe),n(ee,{ref_key:"formRef",ref:U,class:"p-6",model:e(c),rules:e(u),"show-label":!1,"label-placement":"left","show-require-mark":!0,onKeypress:_e(D,["enter"])},{default:s(()=>[n(y,{label:"username",path:"username"},{default:s(()=>[n(x,{value:e(c).username,"onUpdate:value":a[0]||(a[0]=w=>e(c).username=w),size:"large",placeholder:e(t)("sys.login.accountPlaceholder"),disabled:e(p)},{prefix:s(()=>[n(f)]),_:1},8,["value","placeholder","disabled"])]),_:1}),n(y,{label:"password",path:"password"},{default:s(()=>[n(x,{value:e(c).password,"onUpdate:value":a[1]||(a[1]=w=>e(c).password=w),size:"large",type:"password","show-password-on":"click",placeholder:e(t)("sys.login.passwordPlaceholder"),disabled:e(p)},{prefix:s(()=>[n(J)]),_:1},8,["value","placeholder","disabled"])]),_:1}),e(R)?(L(),pe(y,{key:0,label:"captcha",path:"captcha"},{default:s(()=>[n(x,{value:e(c).captcha,"onUpdate:value":a[2]||(a[2]=w=>e(c).captcha=w),size:"large",maxlength:"4",type:"text",disabled:e(p),placeholder:e(t)("sys.login.captchaPlaceholder")},{prefix:s(()=>[n(Q)]),_:1},8,["value","disabled","placeholder"]),I(" Â  "),n(O,{trigger:"hover",style:{"max-width":"200px"}},{trigger:s(()=>[n(X,{class:"cursor-pointer",src:e(N),"preview-disabled":!0,style:{"background-color":"#f6f8fa",height:"40px","border-radius":"3px"},onClick:P},null,8,["src"])]),default:s(()=>[_("span",null,C(e(t)("sys.login.captchaTips")),1)]),_:1})]),_:1})):de("",!0),n(Z,{justify:"space-between"},{default:s(()=>[n(y,{path:"rememberMe"},{default:s(()=>[n(Y,{checked:e(T),"onUpdate:checked":a[3]||(a[3]=w=>me(T)?T.value=w:null),size:"small",disabled:e(p)},{default:s(()=>[I(C(e(t)("sys.login.rememberMe")),1)]),_:1},8,["checked","disabled"])]),_:1}),n(y,{class:"text-right"},{default:s(()=>[n(O,{placement:"left",trigger:"hover",style:{"max-width":"200px"}},{trigger:s(()=>[n(e(V),{tag:"a",text:"",focusable:!1,size:"small"},{default:s(()=>[I(C(e(t)("sys.login.forgetPassword")),1)]),_:1})]),default:s(()=>[_("span",null,C(e(t)("sys.login.forgetPasswordTips")),1)]),_:1})]),_:1})]),_:1}),n(y,{"show-feedback":!1},{default:s(()=>[n(e(V),{type:"primary",size:"large",block:"",focusable:!1,loading:e(p),disabled:e(p),onClick:D},{default:s(()=>[I(C(e(t)("sys.login.loginButton")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model","rules","onKeypress"])],512)),[[ue,e(k)]])}}});export{nt as _};
