var B=(N,$,m)=>new Promise((s,C)=>{var I=r=>{try{v(m.next(r))}catch(u){C(u)}},d=r=>{try{v(m.throw(r))}catch(u){C(u)}},v=r=>r.done?s(r.value):Promise.resolve(r.value).then(I,d);v((m=m.apply(N,$)).next())});import{_ as q,a as K,b as Q}from"./zoom-out-line-wf0aYKcx.js";import{_ as X}from"./content-copy-wxzOstfv.js";import{a7 as l,aJ as Y,at as p,H as Z,y as S,r as ee,J as oe,u as n,a8 as a,a9 as e,aa as o,aO as H,aI as c,aD as O,aE as W,bO as ne,aN as te,an as se,aS as le,bA as ae,aC as re,c4 as ie,bi as ce,bR as _e,bS as ge,bG as pe,bE as ue,bF as fe}from"./vendor--53G7TFY.js";import{I as me}from"./Icon-ieGKZtJF.js";import{c as de,a as ye}from"./index-BeP8DsMB.js";import{u as he}from"./useAppInject-4CezJXac.js";import{b as ve,a as we}from"./file-t38khhI7.js";const be={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},ke=p("path",{fill:"currentColor",d:"M13.5 8H12v5l4.28 2.54l.72-1.21l-3.5-2.08zM13 3a9 9 0 0 0-9 9H1l3.96 4.03L9 12H6a7 7 0 0 1 7-7a7 7 0 0 1 7 7a7 7 0 0 1-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.896 8.896 0 0 0 13 21a9 9 0 0 0 9-9a9 9 0 0 0-9-9"},null,-1),ze=[ke];function xe(N,$){return l(),Y("svg",be,[...ze])}const Ce={name:"mdi-history",render:xe},Ie={style:{"vertical-align":"-5px"}},Te=Z({__name:"viewHistory",setup(N,{expose:$}){const{message:m}=de(),{t:s}=ye(),{getIsMobile:C}=he(),I=S(null),d=S(C.value?13:15),v=S(null),r=ee({show:!1,loading:!0,log:""}),{show:u,loading:k,log:z}=oe(r),J=w=>B(this,null,function*(){r.log="",r.show=!0;try{r.loading=!0,r.log=yield U(w.logPath,w.running_status)}finally{r.loading=!1}}),U=(w,t)=>B(this,null,function*(){try{const i=yield ve({path:w});if(i.children&&i.children.length){i.children.sort((x,f)=>{const y=x.name.replace(".log","").replace(/-/g,"");return f.name.replace(".log","").replace(/-/g,"")-y});const b=t&&i.children[1]?i.children[1]:i.children[0];return yield we({path:b.path})}else m.warning(s("page.cron.viewHistory.noLatestMsg"))}catch(i){}return""}),h=w=>B(this,null,function*(){var t,i,b;switch(w){case"copyContent":ne(r.log)?m.success(s("common.copyOk")):m.error(s("common.copyFail"));break;case"enlarge":d.value<20?d.value+=1:d.value===20&&m.info(s("page.log.enlargeMaxMsg"));break;case"narrow":d.value>12?d.value-=1:d.value===12&&m.info(s("page.log.narrowMinMsg"));break;case"bottom":const x=(i=(t=I.value)==null?void 0:t.$el)==null?void 0:i.clientHeight;(b=v.value)==null||b.scrollTo({top:x,behavior:"smooth"});break}});return $({open:J}),(w,t)=>{const i=me,b=Ce,_=te,x=X,f=se,y=le,R=q,D=K,T=Q,F=ae,M=re,A=ie,L=ce,V=_e,E=ge,j=pe,G=ue,P=fe;return n(C)?(l(),a(P,{key:1,show:n(u),"onUpdate:show":t[10]||(t[10]=g=>W(u)?u.value=g:null),height:"100vh",width:"100vw",placement:"right","auto-focus":!1,"mask-closable":!1},{default:e(()=>[o(G,{closable:"","header-style":"height: 60px; padding: 16px 12px","body-content-style":"padding: 4px 8px; overscroll-behavior: none","footer-style":"padding: 16px 24px"},{header:e(()=>[o(M,null,{default:e(()=>[n(k)?(l(),a(i,{key:0,icon:"svg-spinners:pulse-2",size:28,color:"var(--app-primary-color)",style:{"vertical-align":"0"}})):(l(),a(_,{key:1,size:28,color:"var(--app-primary-color)"},{default:e(()=>[o(b,{style:{"vertical-align":"0"}})]),_:1})),p("span",Ie,c(n(s)("page.cron.table.history")),1),!n(k)&&n(z)?(l(),a(F,{key:2},{default:e(()=>[o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(f,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[5]||(t[5]=g=>h("copyContent"))},{icon:e(()=>[o(_,{size:16},{default:e(()=>[o(x,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[p("span",null,c(n(s)("common.copyBtn")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(f,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[6]||(t[6]=g=>h("narrow"))},{icon:e(()=>[o(_,{size:18},{default:e(()=>[o(R,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[p("span",null,c(n(s)("page.cron.viewHistory.narrowButtonTips")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(f,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[7]||(t[7]=g=>h("enlarge"))},{icon:e(()=>[o(_,{size:18},{default:e(()=>[o(D,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[p("span",null,c(n(s)("page.cron.viewHistory.enlargeButtonTips")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"click"},{trigger:e(()=>[o(f,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[8]||(t[8]=g=>h("bottom"))},{icon:e(()=>[o(_,{size:18},{default:e(()=>[o(T,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[p("span",null,c(n(s)("file.bottom.button")),1)]),_:1})]),_:1})):O("",!0)]),_:1})]),default:e(()=>[n(k)?(l(),a(A,{key:0,text:"",repeat:30,height:"16px"})):(l(),a(E,{key:1,ref_key:"logInstWrapRef",ref:v,"native-scrollbar":!0,style:{width:"100%",height:"100%","background-color":"transparent"}},{default:e(()=>[p("div",null,[n(z)?(l(),a(V,{key:1,ref_key:"logInstRef",ref:I,log:n(z),"line-height":1.5,"font-size":n(d),language:"naive-log",style:{width:"100%",height:"100%"}},null,8,["log","font-size"])):(l(),a(L,{key:0},{default:e(()=>[H(c(n(s)("common.noData")),1)]),_:1}))])]),_:1},512))]),footer:e(()=>[o(M,null,{default:e(()=>[o(f,{type:"primary",focusable:!1,onClick:t[9]||(t[9]=g=>u.value=!1)},{default:e(()=>[H(c(n(s)("component.modal.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])):(l(),a(j,{key:0,show:n(u),"onUpdate:show":t[4]||(t[4]=g=>W(u)?u.value=g:null),preset:"dialog","auto-focus":!1,style:{width:"600px"}},{icon:e(()=>[n(k)?(l(),a(i,{key:0,icon:"svg-spinners:pulse-2",size:24,color:"var(--app-primary-color)",style:{"vertical-align":"0"}})):(l(),a(_,{key:1,size:24},{default:e(()=>[o(b,{style:{"vertical-align":"0"}})]),_:1}))]),header:e(()=>[o(M,null,{default:e(()=>[H(c(n(s)("page.cron.table.history"))+" ",1),!n(k)&&n(z)?(l(),a(F,{key:0},{default:e(()=>[o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(f,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[0]||(t[0]=g=>h("copyContent"))},{icon:e(()=>[o(_,{size:16},{default:e(()=>[o(x,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[p("span",null,c(n(s)("common.copyBtn")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(f,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[1]||(t[1]=g=>h("narrow"))},{icon:e(()=>[o(_,{size:18},{default:e(()=>[o(R,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[p("span",null,c(n(s)("page.cron.viewHistory.narrowButtonTips")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(f,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[2]||(t[2]=g=>h("enlarge"))},{icon:e(()=>[o(_,{size:18},{default:e(()=>[o(D,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[p("span",null,c(n(s)("page.cron.viewHistory.enlargeButtonTips")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(f,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[3]||(t[3]=g=>h("bottom"))},{icon:e(()=>[o(_,{size:18},{default:e(()=>[o(T,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[p("span",null,c(n(s)("file.bottom.button")),1)]),_:1})]),_:1})):O("",!0)]),_:1})]),default:e(()=>[n(k)?(l(),a(A,{key:0,text:"",repeat:27,height:"16px"})):(l(),a(E,{key:1,ref_key:"logInstWrapRef",ref:v,"native-scrollbar":!1,style:{"padding-top":"1em",width:"100%",height:"600px","background-color":"transparent"}},{default:e(()=>[p("div",null,[n(z)?(l(),a(V,{key:1,ref_key:"logInstRef",ref:I,log:n(z),"line-height":1.5,"font-size":n(d),language:"naive-log",style:{width:"100%",height:"100%"}},null,8,["log","font-size"])):(l(),a(L,{key:0},{default:e(()=>[H(c(n(s)("common.noData")),1)]),_:1}))])]),_:1},512))]),_:1},8,["show"]))}}});export{Te as _};
