import{G as X,x as l,C as Y,aI as Z,a6 as f,a7 as _,a8 as t,ac as o,u as e,aE as ee,aK as ae,aG as $,aC as T,aD as L,aL as te,aJ as m,al as i,aM as ne,am as oe,aQ as se,aN as le,aR as ie,aH as re}from"./vendor-b0543d82.js";import{_ as ue}from"./PageWrapper.vue_vue_type_style_index_0_lang-6aa3ce87.js";import{b as ce,c as pe,L as de}from"./index-7ca99342.js";import{s as fe,g as _e,f as W,a as me,e as ge,_ as ve,b as ye,c as he,d as be}from"./folderOpen-f78fffb3.js";import{_ as we,a as ke,f as xe}from"./index-db543441.js";import{_ as Ce}from"./map-outline-c921f3be.js";import{u as Ne}from"./useAppInject-556e31df.js";import{u as Te}from"./useTransition-d423da33.js";import{F as Ee}from"./fileTreeEnum-8c192873.js";import{f as Ie}from"./folderDisable-3564ff46.js";import"./sharp-arrow-back-ios-357f60fd.js";import"./useDesign-94a763ab.js";import"./propTypes-8a448afd.js";const qe=X({__name:"index",setup(Se){const{getIsMobile:g}=Ne(),{t:r}=ce(),{message:E}=pe(),O=l("fade-slide");Te(O);const b=l([]),p=l({}),I=l(),w=l(""),D=l(""),d=l(""),k=l(!g.value),x=l(g.value?"on":"off"),S=l(!1),C=l(!0),F=l(!1),N=async a=>{switch(a){case"wordWrap":x.value=x.value==="on"?"off":"on";break;case"minimap":k.value=!k.value;break;case"showEditorShortcutsInfo":I.value.showShortCuts=!0;break;case"save":S.value=!0;const n=e(I).getValue();try{await fe({content:n,path:p.value.path}),E.success(r("editor.main.savedSuccess"))}finally{S.value=!1,await z()}break}},z=async()=>{F.value=!0;const a=await _e({type:Ee.CONFIG});b.value=j(a),F.value=!1},j=a=>{const n=u=>{u.length&&u.forEach(s=>{if(s.type===0)Object.assign(s,{key:s.path,label:s.title,disabled:!0,prefix:()=>i(m,null,{default:()=>i(W)})}),n(s.children),s.children.length||(Object.assign(s,{children:null,disabled:!0}),s.prefix=()=>i(m,null,{default:()=>i(Ie)}));else{const c=s.name;if(c){const v=c.substring(c.lastIndexOf(".")+1),y=xe[v]||{};Object.assign(s,{key:s.path,label:c,language:y.language||"plaintext",disabled:y.disabled||!1,prefix:()=>i(m,null,{default:()=>i(y.icon||be)})})}}})};return n(a),a},B=(a,n,u)=>{if(u.node)switch(u.action){case"expand":u.node.prefix=()=>i(m,null,{default:()=>i(me)});break;case"collapse":u.node.prefix=()=>i(m,null,{default:()=>i(W)});break}},V=({option:a})=>({onClick(){!a.children&&!a.disabled&&(p.value=a,M(a))}});async function M(a){D.value=a.language,C.value=!0;const n=await ge({path:encodeURI(a.key)});C.value=!1,n?w.value=n:(w.value="",E.info(r("page.editConfig.fileContentIsEmptyMsg")))}function R(){if(b.value.length){for(const a of b.value)if(a.type===1&&a.name==="config.sh")return a}return{}}return Y(d,a=>{a||(p.value={},w.value="")}),Z(async()=>{await z(),p.value=R(),p.value.path?(d.value=p.value.path,M(p.value)):E.error(r("page.editConfig.mainConfigNotExistsMsg"),{keepAliveOnHover:!0}),C.value=!1}),(a,n)=>{const u=ne,s=we,c=oe,v=se,y=Ce,q=ve,P=le,A=ke,G=ye,H=he,U=ie,J=de,K=re,Q=ue;return f(),_(Q,{ref:"pageWrapper","content-full":!0},{title:t(()=>[o(u,{value:e(d),"onUpdate:value":n[0]||(n[0]=h=>ee(d)?d.value=h:null),size:"small",class:"min-w-170px",loading:e(F),"consistent-menu-width":!1,clearable:"","show-path":!0,separator:"/",placeholder:e(r)("page.editConfig.selectConfigFilePlaceholder"),options:e(b),"node-props":V,"on-update:expanded-keys":B},null,8,["value","loading","placeholder","options"])]),extra:t(()=>[e(d)?(f(),_(ae,{key:0,name:e(O),mode:"out-in",appear:""},{default:t(()=>[o(P,{style:{width:"fix-content"}},{default:t(()=>[o(P,{style:{gap:"0"}},{default:t(()=>[e(g)?L("",!0):(f(),_(v,{key:0,placement:"bottom",trigger:"hover",delay:500},{trigger:t(()=>[o(c,{strong:"",quaternary:"",size:"small",type:"tertiary",focusable:!1,onClick:n[1]||(n[1]=h=>N("showEditorShortcutsInfo"))},{default:t(()=>[o(s)]),_:1})]),default:t(()=>[$("span",null,T(e(r)("editor.switch.shortcutsTips")),1)]),_:1})),e(g)?(f(),_(v,{key:1,placement:"bottom",trigger:"hover",delay:500},{trigger:t(()=>[o(c,{strong:"",quaternary:"",type:e(k)?"primary":"tertiary",size:"small",focusable:!1,onClick:n[2]||(n[2]=h=>N("minimap"))},{default:t(()=>[o(y)]),_:1},8,["type"])]),default:t(()=>[$("span",null,T(e(r)("editor.switch.minimapTips")),1)]),_:1})):L("",!0),o(v,{placement:"bottom",trigger:"hover",delay:500},{trigger:t(()=>[o(c,{strong:"",quaternary:"",type:e(x)==="on"?"primary":"tertiary",size:"small",focusable:!1,onClick:n[3]||(n[3]=h=>N("wordWrap"))},{default:t(()=>[o(q)]),_:1},8,["type"])]),default:t(()=>[$("span",null,T(e(r)("editor.switch.wordWrapTips")),1)]),_:1})]),_:1}),o(c,{strong:"",type:"primary",size:"small",loading:e(S),focusable:!1,onClick:n[4]||(n[4]=h=>N("save"))},{icon:t(()=>[o(A)]),default:t(()=>[te(" "+T(e(r)("editor.main.saveButton")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["name"])):L("",!0)]),default:t(()=>[o(K,{bordered:!e(g),style:{height:"100%","word-break":"unset"},"content-style":"padding: 0"},{default:t(()=>[e(d)?(f(),_(G,{key:0,ref_key:"editor",ref:I,value:e(w),language:e(D),"word-wrap":e(x),minimap:e(k)},null,8,["value","language","word-wrap","minimap"])):(f(),_(U,{key:1,class:"min-h-200px flex-jc-ac h-full",size:"huge",description:e(r)("common.selectFileEmptyDesc")},{icon:t(()=>[o(e(m),null,{default:t(()=>[o(H)]),_:1})]),_:1},8,["description"])),o(J,{show:e(C)},null,8,["show"])]),_:1},8,["bordered"])]),_:1},512)}}});export{qe as default};
