import{d as ae,h as v,F as sn,H as be,aW as Mn,aX as jn,N as zn,r as F,cN as ze,j as _,bb as Hn,aY as B,B as qn,b0 as Vn,aV as cn,d9 as Gn,P,R as X,aK as E,da as ln,Q as ve,aL as ye,b2 as Wn,G as Xn,aN as Yn,S as un,db as Qn,k as Re,J as K,A as Fe,V as Jn,c3 as He,aR as Se,I as Zn,cG as on,K as et,an as qe,Z as M}from"./index-797c0a85.js";import{_ as nt}from"./Checkbox-007ffc49.js";import{h as an,c as tt,a as lt,f as rn,_ as it}from"./Empty-aa248199.js";import{u as Oe}from"./Tooltip-271e10cc.js";import{V as ot}from"./FocusDetector-effeeed3.js";function fn(e){return typeof e=="string"?`s-${e}`:`n-${e}`}const at=ae({name:"Switcher",render(){return v("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},v("path",{d:"M12 8l10 8l-10 8z"}))}}),hn=sn("n-tree-select"),Ce=sn("n-tree"),rt=ae({name:"NTreeSwitcher",props:{clsPrefix:{type:String,required:!0},indent:{type:Number,required:!0},expanded:Boolean,selected:Boolean,hide:Boolean,loading:Boolean,onClick:Function,tmNode:{type:Object,required:!0}},setup(e){const{renderSwitcherIconRef:l}=be(Ce,null);return()=>{const{clsPrefix:c,expanded:u,hide:s,indent:a,onClick:b}=e;return v("span",{"data-switcher":!0,class:[`${c}-tree-node-switcher`,u&&`${c}-tree-node-switcher--expanded`,s&&`${c}-tree-node-switcher--hide`],style:{width:`${a}px`},onClick:b},v("div",{class:`${c}-tree-node-switcher__icon`},v(Mn,null,{default:()=>{if(e.loading)return v(jn,{clsPrefix:c,key:"loading",radius:85,strokeWidth:20});const{value:k}=l;return k?k({expanded:e.expanded,selected:e.selected,option:e.tmNode.rawNode}):v(zn,{clsPrefix:c,key:"switcher"},{default:()=>v(at,null)})}})))}}}),dt=ae({name:"NTreeNodeCheckbox",props:{clsPrefix:{type:String,required:!0},indent:{type:Number,required:!0},right:Boolean,focusable:Boolean,disabled:Boolean,checked:Boolean,indeterminate:Boolean,onCheck:Function},setup(e){const l=be(Ce);function c(s){const{onCheck:a}=e;a&&a(s)}function u(s){c(s)}return{handleUpdateValue:u,mergedTheme:l.mergedThemeRef}},render(){const{clsPrefix:e,mergedTheme:l,checked:c,indeterminate:u,disabled:s,focusable:a,indent:b,handleUpdateValue:k}=this;return v("span",{class:[`${e}-tree-node-checkbox`,this.right&&`${e}-tree-node-checkbox--right`],style:{width:`${b}px`},"data-checkbox":!0},v(nt,{focusable:a,disabled:s,theme:l.peers.Checkbox,themeOverrides:l.peerOverrides.Checkbox,checked:c,indeterminate:u,onUpdateChecked:k}))}}),st=ae({name:"TreeNodeContent",props:{clsPrefix:{type:String,required:!0},disabled:Boolean,checked:Boolean,selected:Boolean,onClick:Function,onDragstart:Function,tmNode:{type:Object,required:!0},nodeProps:Object},setup(e){const{renderLabelRef:l,renderPrefixRef:c,renderSuffixRef:u,labelFieldRef:s}=be(Ce),a=F(null);function b(g){const{onClick:m}=e;m&&m(g)}function k(g){b(g)}return{selfRef:a,renderLabel:l,renderPrefix:c,renderSuffix:u,labelField:s,handleClick:k}},render(){const{clsPrefix:e,labelField:l,nodeProps:c,checked:u=!1,selected:s=!1,renderLabel:a,renderPrefix:b,renderSuffix:k,handleClick:g,onDragstart:m,tmNode:{rawNode:h,rawNode:{prefix:D,suffix:y,[l]:f}}}=this;return v("span",Object.assign({},c,{ref:"selfRef",class:[`${e}-tree-node-content`,c==null?void 0:c.class],onClick:g,draggable:m===void 0?void 0:!0,onDragstart:m}),b||D?v("div",{class:`${e}-tree-node-content__prefix`},b?b({option:h,selected:s,checked:u}):ze(D)):null,v("div",{class:`${e}-tree-node-content__text`},a?a({option:h,selected:s,checked:u}):ze(f)),k||y?v("div",{class:`${e}-tree-node-content__suffix`},k?k({option:h,selected:s,checked:u}):ze(y)):null)}});function dn({position:e,offsetLevel:l,indent:c,el:u}){const s={position:"absolute",boxSizing:"border-box",right:0};if(e==="inside")s.left=0,s.top=0,s.bottom=0,s.borderRadius="inherit",s.boxShadow="inset 0 0 0 2px var(--n-drop-mark-color)";else{const a=e==="before"?"top":"bottom";s[a]=0,s.left=`${u.offsetLeft+6-l*c}px`,s.height="2px",s.backgroundColor="var(--n-drop-mark-color)",s.transformOrigin=a,s.borderRadius="1px",s.transform=e==="before"?"translateY(-4px)":"translateY(4px)"}return v("div",{style:s})}function ct({dropPosition:e,node:l}){return l.isLeaf===!1||l.children?!0:e!=="inside"}function ut(e){return _(()=>e.leafOnly?"child":e.checkStrategy)}function le(e,l){return!!e.rawNode[l]}function gn(e,l,c,u){e==null||e.forEach(s=>{c(s),gn(s[l],l,c,u),u(s)})}function ft(e,l,c,u,s){const a=new Set,b=new Set,k=[];return gn(e,u,g=>{if(k.push(g),s(l,g)){b.add(g[c]);for(let m=k.length-2;m>=0;--m)if(!a.has(k[m][c]))a.add(k[m][c]);else return}},()=>{k.pop()}),{expandedKeys:Array.from(a),highlightKeySet:b}}if(Hn&&Image){const e=new Image;e.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}function ht(e,l,c,u,s){const a=new Set,b=new Set,k=new Set,g=[],m=[],h=[];function D(f){f.forEach(x=>{if(h.push(x),l(c,x)){a.add(x[u]),k.add(x[u]);for(let R=h.length-2;R>=0;--R){const T=h[R][u];if(!b.has(T))b.add(T),a.has(T)&&a.delete(T);else break}}const w=x[s];w&&D(w),h.pop()})}D(e);function y(f,x){f.forEach(w=>{const R=w[u],T=a.has(R),Y=b.has(R);if(!T&&!Y)return;const A=w[s];if(A)if(T)x.push(w);else{g.push(R);const I=Object.assign(Object.assign({},w),{[s]:[]});x.push(I),y(A,I[s])}else x.push(w)})}return y(e,m),{filteredTree:m,highlightKeySet:k,expandedKeys:g}}const gt=ae({name:"TreeNode",props:{clsPrefix:{type:String,required:!0},tmNode:{type:Object,required:!0}},setup(e){const l=be(Ce),{droppingNodeParentRef:c,droppingMouseNodeRef:u,draggingNodeRef:s,droppingPositionRef:a,droppingOffsetLevelRef:b,nodePropsRef:k,indentRef:g,blockLineRef:m,checkboxPlacementRef:h,checkOnClickRef:D,disabledFieldRef:y,showLineRef:f}=l,x=B(()=>!!e.tmNode.rawNode.checkboxDisabled),w=B(()=>le(e.tmNode,y.value)),R=B(()=>l.disabledRef.value||w.value),T=_(()=>{const{value:o}=k;if(o)return o({option:e.tmNode.rawNode})}),Y=F(null),A={value:null};qn(()=>{A.value=Y.value.$el});function I(){const{tmNode:o}=e;if(!o.isLeaf&&!o.shallowLoaded){if(!l.loadingKeysRef.value.has(o.key))l.loadingKeysRef.value.add(o.key);else return;const{onLoadRef:{value:p}}=l;p&&p(o.rawNode).then(C=>{C!==!1&&l.handleSwitcherClick(o)}).finally(()=>{l.loadingKeysRef.value.delete(o.key)})}else l.handleSwitcherClick(o)}const Q=B(()=>!w.value&&l.selectableRef.value&&(l.internalTreeSelect?l.mergedCheckStrategyRef.value!=="child"||l.multipleRef.value&&l.cascadeRef.value||e.tmNode.isLeaf:!0)),J=B(()=>l.checkableRef.value&&(l.cascadeRef.value||l.mergedCheckStrategyRef.value!=="child"||e.tmNode.isLeaf)),re=B(()=>l.displayedCheckedKeysRef.value.includes(e.tmNode.key)),ie=B(()=>{const{value:o}=J;if(!o)return!1;const{value:p}=D,{tmNode:C}=e;return typeof p=="boolean"?!C.disabled&&p:p(e.tmNode.rawNode)});function Ke(o){const{value:p}=l.expandOnClickRef,{value:C}=Q,{value:$}=ie;if(!C&&!p&&!$||an(o,"checkbox")||an(o,"switcher"))return;const{tmNode:De}=e;C&&l.handleSelect(De),p&&!De.isLeaf&&I(),$&&me(!re.value)}function de(o){var p,C;m.value||(R.value||Ke(o),(C=(p=T.value)===null||p===void 0?void 0:p.onClick)===null||C===void 0||C.call(p,o))}function ke(o){var p,C;m.value&&(R.value||Ke(o),(C=(p=T.value)===null||p===void 0?void 0:p.onClick)===null||C===void 0||C.call(p,o))}function me(o){l.handleCheck(e.tmNode,o)}function Ie(o){l.handleDragStart({event:o,node:e.tmNode})}function H(o){o.currentTarget===o.target&&l.handleDragEnter({event:o,node:e.tmNode})}function Z(o){o.preventDefault(),l.handleDragOver({event:o,node:e.tmNode})}function ee(o){l.handleDragEnd({event:o,node:e.tmNode})}function _e(o){o.currentTarget===o.target&&l.handleDragLeave({event:o,node:e.tmNode})}function G(o){o.preventDefault(),a.value!==null&&l.handleDrop({event:o,node:e.tmNode,dropPosition:a.value})}const ne=_(()=>{const{clsPrefix:o}=e,{value:p}=g;if(f.value){const C=[];let $=e.tmNode.parent;for(;$;)$.isLastChild?C.push(v("div",{class:`${o}-tree-node-indent`},v("div",{style:{width:`${p}px`}}))):C.push(v("div",{class:[`${o}-tree-node-indent`,`${o}-tree-node-indent--show-line`]},v("div",{style:{width:`${p}px`}}))),$=$.parent;return C.reverse()}else return Vn(e.tmNode.level,v("div",{class:`${e.clsPrefix}-tree-node-indent`},v("div",{style:{width:`${p}px`}})))});return{showDropMark:B(()=>{const{value:o}=s;if(!o)return;const{value:p}=a;if(!p)return;const{value:C}=u;if(!C)return;const{tmNode:$}=e;return $.key===C.key}),showDropMarkAsParent:B(()=>{const{value:o}=c;if(!o)return!1;const{tmNode:p}=e,{value:C}=a;return C==="before"||C==="after"?o.key===p.key:!1}),pending:B(()=>l.pendingNodeKeyRef.value===e.tmNode.key),loading:B(()=>l.loadingKeysRef.value.has(e.tmNode.key)),highlight:B(()=>{var o;return(o=l.highlightKeySetRef.value)===null||o===void 0?void 0:o.has(e.tmNode.key)}),checked:re,indeterminate:B(()=>l.displayedIndeterminateKeysRef.value.includes(e.tmNode.key)),selected:B(()=>l.mergedSelectedKeysRef.value.includes(e.tmNode.key)),expanded:B(()=>l.mergedExpandedKeysRef.value.includes(e.tmNode.key)),disabled:R,checkable:J,mergedCheckOnClick:ie,checkboxDisabled:x,selectable:Q,expandOnClick:l.expandOnClickRef,internalScrollable:l.internalScrollableRef,draggable:l.draggableRef,blockLine:m,nodeProps:T,checkboxFocusable:l.internalCheckboxFocusableRef,droppingPosition:a,droppingOffsetLevel:b,indent:g,checkboxPlacement:h,showLine:f,contentInstRef:Y,contentElRef:A,indentNodes:ne,handleCheck:me,handleDrop:G,handleDragStart:Ie,handleDragEnter:H,handleDragOver:Z,handleDragEnd:ee,handleDragLeave:_e,handleLineClick:ke,handleContentClick:de,handleSwitcherClick:I}},render(){const{tmNode:e,clsPrefix:l,checkable:c,expandOnClick:u,selectable:s,selected:a,checked:b,highlight:k,draggable:g,blockLine:m,indent:h,indentNodes:D,disabled:y,pending:f,internalScrollable:x,nodeProps:w,checkboxPlacement:R}=this,T=g&&!y?{onDragenter:this.handleDragEnter,onDragleave:this.handleDragLeave,onDragend:this.handleDragEnd,onDrop:this.handleDrop,onDragover:this.handleDragOver}:void 0,Y=x?fn(e.key):void 0,A=R==="right",I=c?v(dt,{indent:h,right:A,focusable:this.checkboxFocusable,disabled:y||this.checkboxDisabled,clsPrefix:l,checked:this.checked,indeterminate:this.indeterminate,onCheck:this.handleCheck}):null;return v("div",Object.assign({class:`${l}-tree-node-wrapper`},T),v("div",Object.assign({},m?w:void 0,{class:[`${l}-tree-node`,{[`${l}-tree-node--selected`]:a,[`${l}-tree-node--checkable`]:c,[`${l}-tree-node--highlight`]:k,[`${l}-tree-node--pending`]:f,[`${l}-tree-node--disabled`]:y,[`${l}-tree-node--selectable`]:s,[`${l}-tree-node--clickable`]:s||u||this.mergedCheckOnClick},w==null?void 0:w.class],"data-key":Y,draggable:g&&m,onClick:this.handleLineClick,onDragstart:g&&m&&!y?this.handleDragStart:void 0}),D,e.isLeaf&&this.showLine?v("div",{class:[`${l}-tree-node-indent`,`${l}-tree-node-indent--show-line`,e.isLeaf&&`${l}-tree-node-indent--is-leaf`,e.isLastChild&&`${l}-tree-node-indent--last-child`]},v("div",{style:{width:`${h}px`}})):v(rt,{clsPrefix:l,expanded:this.expanded,selected:a,loading:this.loading,hide:e.isLeaf,tmNode:this.tmNode,indent:h,onClick:this.handleSwitcherClick}),A?null:I,v(st,{ref:"contentInstRef",clsPrefix:l,checked:b,selected:a,onClick:this.handleContentClick,nodeProps:m?void 0:w,onDragstart:g&&!m&&!y?this.handleDragStart:void 0,tmNode:e}),g?this.showDropMark?dn({el:this.contentElRef.value,position:this.droppingPosition,offsetLevel:this.droppingOffsetLevel,indent:h}):this.showDropMarkAsParent?dn({el:this.contentElRef.value,position:"inside",offsetLevel:this.droppingOffsetLevel,indent:h}):null:null,A?I:null))}}),vn=gt;function vt({props:e,fNodesRef:l,mergedExpandedKeysRef:c,mergedSelectedKeysRef:u,handleSelect:s,handleSwitcherClick:a}){const{value:b}=u,k=be(hn,null),g=k?k.pendingNodeKeyRef:F(b.length?b[b.length-1]:null);function m(h){if(!e.keyboard)return;const{value:D}=g;if(D===null){if((h.key==="ArrowDown"||h.key==="ArrowUp")&&h.preventDefault(),["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(h.key)&&D===null){const{value:y}=l;let f=0;for(;f<y.length;){if(!y[f].disabled){g.value=y[f].key;break}f+=1}}}else{const{value:y}=l;let f=y.findIndex(x=>x.key===D);if(!~f)return;if(h.key==="Enter")s(y[f]);else if(h.key==="ArrowDown")for(h.preventDefault(),f+=1;f<y.length;){if(!y[f].disabled){g.value=y[f].key;break}f+=1}else if(h.key==="ArrowUp")for(h.preventDefault(),f-=1;f>=0;){if(!y[f].disabled){g.value=y[f].key;break}f-=1}else if(h.key==="ArrowLeft"){const x=y[f];if(x.isLeaf||!c.value.includes(D)){const w=x.getParent();w&&(g.value=w.key)}else a(x)}else if(h.key==="ArrowRight"){const x=y[f];if(x.isLeaf)return;if(!c.value.includes(D))a(x);else for(f+=1;f<y.length;){if(!y[f].disabled){g.value=y[f].key;break}f+=1}}}}return{pendingNodeKeyRef:g,handleKeydown:m}}const yt=ae({name:"TreeMotionWrapper",props:{clsPrefix:{type:String,required:!0},height:Number,nodes:{type:Array,required:!0},mode:{type:String,required:!0},onAfterEnter:{type:Function,required:!0}},render(){const{clsPrefix:e}=this;return v(Gn,{onAfterEnter:this.onAfterEnter,appear:!0,reverse:this.mode==="collapse"},{default:()=>v("div",{class:[`${e}-tree-motion-wrapper`,`${e}-tree-motion-wrapper--${this.mode}`],style:{height:cn(this.height)}},this.nodes.map(l=>v(vn,{clsPrefix:e,tmNode:l})))})}}),Ve=Wn(),bt=P("tree",`
 font-size: var(--n-font-size);
 outline: none;
`,[X("ul, li",`
 margin: 0;
 padding: 0;
 list-style: none;
 `),X(">",[P("tree-node",[X("&:first-child","margin-top: 0;")])]),P("tree-motion-wrapper",[E("expand",[ln({duration:"0.2s"})]),E("collapse",[ln({duration:"0.2s",reverse:!0})])]),P("tree-node-wrapper",`
 box-sizing: border-box;
 padding: var(--n-node-wrapper-padding);
 `),P("tree-node",`
 transform: translate3d(0,0,0);
 position: relative;
 display: flex;
 border-radius: var(--n-node-border-radius);
 transition: background-color .3s var(--n-bezier);
 `,[E("highlight",[P("tree-node-content",[ve("text","border-bottom-color: var(--n-node-text-color-disabled);")])]),E("disabled",[P("tree-node-content",`
 color: var(--n-node-text-color-disabled);
 cursor: not-allowed;
 `)]),ye("disabled",[E("clickable",[P("tree-node-content",`
 cursor: pointer;
 `)])])]),E("block-node",[P("tree-node-content",`
 flex: 1;
 min-width: 0;
 `)]),ye("block-line",[P("tree-node",[ye("disabled",[P("tree-node-content",[X("&:hover","background: var(--n-node-color-hover);")]),E("selectable",[P("tree-node-content",[X("&:active","background: var(--n-node-color-pressed);")])]),E("pending",[P("tree-node-content",`
 background: var(--n-node-color-hover);
 `)]),E("selected",[P("tree-node-content","background: var(--n-node-color-active);")])])])]),E("block-line",[P("tree-node",[ye("disabled",[X("&:hover","background: var(--n-node-color-hover);"),E("pending",`
 background: var(--n-node-color-hover);
 `),E("selectable",[ye("selected",[X("&:active","background: var(--n-node-color-pressed);")])]),E("selected","background: var(--n-node-color-active);")]),E("disabled",`
 cursor: not-allowed;
 `)])]),P("tree-node-indent",`
 flex-grow: 0;
 flex-shrink: 0;
 `,[E("show-line","position: relative",[X("&::before",`
 position: absolute;
 left: 50%;
 border-left: 1px solid var(--n-border-color);
 transition: border-color .3s var(--n-bezier);
 transform: translate(-50%);
 content: "";
 top: var(--n-line-offset-top);
 bottom: var(--n-line-offset-bottom);
 `),E("last-child",[X("&::before",`
 bottom: 50%;
 `)]),E("is-leaf",[X("&::after",`
 position: absolute;
 content: "";
 left: calc(50% + 0.5px);
 right: 0;
 bottom: 50%;
 transition: border-color .3s var(--n-bezier);
 border-bottom: 1px solid var(--n-border-color);
 `)])]),ye("show-line","height: 0;")]),P("tree-node-switcher",`
 cursor: pointer;
 display: inline-flex;
 flex-shrink: 0;
 height: var(--n-node-content-height);
 align-items: center;
 justify-content: center;
 transition: transform .15s var(--n-bezier);
 vertical-align: bottom;
 `,[ve("icon",`
 position: relative;
 height: 14px;
 width: 14px;
 display: flex;
 color: var(--n-arrow-color);
 transition: color .3s var(--n-bezier);
 font-size: 14px;
 `,[P("icon",[Ve]),P("base-loading",`
 color: var(--n-loading-color);
 position: absolute;
 left: 0;
 top: 0;
 right: 0;
 bottom: 0;
 `,[Ve]),P("base-icon",[Ve])]),E("hide","visibility: hidden;"),E("expanded","transform: rotate(90deg);")]),P("tree-node-checkbox",`
 display: inline-flex;
 height: var(--n-node-content-height);
 vertical-align: bottom;
 align-items: center;
 justify-content: center;
 `),P("tree-node-content",`
 user-select: none;
 position: relative;
 display: inline-flex;
 align-items: center;
 min-height: var(--n-node-content-height);
 box-sizing: border-box;
 line-height: var(--n-line-height);
 vertical-align: bottom;
 padding: 0 6px 0 4px;
 cursor: default;
 border-radius: var(--n-node-border-radius);
 color: var(--n-node-text-color);
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `,[X("&:last-child","margin-bottom: 0;"),ve("prefix",`
 display: inline-flex;
 margin-right: 8px;
 `),ve("text",`
 border-bottom: 1px solid #0000;
 transition: border-color .3s var(--n-bezier);
 flex-grow: 1;
 max-width: 100%;
 `),ve("suffix",`
 display: inline-flex;
 `)]),ve("empty","margin: auto;")]);var kt=globalThis&&globalThis.__awaiter||function(e,l,c,u){function s(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(a,b){function k(h){try{m(u.next(h))}catch(D){b(D)}}function g(h){try{m(u.throw(h))}catch(D){b(D)}}function m(h){h.done?a(h.value):s(h.value).then(k,g)}m((u=u.apply(e,l||[])).next())})};function mt(e,l,c,u){return{getIsGroup(){return!1},getKey(a){return a[e]},getChildren:u||(a=>a[l]),getDisabled(a){return!!(a[c]||a.checkboxDisabled)}}}const xt={allowCheckingNotLoaded:Boolean,filter:Function,defaultExpandAll:Boolean,expandedKeys:Array,keyField:{type:String,default:"key"},labelField:{type:String,default:"label"},childrenField:{type:String,default:"children"},disabledField:{type:String,default:"disabled"},defaultExpandedKeys:{type:Array,default:()=>[]},indeterminateKeys:Array,renderSwitcherIcon:Function,onUpdateIndeterminateKeys:[Function,Array],"onUpdate:indeterminateKeys":[Function,Array],onUpdateExpandedKeys:[Function,Array],"onUpdate:expandedKeys":[Function,Array]},wt=Object.assign(Object.assign(Object.assign(Object.assign({},un.props),{accordion:Boolean,showIrrelevantNodes:{type:Boolean,default:!0},data:{type:Array,default:()=>[]},expandOnDragenter:{type:Boolean,default:!0},expandOnClick:Boolean,checkOnClick:{type:[Boolean,Function],default:!1},cancelable:{type:Boolean,default:!0},checkable:Boolean,draggable:Boolean,blockNode:Boolean,blockLine:Boolean,showLine:Boolean,disabled:Boolean,checkedKeys:Array,defaultCheckedKeys:{type:Array,default:()=>[]},selectedKeys:Array,defaultSelectedKeys:{type:Array,default:()=>[]},multiple:Boolean,pattern:{type:String,default:""},onLoad:Function,cascade:Boolean,selectable:{type:Boolean,default:!0},scrollbarProps:Object,indent:{type:Number,default:24},allowDrop:{type:Function,default:ct},animated:{type:Boolean,default:!0},checkboxPlacement:{type:String,default:"left"},virtualScroll:Boolean,watchProps:Array,renderLabel:Function,renderPrefix:Function,renderSuffix:Function,nodeProps:Function,keyboard:{type:Boolean,default:!0},getChildren:Function,onDragenter:[Function,Array],onDragleave:[Function,Array],onDragend:[Function,Array],onDragstart:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onUpdateCheckedKeys:[Function,Array],"onUpdate:checkedKeys":[Function,Array],onUpdateSelectedKeys:[Function,Array],"onUpdate:selectedKeys":[Function,Array]}),xt),{internalTreeSelect:Boolean,internalScrollable:Boolean,internalScrollablePadding:String,internalRenderEmpty:Function,internalHighlightKeySet:Object,internalUnifySelectCheck:Boolean,internalCheckboxFocusable:{type:Boolean,default:!0},internalFocusable:{type:Boolean,default:!0},checkStrategy:{type:String,default:"all"},leafOnly:Boolean}),Kt=ae({name:"Tree",props:wt,setup(e){const{mergedClsPrefixRef:l,inlineThemeDisabled:c,mergedRtlRef:u}=Xn(e),s=Yn("Tree",u,l),a=un("Tree","-tree",bt,Qn,e,l),b=F(null),k=F(null),g=F(null);function m(){var n;return(n=g.value)===null||n===void 0?void 0:n.listElRef}function h(){var n;return(n=g.value)===null||n===void 0?void 0:n.itemsElRef}const D=_(()=>{const{filter:n}=e;if(n)return n;const{labelField:t}=e;return(i,d)=>{if(!i.length)return!0;const r=d[t];return typeof r=="string"?r.toLowerCase().includes(i.toLowerCase()):!1}}),y=_(()=>{const{pattern:n}=e;return n?!n.length||!D.value?{filteredTree:e.data,highlightKeySet:null,expandedKeys:void 0}:ht(e.data,D.value,n,e.keyField,e.childrenField):{filteredTree:e.data,highlightKeySet:null,expandedKeys:void 0}}),f=_(()=>tt(e.showIrrelevantNodes?e.data:y.value.filteredTree,mt(e.keyField,e.childrenField,e.disabledField,e.getChildren))),x=be(hn,null),w=e.internalTreeSelect?x.dataTreeMate:f,{watchProps:R}=e,T=F([]);R!=null&&R.includes("defaultCheckedKeys")?Re(()=>{T.value=e.defaultCheckedKeys}):T.value=e.defaultCheckedKeys;const Y=K(e,"checkedKeys"),A=Oe(Y,T),I=_(()=>w.value.getCheckedKeys(A.value,{cascade:e.cascade,allowNotLoaded:e.allowCheckingNotLoaded})),Q=ut(e),J=_(()=>I.value.checkedKeys),re=_(()=>{const{indeterminateKeys:n}=e;return n!==void 0?n:I.value.indeterminateKeys}),ie=F([]);R!=null&&R.includes("defaultSelectedKeys")?Re(()=>{ie.value=e.defaultSelectedKeys}):ie.value=e.defaultSelectedKeys;const Ke=K(e,"selectedKeys"),de=Oe(Ke,ie),ke=F([]),me=n=>{ke.value=e.defaultExpandAll?w.value.getNonLeafKeys():n===void 0?e.defaultExpandedKeys:n};R!=null&&R.includes("defaultExpandedKeys")?Re(()=>{me(void 0)}):Re(()=>{me(e.defaultExpandedKeys)});const Ie=K(e,"expandedKeys"),H=Oe(Ie,ke),Z=_(()=>f.value.getFlattenedNodes(H.value)),{pendingNodeKeyRef:ee,handleKeydown:_e}=vt({props:e,mergedSelectedKeysRef:de,fNodesRef:Z,mergedExpandedKeysRef:H,handleSelect:Me,handleSwitcherClick:Qe});let G=null,ne=null;const o=F(new Set),p=_(()=>e.internalHighlightKeySet||y.value.highlightKeySet),C=Oe(p,o),$=F(new Set),De=_(()=>H.value.filter(n=>!$.value.has(n)));let Ge=0;const xe=F(null),Le=F(null),Te=F(null),Ae=F(null),Pe=F(0),yn=_(()=>{const{value:n}=Le;return n?n.parent:null});Fe(K(e,"data"),()=>{$.value.clear(),ee.value=null,pe()},{deep:!1});let Be=!1;const $e=()=>{Be=!0,qe(()=>{Be=!1})};let we;Fe(K(e,"pattern"),(n,t)=>{if(e.showIrrelevantNodes)if(we=void 0,n){const{expandedKeys:i,highlightKeySet:d}=ft(e.data,e.pattern,e.keyField,e.childrenField,D.value);o.value=d,$e(),ce(i,j(i),{node:null,action:"filter"})}else o.value=new Set;else if(!n.length)we!==void 0&&($e(),ce(we,j(we),{node:null,action:"filter"}));else{t.length||(we=H.value);const{expandedKeys:i}=y.value;i!==void 0&&($e(),ce(i,j(i),{node:null,action:"filter"}))}});function We(n){return kt(this,void 0,void 0,function*(){const{onLoad:t}=e;if(!t){yield Promise.resolve();return}const{value:i}=$;if(!i.has(n.key)){i.add(n.key);try{(yield t(n.rawNode))===!1&&ue()}catch(d){console.error(d),ue()}i.delete(n.key)}})}Re(()=>{var n;const{value:t}=f;if(!t)return;const{getNode:i}=t;(n=H.value)===null||n===void 0||n.forEach(d=>{const r=i(d);r&&!r.shallowLoaded&&We(r)})});const se=F(!1),te=F([]);Fe(De,(n,t)=>{if(!e.animated||Be){qe(Ee);return}const i=Se(a.value.self.nodeHeight),d=new Set(t);let r=null,L=null;for(const S of n)if(!d.has(S)){if(r!==null)return;r=S}const U=new Set(n);for(const S of t)if(!U.has(S)){if(L!==null)return;L=S}if(r===null&&L===null)return;const{virtualScroll:z}=e,he=(z?g.value.listElRef:b.value).offsetHeight,ge=Math.ceil(he/i)+1;let q;if(r!==null&&(q=t),L!==null&&(q===void 0?q=n:q=q.filter(S=>S!==L)),se.value=!0,te.value=f.value.getFlattenedNodes(q),r!==null){const S=te.value.findIndex(V=>V.key===r);if(~S){const V=te.value[S].children;if(V){const W=rn(V,n);te.value.splice(S+1,0,{__motion:!0,mode:"expand",height:z?W.length*i:void 0,nodes:z?W.slice(0,ge):W})}}}if(L!==null){const S=te.value.findIndex(V=>V.key===L);if(~S){const V=te.value[S].children;if(!V)return;se.value=!0;const W=rn(V,n);te.value.splice(S+1,0,{__motion:!0,mode:"collapse",height:z?W.length*i:void 0,nodes:z?W.slice(0,ge):W})}}});const bn=_(()=>lt(Z.value)),kn=_(()=>se.value?te.value:Z.value);function Ee(){const{value:n}=k;n&&n.sync()}function mn(){se.value=!1,e.virtualScroll&&qe(Ee)}function j(n){const{getNode:t}=w.value;return n.map(i=>{var d;return((d=t(i))===null||d===void 0?void 0:d.rawNode)||null})}function ce(n,t,i){const{"onUpdate:expandedKeys":d,onUpdateExpandedKeys:r}=e;ke.value=n,d&&M(d,n,t,i),r&&M(r,n,t,i)}function Xe(n,t,i){const{"onUpdate:checkedKeys":d,onUpdateCheckedKeys:r}=e;T.value=n,r&&M(r,n,t,i),d&&M(d,n,t,i)}function xn(n,t){const{"onUpdate:indeterminateKeys":i,onUpdateIndeterminateKeys:d}=e;i&&M(i,n,t),d&&M(d,n,t)}function Ue(n,t,i){const{"onUpdate:selectedKeys":d,onUpdateSelectedKeys:r}=e;ie.value=n,r&&M(r,n,t,i),d&&M(d,n,t,i)}function wn(n){const{onDragenter:t}=e;t&&M(t,n)}function pn(n){const{onDragleave:t}=e;t&&M(t,n)}function Nn(n){const{onDragend:t}=e;t&&M(t,n)}function Rn(n){const{onDragstart:t}=e;t&&M(t,n)}function Sn(n){const{onDragover:t}=e;t&&M(t,n)}function Cn(n){const{onDrop:t}=e;t&&M(t,n)}function pe(){Kn(),oe()}function Kn(){xe.value=null}function oe(){Pe.value=0,Le.value=null,Te.value=null,Ae.value=null,ue()}function ue(){G&&(window.clearTimeout(G),G=null),ne=null}function Ye(n,t){if(e.disabled||le(n,e.disabledField))return;if(e.internalUnifySelectCheck&&!e.multiple){Me(n);return}const i=t?"check":"uncheck",{checkedKeys:d,indeterminateKeys:r}=w.value[i](n.key,J.value,{cascade:e.cascade,checkStrategy:Q.value,allowNotLoaded:e.allowCheckingNotLoaded});Xe(d,j(d),{node:n.rawNode,action:i}),xn(r,j(r))}function Dn(n){if(e.disabled)return;const{key:t}=n,{value:i}=H,d=i.findIndex(r=>r===t);if(~d){const r=Array.from(i);r.splice(d,1),ce(r,j(r),{node:n.rawNode,action:"collapse"})}else{const r=f.value.getNode(t);if(!r||r.isLeaf)return;let L;if(e.accordion){const U=new Set(n.siblings.map(({key:z})=>z));L=i.filter(z=>!U.has(z)),L.push(t)}else L=i.concat(t);ce(L,j(L),{node:n.rawNode,action:"expand"})}}function Qe(n){e.disabled||se.value||Dn(n)}function Me(n){if(!(e.disabled||!e.selectable)){if(ee.value=n.key,e.internalUnifySelectCheck){const{value:{checkedKeys:t,indeterminateKeys:i}}=I;e.multiple?Ye(n,!(t.includes(n.key)||i.includes(n.key))):Xe([n.key],j([n.key]),{node:n.rawNode,action:"check"})}if(e.multiple){const t=Array.from(de.value),i=t.findIndex(d=>d===n.key);~i?e.cancelable&&t.splice(i,1):~i||t.push(n.key),Ue(t,j(t),{node:n.rawNode,action:~i?"unselect":"select"})}else de.value.includes(n.key)?e.cancelable&&Ue([],[],{node:n.rawNode,action:"unselect"}):Ue([n.key],j([n.key]),{node:n.rawNode,action:"select"})}}function Ln(n){if(G&&(window.clearTimeout(G),G=null),n.isLeaf)return;ne=n.key;const t=()=>{if(ne!==n.key)return;const{value:i}=Te;if(i&&i.key===n.key&&!H.value.includes(n.key)){const d=H.value.concat(n.key);ce(d,j(d),{node:n.rawNode,action:"expand"})}G=null,ne=null};n.shallowLoaded?G=window.setTimeout(()=>{t()},1e3):G=window.setTimeout(()=>{We(n).then(()=>{t()})},1e3)}function Tn({event:n,node:t}){!e.draggable||e.disabled||le(t,e.disabledField)||(Je({event:n,node:t},!1),wn({event:n,node:t.rawNode}))}function An({event:n,node:t}){!e.draggable||e.disabled||le(t,e.disabledField)||pn({event:n,node:t.rawNode})}function Pn(n){n.target===n.currentTarget&&oe()}function En({event:n,node:t}){pe(),!(!e.draggable||e.disabled||le(t,e.disabledField))&&Nn({event:n,node:t.rawNode})}function Fn({event:n,node:t}){!e.draggable||e.disabled||le(t,e.disabledField)||(Ge=n.clientX,xe.value=t,Rn({event:n,node:t.rawNode}))}function Je({event:n,node:t},i=!0){var d;if(!e.draggable||e.disabled||le(t,e.disabledField))return;const{value:r}=xe;if(!r)return;const{allowDrop:L,indent:U}=e;i&&Sn({event:n,node:t.rawNode});const z=n.currentTarget,{height:he,top:ge}=z.getBoundingClientRect(),q=n.clientY-ge;let S;L({node:t.rawNode,dropPosition:"inside",phase:"drag"})?q<=8?S="before":q>=he-8?S="after":S="inside":q<=he/2?S="before":S="after";const{value:W}=bn;let N,O;const Ne=W(t.key);if(Ne===null){oe();return}let en=!1;S==="inside"?(N=t,O="inside"):S==="before"?t.isFirstChild?(N=t,O="before"):(N=Z.value[Ne-1],O="after"):(N=t,O="after"),!N.isLeaf&&H.value.includes(N.key)&&(en=!0,O==="after"&&(N=Z.value[Ne+1],N?O="before":(N=t,O="inside")));const nn=N;if(Te.value=nn,!en&&r.isLastChild&&r.key===N.key&&(O="after"),O==="after"){let tn=Ge-n.clientX,je=0;for(;tn>=U/2&&N.parent!==null&&N.isLastChild&&je<1;)tn-=U,je+=1,N=N.parent;Pe.value=je}else Pe.value=0;if((r.contains(N)||O==="inside"&&((d=r.parent)===null||d===void 0?void 0:d.key)===N.key)&&!(r.key===nn.key&&r.key===N.key)){oe();return}if(!L({node:N.rawNode,dropPosition:O,phase:"drag"})){oe();return}if(r.key===N.key)ue();else if(ne!==N.key)if(O==="inside"){if(e.expandOnDragenter){if(Ln(N),!N.shallowLoaded&&ne!==N.key){pe();return}}else if(!N.shallowLoaded){pe();return}}else ue();else O!=="inside"&&ue();Ae.value=O,Le.value=N}function On({event:n,node:t,dropPosition:i}){if(!e.draggable||e.disabled||le(t,e.disabledField))return;const{value:d}=xe,{value:r}=Le,{value:L}=Ae;if(!(!d||!r||!L)&&e.allowDrop({node:r.rawNode,dropPosition:L,phase:"drag"})&&d.key!==r.key){if(L==="before"){const U=d.getNext({includeDisabled:!0});if(U&&U.key===r.key){oe();return}}if(L==="after"){const U=d.getPrev({includeDisabled:!0});if(U&&U.key===r.key){oe();return}}Cn({event:n,node:r.rawNode,dragNode:d.rawNode,dropPosition:i}),pe()}}function In(){Ee()}function _n(){Ee()}function Bn(n){var t;if(e.virtualScroll||e.internalScrollable){const{value:i}=k;if(!((t=i==null?void 0:i.containerRef)===null||t===void 0)&&t.contains(n.relatedTarget))return;ee.value=null}else{const{value:i}=b;if(i!=null&&i.contains(n.relatedTarget))return;ee.value=null}}Fe(ee,n=>{var t,i;if(n!==null){if(e.virtualScroll)(t=g.value)===null||t===void 0||t.scrollTo({key:n});else if(e.internalScrollable){const{value:d}=k;if(d===null)return;const r=(i=d.contentRef)===null||i===void 0?void 0:i.querySelector(`[data-key="${fn(n)}"]`);if(!r)return;d.scrollTo({el:r})}}}),Jn(Ce,{loadingKeysRef:$,highlightKeySetRef:C,displayedCheckedKeysRef:J,displayedIndeterminateKeysRef:re,mergedSelectedKeysRef:de,mergedExpandedKeysRef:H,mergedThemeRef:a,mergedCheckStrategyRef:Q,nodePropsRef:K(e,"nodeProps"),disabledRef:K(e,"disabled"),checkableRef:K(e,"checkable"),selectableRef:K(e,"selectable"),expandOnClickRef:K(e,"expandOnClick"),onLoadRef:K(e,"onLoad"),draggableRef:K(e,"draggable"),blockLineRef:K(e,"blockLine"),indentRef:K(e,"indent"),cascadeRef:K(e,"cascade"),checkOnClickRef:K(e,"checkOnClick"),checkboxPlacementRef:e.checkboxPlacement,droppingMouseNodeRef:Te,droppingNodeParentRef:yn,draggingNodeRef:xe,droppingPositionRef:Ae,droppingOffsetLevelRef:Pe,fNodesRef:Z,pendingNodeKeyRef:ee,showLineRef:K(e,"showLine"),disabledFieldRef:K(e,"disabledField"),internalScrollableRef:K(e,"internalScrollable"),internalCheckboxFocusableRef:K(e,"internalCheckboxFocusable"),internalTreeSelect:e.internalTreeSelect,renderLabelRef:K(e,"renderLabel"),renderPrefixRef:K(e,"renderPrefix"),renderSuffixRef:K(e,"renderSuffix"),renderSwitcherIconRef:K(e,"renderSwitcherIcon"),labelFieldRef:K(e,"labelField"),multipleRef:K(e,"multiple"),handleSwitcherClick:Qe,handleDragEnd:En,handleDragEnter:Tn,handleDragLeave:An,handleDragStart:Fn,handleDrop:On,handleDragOver:Je,handleSelect:Me,handleCheck:Ye});function $n(n){var t;(t=g.value)===null||t===void 0||t.scrollTo(n)}const Un={handleKeydown:_e,scrollTo:$n,getCheckedData:()=>{if(!e.checkable)return{keys:[],options:[]};const{checkedKeys:n}=I.value;return{keys:n,options:j(n)}},getIndeterminateData:()=>{if(!e.checkable)return{keys:[],options:[]};const{indeterminateKeys:n}=I.value;return{keys:n,options:j(n)}}},Ze=_(()=>{const{common:{cubicBezierEaseInOut:n},self:{fontSize:t,nodeBorderRadius:i,nodeColorHover:d,nodeColorPressed:r,nodeColorActive:L,arrowColor:U,loadingColor:z,nodeTextColor:he,nodeTextColorDisabled:ge,dropMarkColor:q,nodeWrapperPadding:S,nodeHeight:V,lineHeight:W}}=a.value,N=He(S,"top"),O=He(S,"bottom"),Ne=cn(Se(V)-Se(N)-Se(O));return{"--n-arrow-color":U,"--n-loading-color":z,"--n-bezier":n,"--n-font-size":t,"--n-node-border-radius":i,"--n-node-color-active":L,"--n-node-color-hover":d,"--n-node-color-pressed":r,"--n-node-text-color":he,"--n-node-text-color-disabled":ge,"--n-drop-mark-color":q,"--n-node-wrapper-padding":S,"--n-line-offset-top":`-${N}`,"--n-line-offset-bottom":`-${O}`,"--n-node-content-height":Ne,"--n-line-height":W}}),fe=c?Zn("tree",void 0,Ze,e):void 0;return Object.assign(Object.assign({},Un),{mergedClsPrefix:l,mergedTheme:a,rtlEnabled:s,fNodes:kn,aip:se,selfElRef:b,virtualListInstRef:g,scrollbarInstRef:k,handleFocusout:Bn,handleDragLeaveTree:Pn,handleScroll:In,getScrollContainer:m,getScrollContent:h,handleAfterEnter:mn,handleResize:_n,cssVars:c?void 0:Ze,themeClass:fe==null?void 0:fe.themeClass,onRender:fe==null?void 0:fe.onRender})},render(){var e;const{fNodes:l,internalRenderEmpty:c}=this;if(!l.length&&c)return c();const{mergedClsPrefix:u,blockNode:s,blockLine:a,draggable:b,disabled:k,internalFocusable:g,checkable:m,handleKeydown:h,rtlEnabled:D,handleFocusout:y,scrollbarProps:f}=this,x=g&&!k,w=x?"0":void 0,R=[`${u}-tree`,D&&`${u}-tree--rtl`,m&&`${u}-tree--checkable`,(a||s)&&`${u}-tree--block-node`,a&&`${u}-tree--block-line`],T=A=>"__motion"in A?v(yt,{height:A.height,nodes:A.nodes,clsPrefix:u,mode:A.mode,onAfterEnter:this.handleAfterEnter}):v(vn,{key:A.key,tmNode:A,clsPrefix:u});if(this.virtualScroll){const{mergedTheme:A,internalScrollablePadding:I}=this,Q=He(I||"0");return v(on,Object.assign({},f,{ref:"scrollbarInstRef",onDragleave:b?this.handleDragLeaveTree:void 0,container:this.getScrollContainer,content:this.getScrollContent,class:R,theme:A.peers.Scrollbar,themeOverrides:A.peerOverrides.Scrollbar,tabindex:w,onKeydown:x?h:void 0,onFocusout:x?y:void 0}),{default:()=>{var J;return(J=this.onRender)===null||J===void 0||J.call(this),v(ot,{ref:"virtualListInstRef",items:this.fNodes,itemSize:Se(A.self.nodeHeight),ignoreItemResize:this.aip,paddingTop:Q.top,paddingBottom:Q.bottom,class:this.themeClass,style:[this.cssVars,{paddingLeft:Q.left,paddingRight:Q.right}],onScroll:this.handleScroll,onResize:this.handleResize,showScrollbar:!1,itemResizable:!0},{default:({item:re})=>T(re)})}})}const{internalScrollable:Y}=this;return R.push(this.themeClass),(e=this.onRender)===null||e===void 0||e.call(this),Y?v(on,Object.assign({},f,{class:R,tabindex:w,onKeydown:x?h:void 0,onFocusout:x?y:void 0,style:this.cssVars,contentStyle:{padding:this.internalScrollablePadding}}),{default:()=>v("div",{onDragleave:b?this.handleDragLeaveTree:void 0,ref:"selfElRef"},this.fNodes.map(T))}):v("div",{class:R,tabindex:w,ref:"selfElRef",style:this.cssVars,onKeydown:x?h:void 0,onFocusout:x?y:void 0,onDragleave:b?this.handleDragLeaveTree:void 0},l.length?l.map(T):et(this.$slots.empty,()=>[v(it,{class:`${u}-tree__empty`,theme:this.mergedTheme.peers.Empty,themeOverrides:this.mergedTheme.peerOverrides.Empty})]))}});export{Kt as _,hn as a,mt as c,xt as t,ut as u};
