var Me=Object.defineProperty,Pe=Object.defineProperties;var We=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var De=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable;var te=(g,u,s)=>u in g?Me(g,u,{enumerable:!0,configurable:!0,writable:!0,value:s}):g[u]=s,ne=(g,u)=>{for(var s in u||(u={}))De.call(u,s)&&te(g,s,u[s]);if(ee)for(var s of ee(u))Fe.call(u,s)&&te(g,s,u[s]);return g},oe=(g,u)=>Pe(g,We(u));var R=(g,u,s)=>new Promise((d,B)=>{var N=h=>{try{m(s.next(h))}catch(S){B(S)}},k=h=>{try{m(s.throw(h))}catch(S){B(S)}},m=h=>h.done?d(h.value):Promise.resolve(h.value).then(N,k);m((s=s.apply(g,u)).next())});import{_ as He}from"./PageWrapper.vue_vue_type_style_index_0_lang-2smqrgtP.js";import{a7 as p,aJ as L,at as O,bW as Ue,H as je,y as v,bX as Ae,aL as Ke,aG as Oe,aM as Ze,a8 as y,a9 as l,aa as o,u as n,aE as le,av as Ge,aZ as Je,aO as C,aI as x,ax as ae,aD as A,am as K,aN as se,aC as Qe,aT as Xe,bY as Ye,an as qe,aK as et,bZ as tt,b_ as nt,b$ as ot,bo as lt,aQ as at,c0 as st,A as ie,bx as re,ay as it,as as ce,ar as ue,c1 as rt,aS as ct,bR as ut,c2 as pt,c3 as dt}from"./vendor-kg4oYVSQ.js";import{c as _t,a as gt,_ as mt,d as ft}from"./index-mGrCK8oI.js";import{g as vt,f as yt,s as ht,_ as kt}from"./socket-O8P-LtvM.js";import{I as $}from"./Icon-eeVwxkbq.js";import{_ as bt}from"./index.vue_vue_type_style_index_0_lang-c-2lX1Tq.js";import wt from"./selectFile-b9ky6cuz.js";import{u as xt}from"./useAppInject-l82YhPHr.js";import{u as $t}from"./useTransition-GfIN44Ja.js";import{s as zt,a as Ct}from"./file-T6C44nTG.js";import"./sharp-arrow-back-ios-r99876JW.js";import"./useDesign-Tg9gUwPG.js";import"./propTypes-e0b5J7qR.js";import"./search2-line-aL20cOYj.js";import"./index-QxLtsnzB.js";import"./folderEmpty-6rfjvt8J.js";import"./filePrefix-aegAgnbp.js";const Rt={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},St=O("path",{fill:"currentColor",d:"M13 19.3v-6.7l6-3.4V13c.7 0 1.4.1 2 .4V7.5c0-.4-.2-.7-.5-.9l-7.9-4.4c-.2-.1-.4-.2-.6-.2s-.4.1-.6.2L3.5 6.6c-.3.2-.5.5-.5.9v9c0 .4.2.7.5.9l7.9 4.4c.2.1.4.2.6.2s.4-.1.6-.2l.9-.5c-.3-.6-.4-1.3-.5-2M12 4.2l6 3.3l-2 1.1l-5.9-3.4zm-1 15.1l-6-3.4V9.2l6 3.4zm1-8.5L6 7.5l2-1.2l6 3.5zm8 4.2v3h3v2h-3v3h-2v-3h-3v-2h3v-3z"},null,-1),Tt=[St];function Et(g,u){return p(),L("svg",Rt,[...Tt])}const It={name:"mdi-package-variant-closed-plus",render:Et},Lt={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Bt=O("path",{fill:"currentColor",d:"M8.27 3L3 8.27v7.46L8.27 21h7.46C17.5 19.24 21 15.73 21 15.73V8.27L15.73 3M9.1 5h5.8L19 9.1v5.8L14.9 19H9.1L5 14.9V9.1m6 5.9h2v2h-2zm0-8h2v6h-2z"},null,-1),Nt=[Bt];function Vt(g,u){return p(),L("svg",Lt,[...Nt])}const Mt={name:"mdi-alert-octagon-outline",render:Vt},Pt={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Wt=Ue('<g stroke="currentColor"><circle cx="12" cy="12" r="9.5" fill="none" stroke-linecap="round" stroke-width="3"><animate attributeName="stroke-dasharray" calcMode="spline" dur="1.5s" keySplines="0.42,0,0.58,1;0.42,0,0.58,1;0.42,0,0.58,1" keyTimes="0;0.475;0.95;1" repeatCount="indefinite" values="0 150;42 150;42 150;42 150"></animate><animate attributeName="stroke-dashoffset" calcMode="spline" dur="1.5s" keySplines="0.42,0,0.58,1;0.42,0,0.58,1;0.42,0,0.58,1" keyTimes="0;0.475;0.95;1" repeatCount="indefinite" values="0;-16;-59;-59"></animate></circle><animateTransform attributeName="transform" dur="2s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"></animateTransform></g>',1),Dt=[Wt];function Ft(g,u){return p(),L("svg",Pt,[...Dt])}const Ht={name:"svg-spinners-ring-resize",render:Ft},Ut={key:1},jt=je({__name:"index",setup(g){const{message:u}=_t(),{getIsMobile:s}=xt(),{t:d}=gt(),B=v("fade-slide");$t(B);const N=v(),k=v({}),m=v({});let h=null;const S=v(""),V=v(!s.value),M=v(s.value?"on":"off"),D=v(!1),T=v(s.value?13:15),f=v([]),w=v({}),z=v(""),P=v(!1),_=v(null),W=t=>R(this,null,function*(){switch(t){case"findBox":D.value=!D.value;break;case"wordWrap":M.value=M.value==="on"?"off":"on";break;case"minimap":V.value=!V.value;break;case"showEditorShortcutsInfo":n(k.value)[`editor-${_.value.key}`].showShortCuts();break}}),pe=t=>{switch(t.item.label){case"1":be();break}},Z=()=>R(this,null,function*(){var t;try{(t=N.value)==null||t.open()}catch(e){}}),de=t=>{if(!_.value)return;const e=_.value.key;t!==e&&(w.value[e].content=n(k.value)[`editor-${e}`].getValue())},F=t=>{f.value.forEach(e=>{e.key===t&&(e.log.runEnd&&!e.log.isRunning&&(e.log.runEnd=!1),e.log.hasNew=!1,z.value=t,_.value=e,delete _.value.children)}),setTimeout(ke,800)},_e=t=>{f.value.forEach((e,r)=>{e.key===t&&(f.value.splice(r,1),delete w.value[e.key],delete k.value[`editor-${e.key}`],f.value.length>0?z.value===t&&F(f.value[f.value.length-1].key):(Q("content"),J(e.key)))})},ge=t=>{de(t),F(t)},me=t=>{_e(t.value)},fe=()=>K($,{size:24,icon:_.value.log.isRunning?"mdi:bug-stop-outline":"mdi:bug-play-outline",style:"margin-top: 4px"},{}),ve=()=>K($,{size:24,icon:"tabler:settings-code",style:"margin-top: 4px"},{}),ye=()=>K($,{size:20,icon:"mdi:application-cog-outline",style:"margin-top: 6px"},{}),he=t=>R(this,null,function*(){f.value.find(r=>r.key===t.key)||(yield we(t.key,t.language),f.value.push(oe(ne({},t),{log:{content:"",newContent:"",id:"",runEnd:!1,isRunning:!1,hasNew:!1,env:[],option:[],isLogReachBottom:!0}}))),F(t.key)}),ke=()=>{ie().then(()=>{var e,r;const t=_.value;if(m.value&&m.value[`log-${t.key}`]&&((e=m.value[`log-${t.key}`].scrollbarRef)!=null&&e.containerRef)){const i=(r=m.value[`log-${t.key}`].scrollbarRef)==null?void 0:r.containerRef;i.removeEventListener("scroll",G),i.addEventListener("scroll",G)}})},G=Ae(t=>{const e=_.value;if(m.value&&m.value[`log-${e.key}`]){const r=m.value[`log-${e.key}`].$el.clientHeight,i=t.target.scrollTop,c=t.target.scrollHeight;e.log.isLogReachBottom=r+i>=c-10}},500),be=()=>R(this,null,function*(){const t=_.value;let e;if(t.log.isRunning)e=`task stop ${t.key}`,yield ht({path:t.key}),t.log.isRunning=!1;else{e=`task run ${t.key}`;const r=t.log.option.filter(c=>c.key).map(c=>c.value?`${c.key} ${c.value}`:`${c.key}`).join(" ");r&&(e=`${e} ${r}`),e=`${e} --no-log`;const i=t.log.env.filter(c=>c.key).map(c=>`envm edit ${c.key} ${c.value||"''"}`).join(" ; ");i&&(e=`${i} >/dev/null 2>&1 ; ${e}`);try{const c=t.key,E=n(k.value)[`editor-${t.key}`].getValue();yield zt({content:E,path:c}),w.value[c]&&(w.value[c].content=E),t.log.content="",t.log.isRunning=!0,t.log.id=yield yt({cmd:e}),t.log.runEnd=!0}catch(c){}finally{}}}),we=(t,e)=>R(this,null,function*(){S.value=e||"plaintext",P.value=!0;try{const r=yield Ct({path:encodeURI(t)});P.value=!1,r?w.value[t]={content:r,language:e}:(w.value[t]={content:"",language:e},u.info(d("page.script.fileContentIsEmptyMsg")))}catch(r){Q("content")}finally{P.value=!1}}),J=t=>{k.value[`editor-${t}`]&&(k.value[`editor-${t}`].dispose(),delete n(k.value)[`editor-${t}`])},Q=t=>{switch(t){case"content":_.value=null,z.value="";break}};return Ke(()=>{h=vt(),h==null||h.off("runLog").on("runLog",({code:t,result:e={}})=>{const r=_.value;!r||!r.log||(f.value.forEach(i=>{e.runId===i.log.id&&(i.log.content+=e.log||"",i.log.isRunning=!!t,e.over&&(i.log.isRunning=!1,i.log.id=""),i.key!==r.key&&(i.log.hasNew=!0))}),Oe(()=>{const i=_.value;i.log.content&&ie().then(()=>{i.log.isLogReachBottom&&m.value&&m.value[`log-${i.key}`]&&m.value[`log-${i.key}`].scrollTo({position:"bottom",silent:!0})})}))})}),Ze(()=>{f.value.length>0&&J(f.value[0].key)}),(t,e)=>{const r=Ht,i=se,c=kt,E=se,xe=rt,b=Qe,$e=ct,ze=mt,Ce=ut,Re=Mt,X=Xe,Se=pt,Te=dt,Ee=Ye,Ie=It,I=qe,H=et,U=tt,Y=nt,q=ot,Le=lt,Be=at,Ne=st,Ve=He;return p(),y(Ve,{ref:"pageWrapper","content-full":"","no-header":""},{default:l(()=>[o(H,{bordered:!n(s),class:"tab-panel",style:{height:"100%","word-break":"unset"},"content-style":"padding: 0; height: 100%"},{default:l(()=>[n(f).length>0?(p(),y(Ee,{key:0,value:n(z),"onUpdate:value":e[0]||(e[0]=a=>le(z)?z.value=a:null),"drag-sort":"",style:{height:"100%",width:"100%",display:"flex","flex-direction":"column"},theme:"card",addable:n(f).length>0,onChange:ge,onAdd:e[1]||(e[1]=a=>Z()),onRemove:me},{default:l(()=>[(p(!0),L(Je,null,Ge(n(f),a=>(p(),y(Te,{key:a.key,value:a.key,removable:"",style:{height:"100%",width:"100%",padding:"0"},"destroy-on-hide":!1},{label:l(()=>[n(s)?(p(),y(b,{key:1,style:{gap:"4px"}},{default:l(()=>[o(E,{size:16},{default:l(()=>[(p(),y(re(a.icon),{style:{"vertical-align":"-0.3em"}}))]),_:2},1024),C(" "+x(a.label),1)]),_:2},1024)):(p(),y($e,{key:0,placement:"top",trigger:"hover",delay:1e3},{trigger:l(()=>[o(b,{style:{gap:"4px"}},{default:l(()=>[a.log.isRunning?(p(),y(i,{key:0,size:16},{default:l(()=>[o(r,{style:{"vertical-align":"-0.3em"}})]),_:1})):(p(),L("div",Ut,[a.log.runEnd?(p(),y(i,{key:0,size:16},{default:l(()=>[o(c,{style:{color:"var(--app-success-color)","vertical-align":"-0.3em"}})]),_:1})):(p(),y(E,{key:1,size:16},{default:l(()=>[(p(),y(re(a.icon),{style:{"vertical-align":"-0.3em"}}))]),_:2},1024))])),C(" "+x(a.label)+" ",1),a.log.hasNew?(p(),y(xe,{key:2,dot:"",offset:[2,-1]})):A("",!0)]),_:2},1024)]),default:l(()=>[O("span",null,x(a.key),1)]),_:2},1024))]),default:l(()=>[o(it,{name:"fade",mode:"out-in",appear:""},{default:l(()=>[o(Se,{direction:n(s)?"vertical":"horizontal","default-size":.7,max:1,min:0},{1:l(()=>[o(bt,{ref_for:!0,ref:j=>n(k)[`editor-${a.key}`]=j,style:{height:"100%",padding:"0","z-index":"999999"},value:{content:n(w)[a.key].content,language:n(w)[a.key].language},"word-wrap":n(M),minimap:n(V),"font-size":n(T),"find-box":n(D)},null,8,["value","word-wrap","minimap","font-size","find-box"]),o(ze,{show:n(P)},null,8,["show"])]),2:l(()=>[ue(o(Ce,{ref_for:!0,ref:j=>n(m)[`log-${a.key}`]=j,log:a.log.content,"font-size":n(T),"line-height":1.5,language:"naive-log",style:ae({padding:n(s)?"1em 0.6em":"1em 0 1em 1.6em",width:"100%",height:"100%"})},null,8,["log","font-size","style"]),[[ce,a.log.content]]),ue(o(X,{class:"min-h-200px flex-jc-ac h-full",size:"huge","show-description":!0,description:n(d)("page.script.noLog")},{icon:l(()=>[o(i,null,{default:l(()=>[o(Re)]),_:1})]),_:2},1032,["description"]),[[ce,!a.log.content]])]),_:2},1032,["direction"])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["value","addable"])):(p(),y(X,{key:1,class:"min-h-200px flex-jc-ac h-full",size:"huge","show-icon":!1,"show-description":!1},{extra:l(()=>[o(I,{block:"",strong:"",size:"large",type:"primary",secondary:"",focusable:!1,style:{"border-radius":"6px",height:"160px",width:"160px"},onClick:e[2]||(e[2]=a=>Z())},{default:l(()=>[o(b,{vertical:"",style:{gap:"20px"}},{default:l(()=>[o(i,{size:60},{default:l(()=>[o(Ie,{style:{"vertical-align":"baseline"}})]),_:1}),C(" "+x(n(d)("page.script.createWorkspace")),1)]),_:1})]),_:1})]),_:1}))]),_:1},8,["bordered"]),n(z)?(p(),y(Ne,{key:0,class:"sticky-tool",type:"compact",shape:"round",style:ae(n(s)?"right: 14px; bottom: 14px":"right: 24px; bottom: 24px"),"on-click":pe},{default:l(()=>[o(U,{icon:fe,label:"1",popup:n(_).log.isRunning?n(d)("page.script.stopBtn"):n(d)("page.script.runBtn")},null,8,["popup"]),o(U,{icon:ve,label:"2","popup-props":{trigger:n(s)?"click":"hover",placement:n(s)?"top":"left-bottom",overlayInnerStyle:{padding:"0"}}},{popup:l(()=>[o(H,{bordered:!1,style:{width:"100%",height:"100%"},"content-style":"width: 100%; height: 100%; padding: 12px"},{default:l(()=>[o(Le,{type:"segment",style:{"min-width":"260px"}},{default:l(()=>[o(q,{name:"1",tab:n(d)("page.script.optionConfig")},{default:l(()=>[o(Y,{value:n(_).log.option,"onUpdate:value":e[3]||(e[3]=a=>n(_).log.option=a),preset:"pair","show-sort-button":"","key-placeholder":n(d)("file.run.form.paramKeyPlaceholder"),"value-placeholder":n(d)("file.run.form.paramValuePlaceholder")},null,8,["value","key-placeholder","value-placeholder"])]),_:1},8,["tab"]),o(q,{name:"2",tab:n(d)("page.script.envConfig")},{default:l(()=>[o(Y,{value:n(_).log.env,"onUpdate:value":e[4]||(e[4]=a=>n(_).log.env=a),preset:"pair","show-sort-button":"","key-placeholder":n(d)("file.run.form.paramKeyPlaceholder"),"value-placeholder":n(d)("file.run.form.paramValuePlaceholder")},null,8,["value","key-placeholder","value-placeholder"])]),_:1},8,["tab"])]),_:1})]),_:1})]),_:1},8,["popup-props"]),o(U,{icon:ye,label:"3","popup-props":{trigger:n(s)?"click":"hover",placement:"left-bottom",overlayInnerStyle:{padding:"0"}}},{popup:l(()=>[o(H,{bordered:!1,style:{width:"100%",height:"100%"},"content-style":"width: 100%; height: 100%; padding: 8px"},{default:l(()=>[o(b,{vertical:"",style:{width:"100%"}},{default:l(()=>[o(b,{size:"small"},{default:l(()=>[o($,{size:20,icon:"ri:font-size",style:{"vertical-align":"-0.4em"}}),o(Be,{value:n(T),"onUpdate:value":e[5]||(e[5]=a=>le(T)?T.value=a:null),min:12,max:40,"button-placement":"both",size:"small",class:"max-w-94px",style:{"text-align":"center"}},null,8,["value"])]),_:1}),o(b,{size:"small"},{default:l(()=>[o($,{size:20,icon:"mdi:find-replace",style:{"vertical-align":"-0.4em"}}),o(I,{size:"small",strong:"",tertiary:"",style:{width:"94px"},onClick:e[6]||(e[6]=a=>W("findBox"))},{default:l(()=>[C(x(n(d)("editor.switch.findBtn")),1)]),_:1})]),_:1}),o(b,{size:"small"},{default:l(()=>[o($,{size:20,color:n(M)==="on"?"var(--app-primary-color)":void 0,icon:"ant-design:swap-outlined",style:{"vertical-align":"-0.4em"}},null,8,["color"]),o(I,{size:"small",strong:"",tertiary:"",style:{width:"94px"},onClick:e[7]||(e[7]=a=>W("wordWrap"))},{default:l(()=>[C(x(n(d)("editor.switch.wordWrapBtn")),1)]),_:1})]),_:1}),o(b,{size:"small"},{default:l(()=>[o($,{size:20,color:n(V)?"var(--app-primary-color)":void 0,icon:"mdi:map-outline",style:{"vertical-align":"-0.4em"}},null,8,["color"]),o(I,{size:"small",strong:"",tertiary:"",style:{width:"94px"},onClick:e[8]||(e[8]=a=>W("minimap"))},{default:l(()=>[C(x(n(d)("editor.switch.minimapBtn")),1)]),_:1})]),_:1}),n(s)?A("",!0):(p(),y(b,{key:0,size:"small"},{default:l(()=>[o($,{size:20,icon:"gg:shortcut",style:{"vertical-align":"-0.4em"}}),o(I,{size:"small",strong:"",tertiary:"",style:{width:"94px"},onClick:e[9]||(e[9]=a=>W("showEditorShortcutsInfo"))},{default:l(()=>[C(x(n(d)("editor.switch.viewShortcuts")),1)]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1},8,["popup-props"])]),_:1},8,["style"])):A("",!0),o(wt,{ref_key:"selectFileComponent",ref:N,onOnConfirmSelect:he},null,512)]),_:1},512)}}}),cn=ft(jt,[["__scopeId","data-v-179023b5"]]);export{cn as default};
