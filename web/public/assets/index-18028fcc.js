import{a6 as i,as as I,aG as p,a7 as g,a8 as t,ac as o,aJ as h,G as Ze,x as r,C as Fe,aI as Oe,u as e,aQ as y,aC as w,aD as C,aK as de,aE as X,al as _,y as pe,be as Se,am as Ae,aN as He,b3 as We,bk as je,a$ as Ve,bl as Ge,ba as Je,bm as Ue,bn as Qe,bF as Xe,bp as Ye,aR as Ke,bq as et,aH as tt}from"./vendor-b0543d82.js";import{_ as nt}from"./PageWrapper.vue_vue_type_style_index_0_lang-6aa3ce87.js";import{k as _e,j as ot,f as ge,a as lt,g as at,e as st,_ as rt,b as it,c as ct,d as ut}from"./folderOpen-f78fffb3.js";import{_ as dt}from"./search2-line-89ae1f05.js";import{_ as pt}from"./map-outline-c921f3be.js";import{d as me,a as Y,b as fe,_ as _t,f as gt}from"./delete-ec71c281.js";import{_ as ve,c as mt,b as ft,L as j,k as he}from"./index-7ca99342.js";import{u as ht}from"./useAppInject-556e31df.js";import{u as vt}from"./useTransition-d423da33.js";import{F as yt}from"./fileTreeEnum-8c192873.js";import"./sharp-arrow-back-ios-357f60fd.js";import"./useDesign-94a763ab.js";import"./propTypes-8a448afd.js";import"./trash-81298888.js";const bt={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},kt=p("path",{fill:"currentColor",d:"m12 16l4-4l-1.4-1.4l-1.6 1.6V8h-2v4.2l-1.6-1.6L8 12l4 4Zm0 6q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22Zm0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20Zm0-8Z"},null,-1),wt=[kt];function Tt(R,c){return i(),I("svg",bt,wt)}const xt={name:"material-symbols-arrow-circle-down-outline",render:Tt},Ct={};function $t(R,c){const V=xt,v=h;return i(),g(v,null,{default:t(()=>[o(V,{style:{"vertical-align":"baseline"}})]),_:1})}const Dt=ve(Ct,[["render",$t]]),qt={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Lt=p("path",{fill:"currentColor",d:"M12 20q-3.35 0-5.675-2.325T4 12q0-3.35 2.325-5.675T12 4q1.725 0 3.3.712T18 6.75V5q0-.425.288-.713T19 4q.425 0 .713.288T20 5v5q0 .425-.288.713T19 11h-5q-.425 0-.713-.288T13 10q0-.425.288-.713T14 9h3.2q-.8-1.4-2.188-2.2T12 6Q9.5 6 7.75 7.75T6 12q0 2.5 1.75 4.25T12 18q1.7 0 3.113-.863t2.187-2.312q.2-.35.563-.487t.737-.013q.4.125.575.525t-.025.75q-1.025 2-2.925 3.2T12 20Z"},null,-1),Mt=[Lt];function Nt(R,c){return i(),I("svg",qt,Mt)}const Rt={name:"material-symbols-refresh-rounded",render:Nt},zt={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Pt=p("path",{fill:"currentColor",d:"m18.031 16.617l4.283 4.282l-1.415 1.415l-4.282-4.283A8.96 8.96 0 0 1 11 20c-4.968 0-9-4.032-9-9s4.032-9 9-9s9 4.032 9 9a8.96 8.96 0 0 1-1.969 5.617Zm-2.006-.742A6.977 6.977 0 0 0 18 11c0-3.867-3.133-7-7-7s-7 3.133-7 7s3.133 7 7 7a6.977 6.977 0 0 0 4.875-1.975l.15-.15ZM10 10V7h2v3h3v2h-3v3h-2v-3H7v-2h3Z"},null,-1),It=[Pt];function Bt(R,c){return i(),I("svg",zt,It)}const Et={name:"ri-zoom-in-line",render:Bt},Zt={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Ft=p("path",{fill:"currentColor",d:"m18.031 16.617l4.283 4.282l-1.415 1.415l-4.282-4.283A8.96 8.96 0 0 1 11 20c-4.968 0-9-4.032-9-9s4.032-9 9-9s9 4.032 9 9a8.96 8.96 0 0 1-1.969 5.617Zm-2.006-.742A6.977 6.977 0 0 0 18 11c0-3.867-3.133-7-7-7s-7 3.133-7 7s3.133 7 7 7a6.977 6.977 0 0 0 4.875-1.975l.15-.15ZM7 10h8v2H7v-2Z"},null,-1),Ot=[Ft];function St(R,c){return i(),I("svg",Zt,Ot)}const At={name:"ri-zoom-out-line",render:St},Ht={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Wt=p("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[p("path",{d:"M21 12V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h7.5M16 2v4M8 2v4m-5 4h18"}),p("path",{d:"M18 21a3 3 0 1 0 0-6a3 3 0 0 0 0 6v0Zm4 1l-1.5-1.5"})],-1),jt=[Wt];function Vt(R,c){return i(),I("svg",Ht,jt)}const Gt={name:"lucide-calendar-search",render:Vt},Jt={class:"pb-1 mr-3"},Ut={class:"pb-1 mr-3"},Qt=Ze({__name:"index",setup(R){const{message:c,confirm:V}=mt(),{getIsMobile:v}=ht(),{t:a}=ft(),G=r("fade-slide");vt(G);const J=r([]),$=r(""),f=r(""),ye=r(),B=r(!v.value),E=r(v.value?"on":"off"),Z=r(null),D=r(v.value?13:15),z=r(null),K=r([]),ee=r(0),te=r(0),T=r(!1),F=r(!1),O=r(!1),U=r(void 0),S=r(!0),A=r(!1),Q=r(!1),H=r(!1),b=r(null),k=r(null),m=async l=>{switch(l){case"bottom":Z.value?.scrollTo({position:"bottom",slient:!0});break;case"changeToEditor":T.value=!T.value,T.value&&c.info(a("editor.switch.changeToEditorMsg"));break;case"showDateTimeRangePicker":O.value=!O.value;break;case"clickRightClickMenu":F.value=!1;break;case"exitRightClickMenu":F.value=!1,q("rightClickMenu");break;case"enlarge":D.value<24?D.value+=1:D.value===24&&c.info(a("page.runLog.enlargeMaxMsg"));break;case"narrow":D.value>12?D.value-=1:D.value===12&&c.info(a("page.runLog.narrowMinMsg"));break;case"refresh":if(Q.value=!0,b.value){const L=f.value;le(b.value.key),L===f.value?c.info(a("page.runLog.logContentIsLatestMsg")):pe(()=>{Z.value?.scrollTo({position:"bottom",slient:!0})})}W(),Q.value=!1;break;case"wordWrap":E.value=E.value==="on"?"off":"on";break;case"minimap":B.value=!B.value;break;case"requireJump":if(H.value)return;H.value=!0,setTimeout(()=>{H.value=!1},1e3);break;case"delete":const n=k.value?k.value.key:b.value.key;V.error({title:a("file.delete.title"),content:a("file.delete.confirm"),icon:()=>_(h,null,{default:()=>_(Y)}),closable:!1,maskClosable:!1,autoFocus:!1,positiveText:a("file.delete.button"),onPositiveClick:async()=>{try{await ot({path:n}),c.success(a("file.delete.success")),b.value&&b.value.key===n&&(q("log"),q("content"),T.value=!1),W()}catch{}finally{q("rightClickMenu")}},onNegativeClick:()=>{q("rightClickMenu")},negativeButtonProps:{ghost:!1,tertiary:!0}});break;case"download":const u=k.value?k.value.key:b.value.key,s=k.value?k.value.label:b.value.label,P=k.value?k.value.isDir:b.value.isDir,x=c.loading(a("file.download.wait"),{duration:0});try{if(P){const{code:L,message:M,blob:N}=await _e({path:u});x.destroy(),L?(c.success(a("file.download.success")),N&&fe(N,`${s}.zip`)):M&&c.error(M)}else{const{code:L,message:M,blob:N}=await _e({path:u});x.destroy(),L?(c.success(a("file.download.success")),N&&fe(N,`${s}.log`)):M&&c.error(M)}}catch{x.destroy(),c.error(a("file.download.fail"),{keepAliveOnHover:!0})}finally{q("rightClickMenu")}break}},be={[a("page.runLog.dateTimePicker.today")]:()=>{const l=new Date().getTime();return[new Date().setHours(0,0,0,0),l]},[a("page.runLog.dateTimePicker.thisWeek")]:()=>{const l=new Date().getTime(),n=new Date().setHours(0,0,0,0),u=new Date().getDay();return[n-(u-1)*24*60*60*1e3,l]},[a("page.runLog.dateTimePicker.last2Hours")]:()=>{const l=new Date().getTime();return[l-2*60*60*1e3,l]},[a("page.runLog.dateTimePicker.last24Hours")]:()=>{const l=new Date().getTime();return[l-24*60*60*1e3,l]}},ke=l=>l>Date.now(),we=l=>{l||c.info(a("page.runLog.needSelectDateTimeRangeMsg"))},Te=l=>_(y,{placement:"right",delay:800,duration:500,style:{width:"max-content",fontSize:"12px"}},{trigger:()=>[l.option.label],default:()=>l.option.key}),ne=({option:l})=>({onClick(){!l.children&&!l.disabled&&(U.value=!0,le(l.key),pe(()=>{Z.value?.scrollTo({position:"top",slient:!0})}),b.value=l)},onContextmenu(n){v.value||(K.value=Ce(),F.value=!0,ee.value=n.clientX,te.value=n.clientY,n.preventDefault()),k.value=l}}),oe=(l,n,u)=>{if(u.node)switch(u.action){case"expand":u.node.prefix=()=>_(h,null,{default:()=>_(lt)});break;case"collapse":u.node.prefix=()=>_(h,null,{default:()=>_(ge)});break}},xe=l=>{const n=u=>{u.length&&u.forEach(s=>{if(s.type===0)Object.assign(s,{key:s.path,label:s.title,isDir:!0,prefix:()=>_(h,null,{default:()=>_(ge)})}),n(s.children),s.children.length||(Object.assign(s,{children:null,disabled:!0}),s.prefix=()=>_(h,null,{default:()=>_(gt)}));else{const P=s.name.replace(".log","");P&&Object.assign(s,{key:s.path,label:P,isDir:!1,prefix:()=>_(h,null,{default:()=>_(ut)})})}})};return n(l),l},W=async()=>{S.value=!0;const l=Array.isArray(z.value)?z.value:[],n=l[0]?he(l[0]):"",u=l[1]?he(l[1]):"",s=await at({type:yt.LOG,startTime:n,endTime:u});J.value=xe(s),S.value=!1},le=async l=>{A.value=!0;const n=encodeURI(l),u=await st({path:n});A.value=!1,u?f.value=u:(q("log"),c.info(a("page.runLog.logContentIsEmptyMsg")))},Ce=()=>{const l={download:{label:a("file.download.button"),key:"download",icon:()=>_(h,null,{default:()=>_(me)}),props:{onClick:()=>{m("download")}}},delete:{label:()=>_(Se,{style:{color:"var(--app-error-color)"}},{default:()=>a("file.delete.button")}),key:"delete",icon:()=>_(h,{color:"var(--app-error-color)"},{default:()=>_(Y)}),props:{onClick:()=>{m("delete")}}}};return[l.download,l.delete]},q=l=>{switch(l){case"log":f.value="";break;case"content":b.value=null;break;case"rightClickMenu":k.value=null;break}};return Fe(z,()=>{W()}),Oe(()=>{W()}),(l,n)=>{const u=_t,s=Ae,P=Gt,x=He,L=We,M=pt,N=rt,$e=At,De=Et,qe=Rt,Le=je,ae=dt,se=Ve,re=Ge,Me=Je,ie=Ue,ce=Qe,Ne=Xe,Re=it,ue=Ye,ze=ct,Pe=Ke,Ie=et,Be=tt,Ee=nt;return i(),g(Ee,{ref:"pageWrapper","content-full":!0,title:e(a)("routes.main.page.runLog")},{subtitle:t(()=>[o(x,null,{default:t(()=>[o(x,{style:{gap:"0"}},{default:t(()=>[o(e(y),{placement:"bottom",trigger:"hover",delay:500},{trigger:t(()=>[o(s,{circle:"",strong:"",quaternary:"",size:"small",disabled:!e(f),type:e(T)?"primary":"tertiary",focusable:!1,onClick:n[0]||(n[0]=d=>m("changeToEditor"))},{default:t(()=>[o(u)]),_:1},8,["disabled","type"])]),default:t(()=>[p("span",null,w(e(a)("editor.switch.changeToEditorTips")),1)]),_:1}),e(v)?C("",!0):(i(),g(e(y),{key:0,placement:"bottom",trigger:"hover",delay:500},{trigger:t(()=>[o(s,{circle:"",strong:"",quaternary:"",size:"small",type:e(O)?"primary":"tertiary",focusable:!1,onClick:n[1]||(n[1]=d=>m("showDateTimeRangePicker"))},{default:t(()=>[o(P)]),_:1},8,["type"])]),default:t(()=>[p("span",null,w(e(a)("page.runLog.dateTimeRangeSearchTips")),1)]),_:1}))]),_:1}),e(O)?(i(),g(de,{key:0,name:e(G),mode:"out-in",appear:""},{default:t(()=>[o(L,{value:e(z),"onUpdate:value":n[2]||(n[2]=d=>X(z)?z.value=d:null),size:"small",type:"datetimerange",clearable:"",shortcuts:be,"is-date-disabled":ke,"on-confirm":we},null,8,["value"])]),_:1},8,["name"])):C("",!0)]),_:1})]),extra:t(()=>[o(de,{name:e(G),mode:"out-in",appear:""},{default:t(()=>[o(x,null,{default:t(()=>[e(T)?(i(),g(x,{key:0,style:{gap:"0"}},{default:t(()=>[e(v)?(i(),g(e(y),{key:0,placement:"bottom",trigger:"hover",delay:500},{trigger:t(()=>[o(s,{strong:"",quaternary:"",type:e(B)?"primary":"tertiary",size:"small",focusable:!1,onClick:n[3]||(n[3]=d=>m("minimap"))},{default:t(()=>[o(M)]),_:1},8,["type"])]),default:t(()=>[p("span",null,w(e(a)("editor.switch.minimapTips")),1)]),_:1})):C("",!0),o(e(y),{placement:"bottom",trigger:"hover",delay:500},{trigger:t(()=>[o(s,{strong:"",quaternary:"",size:"small",disabled:!e(f)||!e(T),type:e(E)==="on"?"primary":"tertiary",focusable:!1,onClick:n[4]||(n[4]=d=>m("wordWrap"))},{default:t(()=>[o(N)]),_:1},8,["disabled","type"])]),default:t(()=>[p("span",null,w(e(a)("editor.switch.wordWrapTips")),1)]),_:1})]),_:1})):C("",!0),o(x,{style:{gap:"0"}},{default:t(()=>[o(Le,null,{default:t(()=>[e(f)&&!e(v)?(i(),g(e(y),{key:0,placement:"bottom",trigger:"hover",delay:500},{trigger:t(()=>[o(s,{strong:"",secondary:"",size:"small",focusable:!1,onClick:n[5]||(n[5]=d=>m("download"))},{icon:t(()=>[o(e(me))]),_:1})]),default:t(()=>[p("span",null,w(e(a)("file.download.button")),1)]),_:1})):C("",!0),e(f)?(i(),g(e(y),{key:1,placement:"bottom",trigger:"hover",delay:500},{trigger:t(()=>[o(s,{strong:"",secondary:"",size:"small",focusable:!1,onClick:n[6]||(n[6]=d=>m("delete"))},{icon:t(()=>[o(e(Y))]),_:1})]),default:t(()=>[p("span",null,w(e(a)("file.delete.button")),1)]),_:1})):C("",!0),e(f)&&!e(T)?(i(),g(e(y),{key:2,placement:"bottom",trigger:"hover",delay:500},{trigger:t(()=>[o(s,{strong:"",secondary:"",size:"small",focusable:!1,onClick:n[7]||(n[7]=d=>m("bottom"))},{icon:t(()=>[o(e(Dt))]),_:1})]),default:t(()=>[p("span",null,w(e(a)("file.bottom.button")),1)]),_:1})):C("",!0),e(f)?(i(),g(e(y),{key:3,placement:"bottom",trigger:"hover",delay:500},{trigger:t(()=>[o(s,{strong:"",secondary:"",size:"small",focusable:!1,onClick:n[8]||(n[8]=d=>m("narrow"))},{icon:t(()=>[o(e(h),null,{default:t(()=>[o($e,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:t(()=>[p("span",null,w(e(a)("page.runLog.narrowButtonTips")),1)]),_:1})):C("",!0),e(f)?(i(),g(e(y),{key:4,placement:"bottom",trigger:"hover",delay:500},{trigger:t(()=>[o(s,{strong:"",secondary:"",size:"small",focusable:!1,onClick:n[9]||(n[9]=d=>m("enlarge"))},{icon:t(()=>[o(e(h),null,{default:t(()=>[o(De,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:t(()=>[p("span",null,w(e(a)("page.runLog.enlargeButtonTips")),1)]),_:1})):C("",!0),o(e(y),{placement:"bottom",trigger:"hover",delay:500},{trigger:t(()=>[o(s,{strong:"",secondary:"",size:"small",loading:e(Q),focusable:!1,onClick:n[10]||(n[10]=d=>m("refresh"))},{icon:t(()=>[o(e(h),null,{default:t(()=>[o(qe,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1},8,["loading"])]),default:t(()=>[p("span",null,w(e(a)("page.runLog.refreshButtonTips")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["name"])]),default:t(()=>[o(Be,{bordered:!e(v),style:{height:"100%","word-break":"unset"},"content-style":"padding: 0; height: 100%"},{default:t(()=>[o(Ie,{"has-sider":"",style:{height:"100%"},"content-style":"height: 100%"},{default:t(()=>[e(v)?(i(),g(ce,{key:1,bordered:!1,width:"100%","trigger-style":"margin-right: .75em","collapsed-trigger-style":"margin-right: -0.75em","collapsed-width":0,"show-collapsed-content":!1,"show-trigger":"arrow-circle",collapsed:e(U),"on-update:collapsed":U.value=void 0,"native-scrollbar":!1,"content-style":"display: flex; flex-direction: column; height: 100%; padding: .8em 0 0 .8em",class:"logs-container"},{default:t(()=>[p("div",Ut,[o(se,{value:e($),"onUpdate:value":n[14]||(n[14]=d=>X($)?$.value=d:null),clearable:"",size:"small",style:{"margin-bottom":".5em"},placeholder:e(a)("page.runLog.searchInputPlaceholder")},{prefix:t(()=>[o(ae)]),_:1},8,["value","placeholder"])]),o(ie,{"x-scrollable":"",class:"flex-1 pr-3"},{default:t(()=>[o(re,{"expand-on-click":"","block-line":"","node-props":ne,pattern:e($),data:e(J),"show-irrelevant-nodes":!1,"on-update:expanded-keys":oe,style:{height:"100%","font-size":"16px"}},null,8,["pattern","data"])]),_:1}),o(j,{show:e(S)},null,8,["show"])]),_:1},8,["collapsed","on-update:collapsed"])):(i(),g(ce,{key:0,bordered:"",width:"280","trigger-style":"width: 34px","collapsed-width":0,"show-collapsed-content":!1,"show-trigger":"bar","native-scrollbar":!1,"content-style":"display: flex; flex-direction: column; height: 100%; padding: .8em 0 0 .8em",class:"logs-container"},{default:t(()=>[p("div",Jt,[o(se,{value:e($),"onUpdate:value":n[11]||(n[11]=d=>X($)?$.value=d:null),clearable:"",style:{"margin-bottom":".5em"},placeholder:e(a)("page.runLog.searchInputPlaceholder")},{prefix:t(()=>[o(ae)]),_:1},8,["value","placeholder"])]),o(ie,{"x-scrollable":"",class:"flex-1 pr-3"},{default:t(()=>[o(re,{"expand-on-click":"","block-line":"","node-props":ne,pattern:e($),data:e(J),"render-label":Te,"show-irrelevant-nodes":!1,"on-update:expanded-keys":oe,style:{height:"100%"}},null,8,["pattern","data"]),o(Me,{trigger:"manual",placement:"bottom-start",show:e(F),options:e(K),x:e(ee),y:e(te),onSelect:n[12]||(n[12]=d=>m("clickRightClickMenu")),onClickoutside:n[13]||(n[13]=d=>m("exitRightClickMenu"))},null,8,["show","options","x","y"])]),_:1}),o(j,{show:e(S)},null,8,["show"])]),_:1})),e(f)?(i(),g(ue,{key:2,style:{overflow:"auto"}},{default:t(()=>[e(T)?(i(),g(Re,{key:1,ref_key:"editor",ref:ye,style:{height:"100%",padding:"0"},value:e(f),language:"plaintext","word-wrap":e(E),"font-size":e(D),"read-only":!0,minimap:e(B)},null,8,["value","word-wrap","font-size","minimap"])):(i(),g(Ne,{key:0,ref_key:"logInstRef",ref:Z,log:e(f),loading:e(H),"font-size":e(D),"line-height":1.5,language:"naive-log",style:{padding:"1em 0 1em 1.6em",width:"100%",height:"100%"},onRequireTop:n[15]||(n[15]=d=>m("requireJump")),onRequireBottom:n[16]||(n[16]=d=>m("requireJump"))},null,8,["log","loading","font-size","line-height"])),o(j,{show:e(A)},null,8,["show"])]),_:1})):(i(),g(ue,{key:3},{default:t(()=>[o(Pe,{class:"min-h-200px flex-jc-ac h-full",size:"huge",description:e(a)("common.selectFileEmptyDesc")},{icon:t(()=>[o(e(h),null,{default:t(()=>[o(ze)]),_:1})]),_:1},8,["description"]),o(j,{show:e(A)},null,8,["show"])]),_:1}))]),_:1})]),_:1},8,["bordered"])]),_:1},8,["title"])}}});const pn=ve(Qt,[["__scopeId","data-v-3085d27a"]]);export{pn as default};
