var Ne=Object.defineProperty,Ve=Object.defineProperties;var Me=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var Pe=Object.prototype.hasOwnProperty,We=Object.prototype.propertyIsEnumerable;var te=(m,p,i)=>p in m?Ne(m,p,{enumerable:!0,configurable:!0,writable:!0,value:i}):m[p]=i,ne=(m,p)=>{for(var i in p||(p={}))Pe.call(p,i)&&te(m,i,p[i]);if(ee)for(var i of ee(p))We.call(p,i)&&te(m,i,p[i]);return m},oe=(m,p)=>Ve(m,Me(p));var R=(m,p,i)=>new Promise((_,I)=>{var N=h=>{try{f(i.next(h))}catch(E){I(E)}},k=h=>{try{f(i.throw(h))}catch(E){I(E)}},f=h=>h.done?_(h.value):Promise.resolve(h.value).then(N,k);f((i=i.apply(m,p)).next())});import{_ as De}from"./PageWrapper.vue_vue_type_style_index_0_lang-iCdyxX7_.js";import{a7 as r,aJ as S,at as O,bW as Fe,H as He,y,bX as Ue,aL as je,aG as Ae,aM as Ke,a8 as d,a9 as l,aa as o,u as n,aE as le,av as Oe,aZ as Ze,aO as C,aI as x,ax as ae,aD as D,am as K,aN as Ge,aC as Je,aT as Qe,bY as Xe,an as Ye,aK as qe,bZ as et,b_ as tt,b$ as nt,bo as ot,aQ as lt,c0 as at,A as se,bx as ie,ay as st,as as re,ar as ce,c1 as it,aS as rt,bR as ct,c2 as ut,c3 as pt}from"./vendor-88CfsZ0h.js";import{c as dt,a as _t,_ as gt,d as mt}from"./index-lXlFquMP.js";import{g as ft,f as vt,s as yt,_ as ht}from"./socket-mzc_BQsT.js";import{I as $}from"./Icon-HkSn-y_v.js";import{_ as kt}from"./index.vue_vue_type_style_index_0_lang-HZK011BJ.js";import bt from"./selectFile-5usk6T_k.js";import{u as wt}from"./useAppInject-htw12zLS.js";import{u as xt}from"./useTransition-f93yfBB3.js";import{s as $t,a as zt}from"./file-nlIWw8Qn.js";import"./sharp-arrow-back-ios-T556WsKB.js";import"./useDesign-SmALCiTA.js";import"./propTypes-XBNzJcxe.js";import"./search2-line-EAu5Rnuh.js";import"./index-2ITmi_Ad.js";import"./folderEmpty-kjR0QQdH.js";import"./filePrefix-kRqy0MsR.js";const Ct={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Rt=O("path",{fill:"currentColor",d:"M13 19.3v-6.7l6-3.4V13c.7 0 1.4.1 2 .4V7.5c0-.4-.2-.7-.5-.9l-7.9-4.4c-.2-.1-.4-.2-.6-.2s-.4.1-.6.2L3.5 6.6c-.3.2-.5.5-.5.9v9c0 .4.2.7.5.9l7.9 4.4c.2.1.4.2.6.2s.4-.1.6-.2l.9-.5c-.3-.6-.4-1.3-.5-2M12 4.2l6 3.3l-2 1.1l-5.9-3.4zm-1 15.1l-6-3.4V9.2l6 3.4zm1-8.5L6 7.5l2-1.2l6 3.5zm8 4.2v3h3v2h-3v3h-2v-3h-3v-2h3v-3z"},null,-1),St=[Rt];function Et(m,p){return r(),S("svg",Ct,[...St])}const Tt={name:"mdi-package-variant-closed-plus",render:Et},Lt={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Bt=O("path",{fill:"currentColor",d:"M8.27 3L3 8.27v7.46L8.27 21h7.46C17.5 19.24 21 15.73 21 15.73V8.27L15.73 3M9.1 5h5.8L19 9.1v5.8L14.9 19H9.1L5 14.9V9.1m6 5.9h2v2h-2zm0-8h2v6h-2z"},null,-1),It=[Bt];function Nt(m,p){return r(),S("svg",Lt,[...It])}const Vt={name:"mdi-alert-octagon-outline",render:Nt},Mt={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Pt=Fe('<g stroke="currentColor"><circle cx="12" cy="12" r="9.5" fill="none" stroke-linecap="round" stroke-width="3"><animate attributeName="stroke-dasharray" calcMode="spline" dur="1.5s" keySplines="0.42,0,0.58,1;0.42,0,0.58,1;0.42,0,0.58,1" keyTimes="0;0.475;0.95;1" repeatCount="indefinite" values="0 150;42 150;42 150;42 150"></animate><animate attributeName="stroke-dashoffset" calcMode="spline" dur="1.5s" keySplines="0.42,0,0.58,1;0.42,0,0.58,1;0.42,0,0.58,1" keyTimes="0;0.475;0.95;1" repeatCount="indefinite" values="0;-16;-59;-59"></animate></circle><animateTransform attributeName="transform" dur="2s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"></animateTransform></g>',1),Wt=[Pt];function Dt(m,p){return r(),S("svg",Mt,[...Wt])}const Ft={name:"svg-spinners-ring-resize",render:Dt},Ht={key:1},Ut={key:1},jt=He({__name:"index",setup(m){const{message:p}=dt(),{getIsMobile:i}=wt(),{t:_}=_t(),I=y("fade-slide");xt(I);const N=y(),k=y({}),f=y({});let h=null;const E=y(""),V=y(!i.value),M=y(i.value?"on":"off"),F=y(!1),T=y(i.value?13:15),v=y([]),w=y({}),z=y(""),P=y(!1),g=y(null),W=t=>R(this,null,function*(){switch(t){case"findBox":F.value=!F.value;break;case"wordWrap":M.value=M.value==="on"?"off":"on";break;case"minimap":V.value=!V.value;break;case"showEditorShortcutsInfo":n(k.value)[`editor-${g.value.key}`].showShortCuts();break}}),ue=t=>{switch(t.item.label){case"1":ke();break}},Z=()=>R(this,null,function*(){var t;try{(t=N.value)==null||t.open()}catch(e){}}),pe=t=>{if(!g.value)return;const e=g.value.key;t!==e&&(w.value[e].content=n(k.value)[`editor-${e}`].getValue())},H=t=>{v.value.forEach(e=>{e.key===t&&(e.log.runEnd&&!e.log.isRunning&&(e.log.runEnd=!1),e.log.hasNew=!1,z.value=t,g.value=e,delete g.value.children)}),setTimeout(he,800)},de=t=>{v.value.forEach((e,c)=>{e.key===t&&(v.value.splice(c,1),delete w.value[e.key],delete k.value[`editor-${e.key}`],v.value.length>0?z.value===t&&H(v.value[v.value.length-1].key):(Q("content"),J(e.key)))})},_e=t=>{pe(t),H(t)},ge=t=>{de(t.value)},me=()=>K($,{size:24,icon:g.value.log.isRunning?"mdi:bug-stop-outline":"mdi:bug-play-outline",style:"margin-top: 4px"},{}),fe=()=>K($,{size:24,icon:"tabler:settings-code",style:"margin-top: 4px"},{}),ve=()=>K($,{size:20,icon:"mdi:application-cog-outline",style:"margin-top: 6px"},{}),ye=t=>R(this,null,function*(){v.value.find(c=>c.key===t.key)||(yield be(t.key,t.language),v.value.push(oe(ne({},t),{log:{content:"",newContent:"",id:"",runEnd:!1,isRunning:!1,hasNew:!1,env:[],option:[],isLogReachBottom:!0}}))),H(t.key)}),he=()=>{se().then(()=>{var e,c;const t=g.value;if(f.value&&f.value[`log-${t.key}`]&&((e=f.value[`log-${t.key}`].scrollbarRef)!=null&&e.containerRef)){const s=(c=f.value[`log-${t.key}`].scrollbarRef)==null?void 0:c.containerRef;s.removeEventListener("scroll",G),s.addEventListener("scroll",G)}})},G=Ue(t=>{const e=g.value;if(f.value&&f.value[`log-${e.key}`]){const c=f.value[`log-${e.key}`].$el.clientHeight,s=t.target.scrollTop,u=t.target.scrollHeight;e.log.isLogReachBottom=c+s>=u-10}},500),ke=()=>R(this,null,function*(){const t=g.value;let e;if(t.log.isRunning)e=`task stop ${t.key}`,yield yt({path:t.key}),t.log.isRunning=!1;else{e=`task run ${t.key}`;const c=t.log.option.filter(u=>u.key).map(u=>u.value?`${u.key} ${u.value}`:`${u.key}`).join(" ");c&&(e=`${e} ${c}`),e=`${e} --no-log`;const s=t.log.env.filter(u=>u.key).map(u=>`envm edit ${u.key} ${u.value||"''"}`).join(" ; ");s&&(e=`${s} >/dev/null 2>&1 ; ${e}`);try{const u=t.key,L=n(k.value)[`editor-${t.key}`].getValue();yield $t({content:L,path:u}),w.value[u]&&(w.value[u].content=L),t.log.content="",t.log.isRunning=!0,t.log.id=yield vt({cmd:e}),t.log.runEnd=!0}catch(u){}finally{}}}),be=(t,e)=>R(this,null,function*(){E.value=e||"plaintext",P.value=!0;try{const c=yield zt({path:encodeURI(t)});P.value=!1,c?w.value[t]={content:c,language:e}:(w.value[t]={content:"",language:e},p.info(_("page.script.fileContentIsEmptyMsg")))}catch(c){Q("content")}finally{P.value=!1}}),J=t=>{k.value[`editor-${t}`]&&(k.value[`editor-${t}`].dispose(),delete n(k.value)[`editor-${t}`])},Q=t=>{switch(t){case"content":g.value=null,z.value="";break}};return je(()=>{h=ft(),h==null||h.off("runLog").on("runLog",({code:t,result:e={}})=>{const c=g.value;!c||!c.log||(v.value.forEach(s=>{e.runId===s.log.id&&(s.log.content+=e.log||"",s.log.isRunning=!!t,e.over&&(s.log.isRunning=!1,s.log.id=""),s.key!==c.key&&(s.log.hasNew=!0))}),Ae(()=>{const s=g.value;s.log.content&&se().then(()=>{s.log.isLogReachBottom&&f.value&&f.value[`log-${s.key}`]&&f.value[`log-${s.key}`].scrollTo({position:"bottom",silent:!0})})}))})}),Ke(()=>{v.value.length>0&&J(v.value[0].key)}),(t,e)=>{const c=Ft,s=Ge,u=ht,L=it,b=Je,we=rt,xe=gt,$e=ct,ze=Vt,X=Qe,Ce=ut,Re=pt,Se=Xe,Ee=Tt,B=Ye,U=qe,j=et,Y=tt,q=nt,Te=ot,Le=lt,Be=at,Ie=De;return r(),d(Ie,{ref:"pageWrapper","content-full":"","no-header":""},{default:l(()=>[o(U,{bordered:!n(i),class:"tab-panel",style:{height:"100%","word-break":"unset"},"content-style":"padding: 0; height: 100%"},{default:l(()=>[n(v).length>0?(r(),d(Se,{key:0,value:n(z),"onUpdate:value":e[0]||(e[0]=a=>le(z)?z.value=a:null),"drag-sort":"",style:{height:"100%",width:"100%",display:"flex","flex-direction":"column"},theme:"card",addable:n(v).length>0,onChange:_e,onAdd:e[1]||(e[1]=a=>Z()),onRemove:ge},{default:l(()=>[(r(!0),S(Ze,null,Oe(n(v),a=>(r(),d(Re,{key:a.key,value:a.key,removable:"",style:{height:"100%",width:"100%",padding:"0"},"destroy-on-hide":!1},{label:l(()=>[n(i)?(r(),d(b,{key:1,style:{gap:"4px"}},{default:l(()=>[a.log.isRunning?(r(),d(s,{key:0,size:16},{default:l(()=>[o(c,{style:{"vertical-align":"-0.3em"}})]),_:1})):(r(),S("div",Ut,[a.log.runEnd?(r(),d(s,{key:0,size:16},{default:l(()=>[o(u,{style:{color:"var(--app-success-color)","vertical-align":"-0.3em"}})]),_:1})):(r(),d(s,{key:1,size:16},{default:l(()=>[(r(),d(ie(a.icon),{style:{"vertical-align":"-0.3em"}}))]),_:2},1024))])),C(" "+x(a.label)+" ",1),a.log.hasNew?(r(),d(L,{key:2,dot:"",offset:[2,-1]})):D("",!0)]),_:2},1024)):(r(),d(we,{key:0,placement:"top",trigger:"hover",delay:1e3},{trigger:l(()=>[o(b,{style:{gap:"4px"}},{default:l(()=>[a.log.isRunning?(r(),d(s,{key:0,size:16},{default:l(()=>[o(c,{style:{"vertical-align":"-0.3em"}})]),_:1})):(r(),S("div",Ht,[a.log.runEnd?(r(),d(s,{key:0,size:16},{default:l(()=>[o(u,{style:{color:"var(--app-success-color)","vertical-align":"-0.3em"}})]),_:1})):(r(),d(s,{key:1,size:16},{default:l(()=>[(r(),d(ie(a.icon),{style:{"vertical-align":"-0.3em"}}))]),_:2},1024))])),C(" "+x(a.label)+" ",1),a.log.hasNew?(r(),d(L,{key:2,dot:"",offset:[2,-1]})):D("",!0)]),_:2},1024)]),default:l(()=>[O("span",null,x(a.key),1)]),_:2},1024))]),default:l(()=>[o(st,{name:"fade",mode:"out-in",appear:""},{default:l(()=>[o(Ce,{direction:n(i)?"vertical":"horizontal","default-size":.7,max:1,min:0},{1:l(()=>[o(kt,{ref_for:!0,ref:A=>n(k)[`editor-${a.key}`]=A,style:{height:"100%",padding:"0","z-index":"999999"},value:{content:n(w)[a.key].content,language:n(w)[a.key].language},"word-wrap":n(M),minimap:n(V),"font-size":n(T),"find-box":n(F)},null,8,["value","word-wrap","minimap","font-size","find-box"]),o(xe,{show:n(P)},null,8,["show"])]),2:l(()=>[ce(o($e,{ref_for:!0,ref:A=>n(f)[`log-${a.key}`]=A,log:a.log.content,"font-size":n(T),"line-height":1.5,language:"naive-log",style:ae({padding:n(i)?"1em 0.6em":"1em 0 1em 1.6em",width:"100%",height:"100%"})},null,8,["log","font-size","style"]),[[re,a.log.content]]),ce(o(X,{class:"min-h-200px flex-jc-ac h-full",size:"huge","show-description":!0,description:n(_)("page.script.noLog")},{icon:l(()=>[o(s,null,{default:l(()=>[o(ze)]),_:1})]),_:2},1032,["description"]),[[re,!a.log.content]])]),_:2},1032,["direction"])]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["value","addable"])):(r(),d(X,{key:1,class:"min-h-200px flex-jc-ac h-full",size:"huge","show-icon":!1,"show-description":!1},{extra:l(()=>[o(B,{block:"",strong:"",size:"large",type:"primary",secondary:"",focusable:!1,style:{"border-radius":"6px",height:"160px",width:"160px"},onClick:e[2]||(e[2]=a=>Z())},{default:l(()=>[o(b,{vertical:"",style:{gap:"20px"}},{default:l(()=>[o(s,{size:60},{default:l(()=>[o(Ee,{style:{"vertical-align":"baseline"}})]),_:1}),C(" "+x(n(_)("page.script.createWorkspace")),1)]),_:1})]),_:1})]),_:1}))]),_:1},8,["bordered"]),n(z)?(r(),d(Be,{key:0,class:"sticky-tool",type:"compact",shape:"round",style:ae(n(i)?"right: 14px; bottom: 14px":"right: 24px; bottom: 24px"),"on-click":ue},{default:l(()=>[o(j,{icon:me,label:"1",popup:n(g).log.isRunning?n(_)("page.script.stopBtn"):n(_)("page.script.runBtn")},null,8,["popup"]),o(j,{icon:fe,label:"2","popup-props":{trigger:n(i)?"click":"hover",placement:n(i)?"top":"left-bottom",overlayInnerStyle:{padding:"0"}}},{popup:l(()=>[o(U,{bordered:!1,style:{width:"100%",height:"100%"},"content-style":"width: 100%; height: 100%; padding: 12px"},{default:l(()=>[o(Te,{type:"segment",style:{"min-width":"260px"},animated:""},{default:l(()=>[o(q,{name:"1",tab:n(_)("page.script.optionConfig")},{default:l(()=>[o(Y,{value:n(g).log.option,"onUpdate:value":e[3]||(e[3]=a=>n(g).log.option=a),preset:"pair","show-sort-button":"","key-placeholder":n(_)("file.run.paramKeyPlaceholder"),"value-placeholder":n(_)("file.run.paramValuePlaceholder")},null,8,["value","key-placeholder","value-placeholder"])]),_:1},8,["tab"]),o(q,{name:"2",tab:n(_)("page.script.envConfig")},{default:l(()=>[o(Y,{value:n(g).log.env,"onUpdate:value":e[4]||(e[4]=a=>n(g).log.env=a),preset:"pair","show-sort-button":"","key-placeholder":n(_)("file.run.paramKeyPlaceholder"),"value-placeholder":n(_)("file.run.paramValuePlaceholder")},null,8,["value","key-placeholder","value-placeholder"])]),_:1},8,["tab"])]),_:1})]),_:1})]),_:1},8,["popup-props"]),o(j,{icon:ve,label:"3","popup-props":{trigger:n(i)?"click":"hover",placement:"left-bottom",overlayInnerStyle:{padding:"0"}}},{popup:l(()=>[o(U,{bordered:!1,style:{width:"100%",height:"100%"},"content-style":"width: 100%; height: 100%; padding: 8px"},{default:l(()=>[o(b,{vertical:"",style:{width:"100%"}},{default:l(()=>[o(b,{size:"small"},{default:l(()=>[o($,{size:20,icon:"ri:font-size",style:{"vertical-align":"-0.4em"}}),o(Le,{value:n(T),"onUpdate:value":e[5]||(e[5]=a=>le(T)?T.value=a:null),min:12,max:40,"button-placement":"both",size:"small",class:"max-w-94px",style:{"text-align":"center"}},null,8,["value"])]),_:1}),o(b,{size:"small"},{default:l(()=>[o($,{size:20,icon:"mdi:find-replace",style:{"vertical-align":"-0.4em"}}),o(B,{size:"small",strong:"",tertiary:"",style:{width:"94px"},onClick:e[6]||(e[6]=a=>W("findBox"))},{default:l(()=>[C(x(n(_)("editor.switch.findBtn")),1)]),_:1})]),_:1}),o(b,{size:"small"},{default:l(()=>[o($,{size:20,color:n(M)==="on"?"var(--app-primary-color)":void 0,icon:"ant-design:swap-outlined",style:{"vertical-align":"-0.4em"}},null,8,["color"]),o(B,{size:"small",strong:"",tertiary:"",style:{width:"94px"},onClick:e[7]||(e[7]=a=>W("wordWrap"))},{default:l(()=>[C(x(n(_)("editor.switch.wordWrapBtn")),1)]),_:1})]),_:1}),o(b,{size:"small"},{default:l(()=>[o($,{size:20,color:n(V)?"var(--app-primary-color)":void 0,icon:"mdi:map-outline",style:{"vertical-align":"-0.4em"}},null,8,["color"]),o(B,{size:"small",strong:"",tertiary:"",style:{width:"94px"},onClick:e[8]||(e[8]=a=>W("minimap"))},{default:l(()=>[C(x(n(_)("editor.switch.minimapBtn")),1)]),_:1})]),_:1}),n(i)?D("",!0):(r(),d(b,{key:0,size:"small"},{default:l(()=>[o($,{size:20,icon:"gg:shortcut",style:{"vertical-align":"-0.4em"}}),o(B,{size:"small",strong:"",tertiary:"",style:{width:"94px"},onClick:e[9]||(e[9]=a=>W("showEditorShortcutsInfo"))},{default:l(()=>[C(x(n(_)("editor.switch.viewShortcuts")),1)]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1},8,["popup-props"])]),_:1},8,["style"])):D("",!0),o(bt,{ref_key:"selectFileComponent",ref:N,onOnConfirmSelect:ye},null,512)]),_:1},512)}}}),cn=mt(jt,[["__scopeId","data-v-5ffbaa23"]]);export{cn as default};
