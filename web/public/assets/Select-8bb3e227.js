import{R as Ne,P as oe,b1 as Le,d as We,G as Ee,S as de,dL as $e,r as c,J as N,j as v,cH as Ke,c2 as He,A as Ge,I as Je,bW as Ze,h as y,D as qe,ad as Qe,ap as Xe,cC as re,cD as Ye,d5 as et,Z as g}from"./index-797c0a85.js";import{a as tt,p as L,f as nt,N as lt,c as at}from"./utils-c87a7780.js";import{u as ue,c as W,V as it,j as ot,k as rt}from"./Tooltip-271e10cc.js";import{c as ut,h as se}from"./Empty-aa248199.js";import{u as st}from"./use-locale-3967e664.js";import{N as dt}from"./Selection-a7bafa19.js";const ct=Ne([oe("select",`
 z-index: auto;
 outline: none;
 width: 100%;
 position: relative;
 `),oe("select-menu",`
 margin: 4px 0;
 box-shadow: var(--n-menu-box-shadow);
 `,[Le({originalTransition:"background-color .3s var(--n-bezier), box-shadow .3s var(--n-bezier)"})])]),ft=Object.assign(Object.assign({},de.props),{to:W.propTo,bordered:{type:Boolean,default:void 0},clearable:Boolean,clearFilterAfterSelect:{type:Boolean,default:!0},options:{type:Array,default:()=>[]},defaultValue:{type:[String,Number,Array],default:null},keyboard:{type:Boolean,default:!0},value:[String,Number,Array],placeholder:String,menuProps:Object,multiple:Boolean,size:String,filterable:Boolean,disabled:{type:Boolean,default:void 0},remote:Boolean,loading:Boolean,filter:Function,placement:{type:String,default:"bottom-start"},widthMode:{type:String,default:"trigger"},tag:Boolean,onCreate:Function,fallbackOption:{type:[Function,Boolean],default:void 0},show:{type:Boolean,default:void 0},showArrow:{type:Boolean,default:!0},maxTagCount:[Number,String],consistentMenuWidth:{type:Boolean,default:!0},virtualScroll:{type:Boolean,default:!0},labelField:{type:String,default:"label"},valueField:{type:String,default:"value"},childrenField:{type:String,default:"children"},renderLabel:Function,renderOption:Function,renderTag:Function,"onUpdate:value":[Function,Array],inputProps:Object,nodeProps:Function,ignoreComposition:{type:Boolean,default:!0},showOnFocus:Boolean,onUpdateValue:[Function,Array],onBlur:[Function,Array],onClear:[Function,Array],onFocus:[Function,Array],onScroll:[Function,Array],onSearch:[Function,Array],onUpdateShow:[Function,Array],"onUpdate:show":[Function,Array],displayDirective:{type:String,default:"show"},resetMenuOnOptionsChange:{type:Boolean,default:!0},status:String,showCheckmark:{type:Boolean,default:!0},onChange:[Function,Array],items:Array}),Ot=We({name:"Select",props:ft,setup(n){const{mergedClsPrefixRef:f,mergedBorderedRef:M,namespaceRef:F,inlineThemeDisabled:d}=Ee(n),E=de("Select","-select",ct,$e,n,f),z=c(n.defaultValue),ce=N(n,"value"),T=ue(ce,z),C=c(!1),w=c(""),fe=v(()=>{const{valueField:e,childrenField:t}=n,l=at(e,t);return ut(me.value,l)}),$=v(()=>tt(G.value,n.valueField,n.childrenField)),P=c(!1),h=ue(N(n,"show"),P),s=c(null),K=c(null),R=c(null),{localeRef:he}=st("Select"),ve=v(()=>{var e;return(e=n.placeholder)!==null&&e!==void 0?e:he.value.placeholder}),j=Ke(n,["items","options"]),B=[],m=c([]),b=c([]),I=c(new Map),H=v(()=>{const{fallbackOption:e}=n;if(e===void 0){const{labelField:t,valueField:l}=n;return r=>({[t]:String(r),[l]:r})}return e===!1?!1:t=>Object.assign(e(t),{value:t})}),G=v(()=>b.value.concat(m.value).concat(j.value)),ge=v(()=>{const{filter:e}=n;if(e)return e;const{labelField:t,valueField:l}=n;return(r,i)=>{if(!i)return!1;const a=i[t];if(typeof a=="string")return L(r,a);const o=i[l];return typeof o=="string"?L(r,o):typeof o=="number"?L(r,String(o)):!1}}),me=v(()=>{if(n.remote)return j.value;{const{value:e}=G,{value:t}=w;return!t.length||!n.filterable?e:nt(e,ge.value,t,n.childrenField)}});function U(e){const t=n.remote,{value:l}=I,{value:r}=$,{value:i}=H,a=[];return e.forEach(o=>{if(r.has(o))a.push(r.get(o));else if(t&&l.has(o))a.push(l.get(o));else if(i){const u=i(o);u&&a.push(u)}}),a}const J=v(()=>{if(n.multiple){const{value:e}=T;return Array.isArray(e)?U(e):[]}return null}),Z=v(()=>{const{value:e}=T;return!n.multiple&&!Array.isArray(e)?e===null?null:U([e])[0]||null:null}),_=He(n),{mergedSizeRef:pe,mergedDisabledRef:k,mergedStatusRef:be}=_;function V(e,t){const{onChange:l,"onUpdate:value":r,onUpdateValue:i}=n,{nTriggerFormChange:a,nTriggerFormInput:o}=_;l&&g(l,e,t),i&&g(i,e,t),r&&g(r,e,t),z.value=e,a(),o()}function q(e){const{onBlur:t}=n,{nTriggerFormBlur:l}=_;t&&g(t,e),l()}function Oe(){const{onClear:e}=n;e&&g(e)}function Fe(e){const{onFocus:t,showOnFocus:l}=n,{nTriggerFormFocus:r}=_;t&&g(t,e),r(),l&&A()}function ye(e){const{onSearch:t}=n;t&&g(t,e)}function we(e){const{onScroll:t}=n;t&&g(t,e)}function Q(){var e;const{remote:t,multiple:l}=n;if(t){const{value:r}=I;if(l){const{valueField:i}=n;(e=J.value)===null||e===void 0||e.forEach(a=>{r.set(a[i],a)})}else{const i=Z.value;i&&r.set(i[n.valueField],i)}}}function X(e){const{onUpdateShow:t,"onUpdate:show":l}=n;t&&g(t,e),l&&g(l,e),P.value=e}function A(){k.value||(X(!0),P.value=!0,n.filterable&&ae())}function p(){X(!1)}function Y(){w.value="",b.value=B}const x=c(!1);function Se(){n.filterable&&(x.value=!0)}function Me(){n.filterable&&(x.value=!1,h.value||Y())}function Te(){k.value||(h.value?n.filterable?ae():p():A())}function Ce(e){var t,l;!((l=(t=R.value)===null||t===void 0?void 0:t.selfRef)===null||l===void 0)&&l.contains(e.relatedTarget)||(C.value=!1,q(e),p())}function Re(e){Fe(e),C.value=!0}function Be(e){C.value=!0}function Ae(e){var t;!((t=s.value)===null||t===void 0)&&t.$el.contains(e.relatedTarget)||(C.value=!1,q(e),p())}function Pe(){var e;(e=s.value)===null||e===void 0||e.focus(),p()}function Ie(e){var t;h.value&&(!((t=s.value)===null||t===void 0)&&t.$el.contains(Ye(e))||p())}function _e(e){if(!Array.isArray(e))return[];if(H.value)return Array.from(e);{const{remote:t}=n,{value:l}=$;if(t){const{value:r}=I;return e.filter(i=>l.has(i)||r.has(i))}else return e.filter(r=>l.has(r))}}function ee(e){D(e.rawNode)}function D(e){if(k.value)return;const{tag:t,remote:l,clearFilterAfterSelect:r,valueField:i}=n;if(t&&!l){const{value:a}=b,o=a[0]||null;if(o){const u=m.value;u.length?u.push(o):m.value=[o],b.value=B}}if(l&&I.value.set(e[i],e),n.multiple){const a=_e(T.value),o=a.findIndex(u=>u===e[i]);if(~o){if(a.splice(o,1),t&&!l){const u=te(e[i]);~u&&(m.value.splice(u,1),r&&(w.value=""))}}else a.push(e[i]),r&&(w.value="");V(a,U(a))}else{if(t&&!l){const a=te(e[i]);~a?m.value=[m.value[a]]:m.value=B}le(),p(),V(e[i],e)}}function te(e){return m.value.findIndex(l=>l[n.valueField]===e)}function ke(e){h.value||A();const{value:t}=e.target;w.value=t;const{tag:l,remote:r}=n;if(ye(t),l&&!r){if(!t){b.value=B;return}const{onCreate:i}=n,a=i?i(t):{[n.labelField]:t,[n.valueField]:t},{valueField:o,labelField:u}=n;j.value.some(O=>O[o]===a[o]||O[u]===a[u])||m.value.some(O=>O[o]===a[o]||O[u]===a[u])?b.value=B:b.value=[a]}}function Ve(e){e.stopPropagation();const{multiple:t}=n;!t&&n.filterable&&p(),Oe(),t?V([],[]):V(null,null)}function xe(e){!se(e,"action")&&!se(e,"empty")&&e.preventDefault()}function De(e){we(e)}function ne(e){var t,l,r,i,a;if(!n.keyboard){e.preventDefault();return}switch(e.key){case" ":if(n.filterable)break;e.preventDefault();case"Enter":if(!(!((t=s.value)===null||t===void 0)&&t.isComposing)){if(h.value){const o=(l=R.value)===null||l===void 0?void 0:l.getPendingTmNode();o?ee(o):n.filterable||(p(),le())}else if(A(),n.tag&&x.value){const o=b.value[0];if(o){const u=o[n.valueField],{value:O}=T;n.multiple&&Array.isArray(O)&&O.some(Ue=>Ue===u)||D(o)}}}e.preventDefault();break;case"ArrowUp":if(e.preventDefault(),n.loading)return;h.value&&((r=R.value)===null||r===void 0||r.prev());break;case"ArrowDown":if(e.preventDefault(),n.loading)return;h.value?(i=R.value)===null||i===void 0||i.next():A();break;case"Escape":h.value&&(et(e),p()),(a=s.value)===null||a===void 0||a.focus();break}}function le(){var e;(e=s.value)===null||e===void 0||e.focus()}function ae(){var e;(e=s.value)===null||e===void 0||e.focusInput()}function ze(){var e;h.value&&((e=K.value)===null||e===void 0||e.syncPosition())}Q(),Ge(N(n,"options"),Q);const je={focus:()=>{var e;(e=s.value)===null||e===void 0||e.focus()},focusInput:()=>{var e;(e=s.value)===null||e===void 0||e.focusInput()},blur:()=>{var e;(e=s.value)===null||e===void 0||e.blur()},blurInput:()=>{var e;(e=s.value)===null||e===void 0||e.blurInput()}},ie=v(()=>{const{self:{menuBoxShadow:e}}=E.value;return{"--n-menu-box-shadow":e}}),S=d?Je("select",void 0,ie,n):void 0;return Object.assign(Object.assign({},je),{mergedStatus:be,mergedClsPrefix:f,mergedBordered:M,namespace:F,treeMate:fe,isMounted:Ze(),triggerRef:s,menuRef:R,pattern:w,uncontrolledShow:P,mergedShow:h,adjustedTo:W(n),uncontrolledValue:z,mergedValue:T,followerRef:K,localizedPlaceholder:ve,selectedOption:Z,selectedOptions:J,mergedSize:pe,mergedDisabled:k,focused:C,activeWithoutMenuOpen:x,inlineThemeDisabled:d,onTriggerInputFocus:Se,onTriggerInputBlur:Me,handleTriggerOrMenuResize:ze,handleMenuFocus:Be,handleMenuBlur:Ae,handleMenuTabOut:Pe,handleTriggerClick:Te,handleToggle:ee,handleDeleteOption:D,handlePatternInput:ke,handleClear:Ve,handleTriggerBlur:Ce,handleTriggerFocus:Re,handleKeydown:ne,handleMenuAfterLeave:Y,handleMenuClickOutside:Ie,handleMenuScroll:De,handleMenuKeydown:ne,handleMenuMousedown:xe,mergedTheme:E,cssVars:d?void 0:ie,themeClass:S==null?void 0:S.themeClass,onRender:S==null?void 0:S.onRender})},render(){return y("div",{class:`${this.mergedClsPrefix}-select`},y(it,null,{default:()=>[y(ot,null,{default:()=>y(dt,{ref:"triggerRef",inlineThemeDisabled:this.inlineThemeDisabled,status:this.mergedStatus,inputProps:this.inputProps,clsPrefix:this.mergedClsPrefix,showArrow:this.showArrow,maxTagCount:this.maxTagCount,bordered:this.mergedBordered,active:this.activeWithoutMenuOpen||this.mergedShow,pattern:this.pattern,placeholder:this.localizedPlaceholder,selectedOption:this.selectedOption,selectedOptions:this.selectedOptions,multiple:this.multiple,renderTag:this.renderTag,renderLabel:this.renderLabel,filterable:this.filterable,clearable:this.clearable,disabled:this.mergedDisabled,size:this.mergedSize,theme:this.mergedTheme.peers.InternalSelection,labelField:this.labelField,valueField:this.valueField,themeOverrides:this.mergedTheme.peerOverrides.InternalSelection,loading:this.loading,focused:this.focused,onClick:this.handleTriggerClick,onDeleteOption:this.handleDeleteOption,onPatternInput:this.handlePatternInput,onClear:this.handleClear,onBlur:this.handleTriggerBlur,onFocus:this.handleTriggerFocus,onKeydown:this.handleKeydown,onPatternBlur:this.onTriggerInputBlur,onPatternFocus:this.onTriggerInputFocus,onResize:this.handleTriggerOrMenuResize,ignoreComposition:this.ignoreComposition},{arrow:()=>{var n,f;return[(f=(n=this.$slots).arrow)===null||f===void 0?void 0:f.call(n)]}})}),y(rt,{ref:"followerRef",show:this.mergedShow,to:this.adjustedTo,teleportDisabled:this.adjustedTo===W.tdkey,containerClass:this.namespace,width:this.consistentMenuWidth?"target":void 0,minWidth:"target",placement:this.placement},{default:()=>y(qe,{name:"fade-in-scale-up-transition",appear:this.isMounted,onAfterLeave:this.handleMenuAfterLeave},{default:()=>{var n,f,M;return this.mergedShow||this.displayDirective==="show"?((n=this.onRender)===null||n===void 0||n.call(this),Qe(y(lt,Object.assign({},this.menuProps,{ref:"menuRef",onResize:this.handleTriggerOrMenuResize,inlineThemeDisabled:this.inlineThemeDisabled,virtualScroll:this.consistentMenuWidth&&this.virtualScroll,class:[`${this.mergedClsPrefix}-select-menu`,this.themeClass,(f=this.menuProps)===null||f===void 0?void 0:f.class],clsPrefix:this.mergedClsPrefix,focusable:!0,labelField:this.labelField,valueField:this.valueField,autoPending:!0,nodeProps:this.nodeProps,theme:this.mergedTheme.peers.InternalSelectMenu,themeOverrides:this.mergedTheme.peerOverrides.InternalSelectMenu,treeMate:this.treeMate,multiple:this.multiple,size:"medium",renderOption:this.renderOption,renderLabel:this.renderLabel,value:this.mergedValue,style:[(M=this.menuProps)===null||M===void 0?void 0:M.style,this.cssVars],onToggle:this.handleToggle,onScroll:this.handleMenuScroll,onFocus:this.handleMenuFocus,onBlur:this.handleMenuBlur,onKeydown:this.handleMenuKeydown,onTabOut:this.handleMenuTabOut,onMousedown:this.handleMenuMousedown,show:this.mergedShow,showCheckmark:this.showCheckmark,resetMenuOnOptionsChange:this.resetMenuOnOptionsChange}),{empty:()=>{var F,d;return[(d=(F=this.$slots).empty)===null||d===void 0?void 0:d.call(F)]},action:()=>{var F,d;return[(d=(F=this.$slots).action)===null||d===void 0?void 0:d.call(F)]}}),this.displayDirective==="show"?[[Xe,this.mergedShow],[re,this.handleMenuClickOutside,void 0,{capture:!0}]]:[[re,this.handleMenuClickOutside,void 0,{capture:!0}]])):null}})})]}))}});export{Ot as N};
