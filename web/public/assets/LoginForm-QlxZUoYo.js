var x=(n,c,t)=>new Promise((r,u)=>{var g=d=>{try{h(t.next(d))}catch(k){u(k)}},b=d=>{try{h(t.throw(d))}catch(k){u(k)}},h=d=>d.done?r(d.value):Promise.resolve(d.value).then(g,b);h((t=t.apply(n,c)).next())});import{a7 as I,aJ as L,at as i,y as _,h as w,u as e,cd as K,H as ne,r as oe,D as se,aL as ae,ar as ce,as as le,aa as o,a9 as s,a8 as re,ax as ie,aI as R,aD as ue,aE as de,aO as A,an as F,bn as pe,t as _e,ce as me,am as M,b3 as ge,bK as he,cf as fe,aS as ve,a_ as ye,aC as we,bL as be,bU as ke,bV as Se}from"./vendor-88CfsZ0h.js";import{I as xe}from"./Icon-XSH1pAjx.js";import{a as J,y as Re,c as Ie,z as Ce,T,A as Le,d as $e}from"./index-4T0Diq52.js";import"./propTypes-XBNzJcxe.js";const ze={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Ae=i("g",{fill:"currentColor"},[i("path",{d:"M12 1.932l9 3.375V10c0 4.118-1.62 7.113-3.535 9.074a11.407 11.407 0 0 1-2.915 2.175c-.913.468-1.826.751-2.55.751c-.724 0-1.637-.283-2.55-.75a11.41 11.41 0 0 1-2.915-2.176C4.619 17.113 3 14.118 3 10V5.307l9-3.375zM5 6.693V10c0 3.549 1.38 6.054 2.965 7.676a9.411 9.411 0 0 0 2.397 1.793c.775.397 1.362.531 1.638.531c.276 0 .863-.134 1.638-.53a9.412 9.412 0 0 0 2.397-1.794C17.619 16.054 19 13.55 19 10V6.693l-7-2.625l-7 2.625z"}),i("path",{d:"M15.707 9.293a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 1 1 1.414-1.414L11 12.586l3.293-3.293a1 1 0 0 1 1.414 0z"})],-1),Fe=[Ae];function Me(n,c){return I(),L("svg",ze,[...Fe])}const Te={name:"majesticons-shield-check-line",render:Me},Ue={style:{display:"inline-block"},viewBox:"0 0 1024 1024",width:"1em",height:"1em"},Ve=i("path",{fill:"currentColor",d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32M332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332zm460 600H232V536h560zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 1 0-56 0"},null,-1),De=[Ve];function Be(n,c){return I(),L("svg",Ue,[...De])}const He={name:"ant-design-lock-outlined",render:Be},Ne={style:{display:"inline-block"},viewBox:"0 0 1024 1024",width:"1em",height:"1em"},Oe=i("path",{fill:"currentColor",d:"M858.5 763.6a374 374 0 0 0-80.6-119.5a375.63 375.63 0 0 0-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1c-.4.2-.8.3-1.2.5c-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 0 0-80.6 119.5A371.7 371.7 0 0 0 136 901.8a8 8 0 0 0 8 8.2h60c4.4 0 7.9-3.5 8-7.8c2-77.2 33-149.5 87.8-204.3c56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 0 0 8-8.2c-1-47.8-10.9-94.3-29.5-138.2M512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534"},null,-1),Pe=[Oe];function Ee(n,c){return I(),L("svg",Ne,[...Pe])}const qe={name:"ant-design-user-outlined",render:Ee},G=""+new URL("logo-light-sub-J7zeoRlq.png",import.meta.url).href,j=""+new URL("logo-dark-sub-msJ6asga.png",import.meta.url).href;var W=(n=>(n[n.LOGIN=0]="LOGIN",n[n.RESET_PASSWORD=1]="RESET_PASSWORD",n))(W||{});const V=_(0);function Ke(){function n(r){V.value=r}const c=w(()=>V.value);function t(){n(0)}return{setLoginState:n,getLoginState:c,handleBackLogin:t}}function Ge(n){const c=e(n);if(!c)return;const t=K(),r=K();return c.validate(u=>{u?r.trigger(u):t.trigger(u)}),{onSuccess:t.on,onError:r.on}}function je(){const{t:n}=J(),c=w(()=>U(n("sys.login.needInputUsername"))),t=w(()=>U(n("sys.login.needInputPassword"))),r=w(()=>U(n("sys.login.needInputCaptcha")));return{getFormRules:w(()=>{const g=e(c),b=e(t),h=e(r);switch(e(V)){case 1:return{username:g};default:return{captcha:h,username:g,password:b}}})}}function U(n){return[{required:!0,message:n,trigger:"change"}]}const Je=n=>(ke("data-v-6a2ffb8f"),n=n(),Se(),n),We=["src"],Qe={class:"inline-container"},Xe={class:"left-content"},Ye=Je(()=>i("div",{style:{flex:"0 0 8px"}},null,-1)),Ze={class:"right-content"},et=ne({__name:"LoginForm",setup(n){const{apiUrl:c=""}=Re(),{t}=J(),{notification:r,dialog:u,message:g}=Ie(),b=Ce(),{getLoginState:h}=Ke(),{getFormRules:d}=je(),k=w(()=>e(h)===W.LOGIN),D=_(),m=_(!1),$=_(!0),C=_(!1),B=_(),l=oe({username:"",password:"",captcha:""}),z=_(document.querySelector('meta[name="theme-mode"]').content),H=_(z.value===T.DARK?j:G),N=_("#f2f3f5");new MutationObserver(p=>{for(const a of p)a.type==="attributes"&&a.attributeName==="content"&&(z.value=a.target.content)}).observe(document.querySelector('meta[name="theme-mode"]'),{attributes:!0}),se(z,p=>{H.value=p===T.DARK?j:G,N.value=p===T.DARK?"#ffffff14":"#f2f3f5"}),ae(()=>x(this,null,function*(){yield O()}));function O(){return x(this,null,function*(){const p=yield Le();C.value=p.showCaptcha,C&&P()})}function P(){B.value=`${c}/captcha?w=120&h=48&background=transparent&t=${new Date().getTime()}`}function E(){return x(this,null,function*(){if(!l.username||!l.password){g.error(t("sys.login.needInputAuthentication"),{keepAliveOnHover:!0});return}else if(C.value&&!l.captcha){g.error(t("sys.login.needInputVerification"),{keepAliveOnHover:!0});return}const{onSuccess:p}=Ge(D);p(()=>x(this,null,function*(){try{m.value=!0;const a=yield b.login(_e({username:l.username,password:l.password,captcha:l.captcha,mode:"none"}));if(a){const{lastLoginInfo:f}=a;f&&f.loginTime&&setTimeout(()=>{const S=r==null?void 0:r.create({title:t("sys.login.lastLoginInfoTitle"),content:`${t("sys.login.lastLoginInfoIp")}${f.loginIp||"Unknown"}
${t("sys.login.lastLoginInfoAddress")}${f.loginAddress||"Unknown"}`,meta:f.loginTime||"Unknown",duration:void 0,closable:!1,avatar:()=>M(me,{size:"small",style:"background-color: transparent;"},{default:()=>M(xe,{icon:"mdi:shield-alert-outline",color:"var(--app-primary-color)",style:"vertical-align: baseline"},{})}),action:()=>M(F,{quaternary:!0,type:"primary",size:"small",focusable:!1,onClick:()=>{S.destroy()}},{default:()=>t("sys.login.lastLoginInfoReaded")})})},1300)}}catch(a){u==null||u.error({title:t("sys.login.failTitle"),content:a.message||t("sys.api.networkExceptionMsg"),autoFocus:!1}),yield O()}finally{m.value=!1}}))})}return(p,a)=>{const f=qe,S=ge,y=he,Q=He,X=Te,Y=fe,q=ve,Z=ye,ee=we,te=be;return ce((I(),L("div",null,[i("img",{src:e(H),title:"Logo",style:{width:"40%",margin:"10px auto","user-drag":"none","-webkit-user-select":"none","user-select":"none"}},null,8,We),o(te,{ref_key:"formRef",ref:D,class:"p-6",model:e(l),rules:e(d),"show-label":!1,"label-placement":"left","show-require-mark":!0,onKeypress:pe(E,["enter"])},{default:s(()=>[o(y,{label:"username",path:"username"},{default:s(()=>[o(S,{value:e(l).username,"onUpdate:value":a[0]||(a[0]=v=>e(l).username=v),size:"large",placeholder:e(t)("sys.login.accountPlaceholder"),disabled:e(m)},{prefix:s(()=>[o(f)]),_:1},8,["value","placeholder","disabled"])]),_:1}),o(y,{label:"password",path:"password"},{default:s(()=>[o(S,{value:e(l).password,"onUpdate:value":a[1]||(a[1]=v=>e(l).password=v),size:"large",type:"password","show-password-on":"click",placeholder:e(t)("sys.login.passwordPlaceholder"),disabled:e(m)},{prefix:s(()=>[o(Q)]),_:1},8,["value","placeholder","disabled"])]),_:1}),i("div",Qe,[e(C)?(I(),re(y,{key:0,label:"captcha",path:"captcha",style:{width:"100%"}},{default:s(()=>[i("div",Xe,[o(S,{value:e(l).captcha,"onUpdate:value":a[2]||(a[2]=v=>e(l).captcha=v),size:"large",maxlength:"5",type:"text",disabled:e(m),placeholder:e(t)("sys.login.captchaPlaceholder")},{prefix:s(()=>[o(X)]),_:1},8,["value","disabled","placeholder"])]),Ye,i("div",Ze,[o(q,{trigger:"hover"},{trigger:s(()=>[o(Y,{src:e(B),"preview-disabled":!0,style:ie(`background-color: ${e(N)}; height: 40px; border-radius: 3px`),onClick:P},null,8,["src","style"])]),default:s(()=>[i("span",null,R(e(t)("sys.login.captchaTips")),1)]),_:1})])]),_:1})):ue("",!0)]),o(ee,{justify:"space-between"},{default:s(()=>[o(y,{path:"rememberMe"},{default:s(()=>[o(Z,{checked:e($),"onUpdate:checked":a[3]||(a[3]=v=>de($)?$.value=v:null),size:"small",disabled:e(m)},{default:s(()=>[A(R(e(t)("sys.login.rememberMe")),1)]),_:1},8,["checked","disabled"])]),_:1}),o(y,{class:"text-right"},{default:s(()=>[o(q,{placement:"left",trigger:"hover",style:{"max-width":"200px"}},{trigger:s(()=>[o(e(F),{tag:"a",text:"",focusable:!1,size:"small"},{default:s(()=>[A(R(e(t)("sys.login.forgetPassword")),1)]),_:1})]),default:s(()=>[i("span",null,R(e(t)("sys.login.forgetPasswordTips")),1)]),_:1})]),_:1})]),_:1}),o(y,{"show-feedback":!1},{default:s(()=>[o(e(F),{type:"primary",size:"large",block:"",focusable:!1,loading:e(m),disabled:e(m),onClick:E},{default:s(()=>[A(R(e(t)("sys.login.loginButton")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model","rules"])],512)),[[le,e(k)]])}}}),lt=$e(et,[["__scopeId","data-v-6a2ffb8f"]]);export{lt as default};
