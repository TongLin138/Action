import{_ as P,a as q,b as E}from"./zoom-out-line-4b5ea308.js";import{c as K,_ as Q}from"./index-11f80ee5.js";import{_ as X}from"./history-2ee58d15.js";import{c as Y,a as Z}from"./index-b98e63e9.js";import{u as ee}from"./useAppInject-25d4ad8f.js";import{b as oe,a as ne}from"./file-1f2fda02.js";import V from"./loading-ab369df4.js";import{G as te,x as N,r as se,I as le,u as n,a6 as l,a7 as a,a8 as e,a9 as o,aN as z,aI as r,as as u,aJ as A,aD as L,aB as ae,am as re,aR as ie,by as ce,aC as _e,bS as ge,bj as ue,bM as pe,bN as fe,bC as me,bA as de,bB as ye}from"./vendor-339b2486.js";const he={style:{"vertical-align":"-4px"}},Be=te({__name:"viewHistory",setup(ve,{expose:W}){const{message:w}=Y(),{t:s}=Z(),{getIsMobile:R}=ee(),x=N(null),f=N(R.value?13:15),C=N(null),d=se({show:!1,loading:!0,log:""}),{show:y,loading:v,log:b}=le(d),j=async h=>{d.log="",d.show=!0;try{d.loading=!0,d.log=await U(h.logPath,h.running_status)}finally{d.loading=!1}},U=async(h,t)=>{try{const _=await oe({path:h});if(_.children&&_.children.length){_.children.sort((g,p)=>{const k=g.name.replace(".log","").replace(/-/g,"");return p.name.replace(".log","").replace(/-/g,"")-k});const i=t&&_.children[1]?_.children[1]:_.children[0];return await ne({path:i.path})}else w.warning(s("page.cron.viewHistory.noLatestMsg"))}catch{}return""},m=async h=>{switch(h){case"copyContent":K(d.log)?w.success(s("common.copyOk")):w.error(s("common.copyFail"));break;case"enlarge":f.value<20?f.value+=1:f.value===20&&w.info(s("page.log.enlargeMaxMsg"));break;case"narrow":f.value>12?f.value-=1:f.value===12&&w.info(s("page.log.narrowMinMsg"));break;case"bottom":const _=x.value?.$el?.clientHeight;C.value?.scrollTo({top:_,behavior:"smooth"});break}};return W({open:j}),(h,t)=>{const _=X,i=ae,$=Q,g=re,p=ie,k=P,I=q,H=E,M=ce,B=_e,D=ge,S=ue,T=pe,F=fe,G=me,J=de,O=ye;return n(R)?(l(),a(O,{key:1,show:n(y),"onUpdate:show":t[10]||(t[10]=c=>L(y)?y.value=c:null),height:"100vh",width:"100vw",placement:"right","auto-focus":!1,"mask-closable":!1},{default:e(()=>[o(J,{closable:"","header-style":"height: 60px; padding: 16px 12px","body-content-style":"padding: 4px 8px; overscroll-behavior: none","footer-style":"padding: 16px 24px"},{header:e(()=>[o(B,null,{default:e(()=>[o(i,{color:"var(--app-primary-color)"},{default:e(()=>[n(v)?(l(),a(V,{key:0,style:{"font-size":"24px"}})):(l(),a(_,{key:1,style:{"font-size":"24px","vertical-align":"0"}}))]),_:1}),u("span",he,r(n(s)("page.cron.table.history")),1),!n(v)&&n(b)?(l(),a(M,{key:0},{default:e(()=>[o(p,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(g,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[5]||(t[5]=c=>m("copyContent"))},{icon:e(()=>[o(i,{size:16},{default:e(()=>[o($,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,r(n(s)("common.copyBtn")),1)]),_:1}),o(p,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(g,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[6]||(t[6]=c=>m("narrow"))},{icon:e(()=>[o(i,{size:18},{default:e(()=>[o(k,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,r(n(s)("page.cron.viewHistory.narrowButtonTips")),1)]),_:1}),o(p,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(g,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[7]||(t[7]=c=>m("enlarge"))},{icon:e(()=>[o(i,{size:18},{default:e(()=>[o(I,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,r(n(s)("page.cron.viewHistory.enlargeButtonTips")),1)]),_:1}),o(p,{"show-arrow":!1,trigger:"click"},{trigger:e(()=>[o(g,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[8]||(t[8]=c=>m("bottom"))},{icon:e(()=>[o(i,{size:18},{default:e(()=>[o(H,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,r(n(s)("file.bottom.button")),1)]),_:1})]),_:1})):A("",!0)]),_:1})]),default:e(()=>[n(v)?(l(),a(D,{key:0,text:"",repeat:30,height:"16px"})):(l(),a(F,{key:1,ref_key:"logInstWrapRef",ref:C,"native-scrollbar":!0,style:{width:"100%",height:"100%","background-color":"transparent"}},{default:e(()=>[u("div",null,[n(b)?(l(),a(T,{key:1,ref_key:"logInstRef",ref:x,log:n(b),"line-height":1.5,"font-size":n(f),language:"naive-log",style:{width:"100%",height:"100%"}},null,8,["log","font-size"])):(l(),a(S,{key:0},{default:e(()=>[z(r(n(s)("common.noData")),1)]),_:1}))])]),_:1},512))]),footer:e(()=>[o(B,null,{default:e(()=>[o(g,{type:"primary",focusable:!1,onClick:t[9]||(t[9]=c=>y.value=!1)},{default:e(()=>[z(r(n(s)("component.modal.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])):(l(),a(G,{key:0,show:n(y),"onUpdate:show":t[4]||(t[4]=c=>L(y)?y.value=c:null),preset:"dialog","auto-focus":!1,style:{width:"600px"}},{icon:e(()=>[o(i,null,{default:e(()=>[n(v)?(l(),a(V,{key:0,style:{"font-size":"24px"}})):(l(),a(_,{key:1,style:{"font-size":"24px","vertical-align":"0"}}))]),_:1})]),header:e(()=>[o(B,null,{default:e(()=>[z(r(n(s)("page.cron.table.history"))+" ",1),!n(v)&&n(b)?(l(),a(M,{key:0},{default:e(()=>[o(p,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(g,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[0]||(t[0]=c=>m("copyContent"))},{icon:e(()=>[o(i,{size:16},{default:e(()=>[o($,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,r(n(s)("common.copyBtn")),1)]),_:1}),o(p,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(g,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[1]||(t[1]=c=>m("narrow"))},{icon:e(()=>[o(i,{size:18},{default:e(()=>[o(k,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,r(n(s)("page.cron.viewHistory.narrowButtonTips")),1)]),_:1}),o(p,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(g,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[2]||(t[2]=c=>m("enlarge"))},{icon:e(()=>[o(i,{size:18},{default:e(()=>[o(I,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,r(n(s)("page.cron.viewHistory.enlargeButtonTips")),1)]),_:1}),o(p,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(g,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[3]||(t[3]=c=>m("bottom"))},{icon:e(()=>[o(i,{size:18},{default:e(()=>[o(H,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,r(n(s)("file.bottom.button")),1)]),_:1})]),_:1})):A("",!0)]),_:1})]),default:e(()=>[n(v)?(l(),a(D,{key:0,text:"",repeat:27,height:"16px"})):(l(),a(F,{key:1,ref_key:"logInstWrapRef",ref:C,"native-scrollbar":!1,style:{"padding-top":"1em",width:"100%",height:"600px","background-color":"transparent"}},{default:e(()=>[u("div",null,[n(b)?(l(),a(T,{key:1,ref_key:"logInstRef",ref:x,log:n(b),"line-height":1.5,"font-size":n(f),language:"naive-log",style:{width:"100%",height:"100%"}},null,8,["log","font-size"])):(l(),a(S,{key:0},{default:e(()=>[z(r(n(s)("common.noData")),1)]),_:1}))])]),_:1},512))]),_:1},8,["show"]))}}});export{Be as _};
