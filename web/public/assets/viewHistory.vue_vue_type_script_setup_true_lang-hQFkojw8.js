var I=(M,N,m)=>new Promise((s,z)=>{var x=r=>{try{v(m.next(r))}catch(p){z(p)}},d=r=>{try{v(m.throw(r))}catch(p){z(p)}},v=r=>r.done?s(r.value):Promise.resolve(r.value).then(x,d);v((m=m.apply(M,N)).next())});import{_ as q,a as E,b as Q}from"./zoom-out-line-YzbDVvs9.js";import{_ as X}from"./content-copy-zEcwTW-4.js";import{_ as Y}from"./history-TAWpJ1PJ.js";import{G as Z,x as D,r as ee,I as oe,u as n,a6 as l,a7 as a,a8 as e,a9 as o,aN as B,aH as g,as as f,aJ as W,aD as O,bK as ne,aB as te,am as se,aR as le,by as ae,aC as re,bV as ie,bh as ce,bN as _e,bO as ge,bC as ue,bA as pe,bB as fe}from"./vendor-tP7MJkVm.js";import{c as me,a as de}from"./index-YWZYq8iG.js";import{u as ye}from"./useAppInject-BuU8lio7.js";import{b as he,a as ve}from"./file-myfSNQEg.js";import U from"./loading-QxtvXiBZ.js";const be={style:{"vertical-align":"-4px"}},Re=Z({__name:"viewHistory",setup(M,{expose:N}){const{message:m}=me(),{t:s}=de(),{getIsMobile:z}=ye(),x=D(null),d=D(z.value?13:15),v=D(null),r=ee({show:!1,loading:!0,log:""}),{show:p,loading:w,log:k}=oe(r),j=b=>I(this,null,function*(){r.log="",r.show=!0;try{r.loading=!0,r.log=yield G(b.logPath,b.running_status)}finally{r.loading=!1}}),G=(b,t)=>I(this,null,function*(){try{const c=yield he({path:b});if(c.children&&c.children.length){c.children.sort((_,y)=>{const $=_.name.replace(".log","").replace(/-/g,"");return y.name.replace(".log","").replace(/-/g,"")-$});const i=t&&c.children[1]?c.children[1]:c.children[0];return yield ve({path:i.path})}else m.warning(s("page.cron.viewHistory.noLatestMsg"))}catch(c){}return""}),h=b=>I(this,null,function*(){var t,c,i;switch(b){case"copyContent":ne(r.log)?m.success(s("common.copyOk")):m.error(s("common.copyFail"));break;case"enlarge":d.value<20?d.value+=1:d.value===20&&m.info(s("page.log.enlargeMaxMsg"));break;case"narrow":d.value>12?d.value-=1:d.value===12&&m.info(s("page.log.narrowMinMsg"));break;case"bottom":const _=(c=(t=x.value)==null?void 0:t.$el)==null?void 0:c.clientHeight;(i=v.value)==null||i.scrollTo({top:_,behavior:"smooth"});break}});return N({open:j}),(b,t)=>{const c=Y,i=te,C=X,_=se,y=le,$=q,R=E,T=Q,S=ae,H=re,V=ie,F=ce,A=_e,L=ge,J=ue,K=pe,P=fe;return n(z)?(l(),a(P,{key:1,show:n(p),"onUpdate:show":t[10]||(t[10]=u=>O(p)?p.value=u:null),height:"100vh",width:"100vw",placement:"right","auto-focus":!1,"mask-closable":!1},{default:e(()=>[o(K,{closable:"","header-style":"height: 60px; padding: 16px 12px","body-content-style":"padding: 4px 8px; overscroll-behavior: none","footer-style":"padding: 16px 24px"},{header:e(()=>[o(H,null,{default:e(()=>[o(i,{color:"var(--app-primary-color)"},{default:e(()=>[n(w)?(l(),a(U,{key:0,style:{"font-size":"24px"}})):(l(),a(c,{key:1,style:{"font-size":"24px","vertical-align":"0"}}))]),_:1}),f("span",be,g(n(s)("page.cron.table.history")),1),!n(w)&&n(k)?(l(),a(S,{key:0},{default:e(()=>[o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(_,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[5]||(t[5]=u=>h("copyContent"))},{icon:e(()=>[o(i,{size:16},{default:e(()=>[o(C,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[f("span",null,g(n(s)("common.copyBtn")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(_,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[6]||(t[6]=u=>h("narrow"))},{icon:e(()=>[o(i,{size:18},{default:e(()=>[o($,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[f("span",null,g(n(s)("page.cron.viewHistory.narrowButtonTips")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(_,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[7]||(t[7]=u=>h("enlarge"))},{icon:e(()=>[o(i,{size:18},{default:e(()=>[o(R,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[f("span",null,g(n(s)("page.cron.viewHistory.enlargeButtonTips")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"click"},{trigger:e(()=>[o(_,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[8]||(t[8]=u=>h("bottom"))},{icon:e(()=>[o(i,{size:18},{default:e(()=>[o(T,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[f("span",null,g(n(s)("file.bottom.button")),1)]),_:1})]),_:1})):W("",!0)]),_:1})]),default:e(()=>[n(w)?(l(),a(V,{key:0,text:"",repeat:30,height:"16px"})):(l(),a(L,{key:1,ref_key:"logInstWrapRef",ref:v,"native-scrollbar":!0,style:{width:"100%",height:"100%","background-color":"transparent"}},{default:e(()=>[f("div",null,[n(k)?(l(),a(A,{key:1,ref_key:"logInstRef",ref:x,log:n(k),"line-height":1.5,"font-size":n(d),language:"naive-log",style:{width:"100%",height:"100%"}},null,8,["log","font-size"])):(l(),a(F,{key:0},{default:e(()=>[B(g(n(s)("common.noData")),1)]),_:1}))])]),_:1},512))]),footer:e(()=>[o(H,null,{default:e(()=>[o(_,{type:"primary",focusable:!1,onClick:t[9]||(t[9]=u=>p.value=!1)},{default:e(()=>[B(g(n(s)("component.modal.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])):(l(),a(J,{key:0,show:n(p),"onUpdate:show":t[4]||(t[4]=u=>O(p)?p.value=u:null),preset:"dialog","auto-focus":!1,style:{width:"600px"}},{icon:e(()=>[o(i,null,{default:e(()=>[n(w)?(l(),a(U,{key:0,style:{"font-size":"24px"}})):(l(),a(c,{key:1,style:{"font-size":"24px","vertical-align":"0"}}))]),_:1})]),header:e(()=>[o(H,null,{default:e(()=>[B(g(n(s)("page.cron.table.history"))+" ",1),!n(w)&&n(k)?(l(),a(S,{key:0},{default:e(()=>[o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(_,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[0]||(t[0]=u=>h("copyContent"))},{icon:e(()=>[o(i,{size:16},{default:e(()=>[o(C,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[f("span",null,g(n(s)("common.copyBtn")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(_,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[1]||(t[1]=u=>h("narrow"))},{icon:e(()=>[o(i,{size:18},{default:e(()=>[o($,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[f("span",null,g(n(s)("page.cron.viewHistory.narrowButtonTips")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(_,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[2]||(t[2]=u=>h("enlarge"))},{icon:e(()=>[o(i,{size:18},{default:e(()=>[o(R,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[f("span",null,g(n(s)("page.cron.viewHistory.enlargeButtonTips")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(_,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[3]||(t[3]=u=>h("bottom"))},{icon:e(()=>[o(i,{size:18},{default:e(()=>[o(T,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[f("span",null,g(n(s)("file.bottom.button")),1)]),_:1})]),_:1})):W("",!0)]),_:1})]),default:e(()=>[n(w)?(l(),a(V,{key:0,text:"",repeat:27,height:"16px"})):(l(),a(L,{key:1,ref_key:"logInstWrapRef",ref:v,"native-scrollbar":!1,style:{"padding-top":"1em",width:"100%",height:"600px","background-color":"transparent"}},{default:e(()=>[f("div",null,[n(k)?(l(),a(A,{key:1,ref_key:"logInstRef",ref:x,log:n(k),"line-height":1.5,"font-size":n(d),language:"naive-log",style:{width:"100%",height:"100%"}},null,8,["log","font-size"])):(l(),a(F,{key:0},{default:e(()=>[B(g(n(s)("common.noData")),1)]),_:1}))])]),_:1},512))]),_:1},8,["show"]))}}});export{Re as _};
