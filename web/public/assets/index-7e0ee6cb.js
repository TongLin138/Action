import{G as X,x as l,C as Y,aI as Z,a6 as f,a7 as _,a8 as t,ac as o,u as e,aE as ee,aK as ae,aG as F,aC as T,aD as L,aL as te,aJ as m,al as i,aM as ne,am as oe,aQ as se,aN as le,aR as ie,aH as re}from"./vendor-4af6c1c4.js";import{_ as ue}from"./PageWrapper.vue_vue_type_style_index_0_lang-65c759c0.js";import{b as ce,c as pe,L as de}from"./index-46f58af9.js";import{f as W,a as fe,_ as _e,b as me,c as ge,d as ve}from"./folderOpen-27d36a47.js";import{_ as ye,a as he,f as we}from"./index-fa374e31.js";import{_ as be}from"./map-outline-01776ae4.js";import{u as ke}from"./useAppInject-bb3d2acd.js";import{u as Ce}from"./useTransition-76447030.js";import{F as xe}from"./fileTreeEnum-8c192873.js";import{s as Ne,g as Te,a as Ee}from"./file-f0c38022.js";import{f as Ie}from"./folderDisable-c8974721.js";import"./sharp-arrow-back-ios-06827d69.js";import"./useDesign-d383e8f5.js";import"./propTypes-8a448afd.js";const Ae=X({__name:"index",setup(Se){const{getIsMobile:g}=ke(),{t:r}=ce(),{message:E}=pe(),O=l("fade-slide");Ce(O);const w=l([]),p=l({}),I=l(),b=l(""),D=l(""),d=l(""),k=l(!g.value),C=l(g.value?"on":"off"),S=l(!1),x=l(!0),$=l(!1),N=async a=>{switch(a){case"wordWrap":C.value=C.value==="on"?"off":"on";break;case"minimap":k.value=!k.value;break;case"showEditorShortcutsInfo":I.value.showShortCuts=!0;break;case"save":S.value=!0;const n=e(I).getValue();try{await Ne({content:n,path:p.value.path}),E.success(r("editor.main.savedSuccess"))}finally{S.value=!1,await z()}break}},z=async()=>{$.value=!0;const a=await Te({type:xe.CONFIG});w.value=j(a),$.value=!1},j=a=>{const n=u=>{u.length&&u.forEach(s=>{if(s.type===0)Object.assign(s,{key:s.path,label:s.title,disabled:!0,prefix:()=>i(m,null,{default:()=>i(W)})}),n(s.children),s.children.length||(Object.assign(s,{children:null,disabled:!0}),s.prefix=()=>i(m,null,{default:()=>i(Ie)}));else{const c=s.name;if(c){const v=c.substring(c.lastIndexOf(".")+1),y=we[v]||{};Object.assign(s,{key:s.path,label:c,language:y.language||"plaintext",disabled:y.disabled||!1,prefix:()=>i(m,null,{default:()=>i(y.icon||ve)})})}}})};return n(a),a},B=(a,n,u)=>{if(u.node)switch(u.action){case"expand":u.node.prefix=()=>i(m,null,{default:()=>i(fe)});break;case"collapse":u.node.prefix=()=>i(m,null,{default:()=>i(W)});break}},V=({option:a})=>({async onClick(){!a.children&&!a.disabled&&(p.value=a,await M(a))}});async function M(a){D.value=a.language,x.value=!0;const n=await Ee({path:encodeURI(a.key)});x.value=!1,n?b.value=n:(b.value="",E.info(r("page.editConfig.fileContentIsEmptyMsg")))}function R(){if(w.value.length){for(const a of w.value)if(a.type===1&&a.name==="config.sh")return a}return{}}return Y(d,a=>{a||(p.value={},b.value="")}),Z(async()=>{await z(),p.value=R(),p.value.path?(d.value=p.value.path,await M(p.value)):E.error(r("page.editConfig.mainConfigNotExistsMsg"),{keepAliveOnHover:!0}),x.value=!1}),(a,n)=>{const u=ne,s=ye,c=oe,v=se,y=be,q=_e,P=le,A=he,G=me,H=ge,U=ie,J=de,K=re,Q=ue;return f(),_(Q,{ref:"pageWrapper","content-full":!0},{title:t(()=>[o(u,{value:e(d),"onUpdate:value":n[0]||(n[0]=h=>ee(d)?d.value=h:null),size:"small",class:"min-w-170px",loading:e($),"consistent-menu-width":!1,clearable:"","show-path":!0,separator:"/",placeholder:e(r)("page.editConfig.selectConfigFilePlaceholder"),options:e(w),"node-props":V,"on-update:expanded-keys":B},null,8,["value","loading","placeholder","options"])]),extra:t(()=>[e(d)?(f(),_(ae,{key:0,name:e(O),mode:"out-in",appear:""},{default:t(()=>[o(P,{style:{width:"fix-content"}},{default:t(()=>[o(P,{style:{gap:"0"}},{default:t(()=>[e(g)?L("",!0):(f(),_(v,{key:0,placement:"bottom",trigger:"hover",delay:500},{trigger:t(()=>[o(c,{strong:"",quaternary:"",size:"small",type:"tertiary",focusable:!1,onClick:n[1]||(n[1]=h=>N("showEditorShortcutsInfo"))},{default:t(()=>[o(s)]),_:1})]),default:t(()=>[F("span",null,T(e(r)("editor.switch.shortcutsTips")),1)]),_:1})),e(g)?(f(),_(v,{key:1,placement:"bottom",trigger:"hover",delay:500},{trigger:t(()=>[o(c,{strong:"",quaternary:"",type:e(k)?"primary":"tertiary",size:"small",focusable:!1,onClick:n[2]||(n[2]=h=>N("minimap"))},{default:t(()=>[o(y)]),_:1},8,["type"])]),default:t(()=>[F("span",null,T(e(r)("editor.switch.minimapTips")),1)]),_:1})):L("",!0),o(v,{placement:"bottom",trigger:"hover",delay:500},{trigger:t(()=>[o(c,{strong:"",quaternary:"",type:e(C)==="on"?"primary":"tertiary",size:"small",focusable:!1,onClick:n[3]||(n[3]=h=>N("wordWrap"))},{default:t(()=>[o(q)]),_:1},8,["type"])]),default:t(()=>[F("span",null,T(e(r)("editor.switch.wordWrapTips")),1)]),_:1})]),_:1}),o(c,{strong:"",type:"primary",size:"small",loading:e(S),focusable:!1,onClick:n[4]||(n[4]=h=>N("save"))},{icon:t(()=>[o(A)]),default:t(()=>[te(" "+T(e(r)("editor.main.saveButton")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["name"])):L("",!0)]),default:t(()=>[o(K,{bordered:!e(g),style:{height:"100%","word-break":"unset"},"content-style":"padding: 0"},{default:t(()=>[e(d)?(f(),_(G,{key:0,ref_key:"editor",ref:I,value:e(b),language:e(D),"word-wrap":e(C),minimap:e(k)},null,8,["value","language","word-wrap","minimap"])):(f(),_(U,{key:1,class:"min-h-200px flex-jc-ac h-full",size:"huge",description:e(r)("common.selectFileEmptyDesc")},{icon:t(()=>[o(e(m),null,{default:t(()=>[o(H)]),_:1})]),_:1},8,["description"])),o(J,{show:e(x)},null,8,["show"])]),_:1},8,["bordered"])]),_:1},512)}}});export{Ae as default};
