var I=(T,B,m)=>new Promise((s,z)=>{var x=r=>{try{h(m.next(r))}catch(u){z(u)}},d=r=>{try{h(m.throw(r))}catch(u){z(u)}},h=r=>r.done?s(r.value):Promise.resolve(r.value).then(x,d);h((m=m.apply(T,B)).next())});import{_ as J,a as K,b as Q}from"./zoom-out-line-2c41534b.js";import{c as X,_ as Y}from"./index-f66bd7de.js";import{_ as Z}from"./history-db6bdbba.js";import{d as ee,z as oe,b as ne,r as M,a4 as te,a6 as se,e as n,o as l,c as a,w as e,a as o,E as N,t as p,v as f,q as A,i as U,f as le,aI as ae}from"./index-797c0a85.js";import{u as re}from"./useAppInject-e4ee4e96.js";import{b as ie,a as _e}from"./file-6dbc6db3.js";import j from"./loading-bc2dff0c.js";import{_ as ce}from"./ButtonGroup-4b5594ea.js";import{_ as pe}from"./LayoutContent-5bfc63ec.js";import{N as ge}from"./Icon-abc31adc.js";import{a as ue}from"./Tooltip-271e10cc.js";import{N as fe}from"./Space-3cb079f3.js";import{_ as me}from"./Skeleton-e990348c.js";import{_ as de}from"./text-116532e9.js";import{_ as ye}from"./Log-af750a5b.js";import{_ as ve,a as he}from"./DrawerContent-784d0172.js";const we={style:{"vertical-align":"-4px"}},Le=ee({__name:"viewHistory",setup(T,{expose:B}){const{message:m}=oe(),{t:s}=ne(),{getIsMobile:z}=re(),x=M(null),d=M(z.value?13:15),h=M(null),r=te({show:!1,loading:!0,log:""}),{show:u,loading:b,log:k}=se(r),q=w=>I(this,null,function*(){r.log="",r.show=!0;try{r.loading=!0,r.log=yield E(w.logPath,w.running_status)}finally{r.loading=!1}}),E=(w,t)=>I(this,null,function*(){try{const _=yield ie({path:w});if(_.children&&_.children.length){_.children.sort((c,y)=>{const $=c.name.replace(".log","").replace(/-/g,"");return y.name.replace(".log","").replace(/-/g,"")-$});const i=t&&_.children[1]?_.children[1]:_.children[0];return yield _e({path:i.path})}else m.warning(s("page.cron.viewHistory.noLatestMsg"))}catch(_){}return""}),v=w=>I(this,null,function*(){var t,_,i;switch(w){case"copyContent":X(r.log)?m.success(s("common.copyOk")):m.error(s("common.copyFail"));break;case"enlarge":d.value<20?d.value+=1:d.value===20&&m.info(s("page.log.enlargeMaxMsg"));break;case"narrow":d.value>12?d.value-=1:d.value===12&&m.info(s("page.log.narrowMinMsg"));break;case"bottom":const c=(_=(t=x.value)==null?void 0:t.$el)==null?void 0:_.clientHeight;(i=h.value)==null||i.scrollTo({top:c,behavior:"smooth"});break}});return B({open:q}),(w,t)=>{const _=Z,i=ge,C=Y,c=le,y=ue,$=J,R=K,D=Q,S=ce,H=fe,F=me,V=de,L=ye,W=pe,O=ae,P=ve,G=he;return n(z)?(l(),a(G,{key:1,show:n(u),"onUpdate:show":t[10]||(t[10]=g=>U(u)?u.value=g:null),height:"100vh",width:"100vw",placement:"right","auto-focus":!1,"mask-closable":!1},{default:e(()=>[o(P,{closable:"","header-style":"height: 60px; padding: 16px 12px","body-content-style":"padding: 4px 8px; overscroll-behavior: none","footer-style":"padding: 16px 24px"},{header:e(()=>[o(H,null,{default:e(()=>[o(i,{color:"var(--app-primary-color)"},{default:e(()=>[n(b)?(l(),a(j,{key:0,style:{"font-size":"24px"}})):(l(),a(_,{key:1,style:{"font-size":"24px","vertical-align":"0"}}))]),_:1}),f("span",we,p(n(s)("page.cron.table.history")),1),!n(b)&&n(k)?(l(),a(S,{key:0},{default:e(()=>[o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(c,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[5]||(t[5]=g=>v("copyContent"))},{icon:e(()=>[o(i,{size:16},{default:e(()=>[o(C,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[f("span",null,p(n(s)("common.copyBtn")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(c,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[6]||(t[6]=g=>v("narrow"))},{icon:e(()=>[o(i,{size:18},{default:e(()=>[o($,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[f("span",null,p(n(s)("page.cron.viewHistory.narrowButtonTips")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(c,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[7]||(t[7]=g=>v("enlarge"))},{icon:e(()=>[o(i,{size:18},{default:e(()=>[o(R,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[f("span",null,p(n(s)("page.cron.viewHistory.enlargeButtonTips")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"click"},{trigger:e(()=>[o(c,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[8]||(t[8]=g=>v("bottom"))},{icon:e(()=>[o(i,{size:18},{default:e(()=>[o(D,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[f("span",null,p(n(s)("file.bottom.button")),1)]),_:1})]),_:1})):A("",!0)]),_:1})]),default:e(()=>[n(b)?(l(),a(F,{key:0,text:"",repeat:30,height:"16px"})):(l(),a(W,{key:1,ref_key:"logInstWrapRef",ref:h,"native-scrollbar":!0,style:{width:"100%",height:"100%","background-color":"transparent"}},{default:e(()=>[f("div",null,[n(k)?(l(),a(L,{key:1,ref_key:"logInstRef",ref:x,log:n(k),"line-height":1.5,"font-size":n(d),language:"naive-log",style:{width:"100%",height:"100%"}},null,8,["log","font-size"])):(l(),a(V,{key:0},{default:e(()=>[N(p(n(s)("common.noData")),1)]),_:1}))])]),_:1},512))]),footer:e(()=>[o(H,null,{default:e(()=>[o(c,{type:"primary",focusable:!1,onClick:t[9]||(t[9]=g=>u.value=!1)},{default:e(()=>[N(p(n(s)("component.modal.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])):(l(),a(O,{key:0,show:n(u),"onUpdate:show":t[4]||(t[4]=g=>U(u)?u.value=g:null),preset:"dialog","auto-focus":!1,style:{width:"600px"}},{icon:e(()=>[o(i,null,{default:e(()=>[n(b)?(l(),a(j,{key:0,style:{"font-size":"24px"}})):(l(),a(_,{key:1,style:{"font-size":"24px","vertical-align":"0"}}))]),_:1})]),header:e(()=>[o(H,null,{default:e(()=>[N(p(n(s)("page.cron.table.history"))+" ",1),!n(b)&&n(k)?(l(),a(S,{key:0},{default:e(()=>[o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(c,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[0]||(t[0]=g=>v("copyContent"))},{icon:e(()=>[o(i,{size:16},{default:e(()=>[o(C,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[f("span",null,p(n(s)("common.copyBtn")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(c,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[1]||(t[1]=g=>v("narrow"))},{icon:e(()=>[o(i,{size:18},{default:e(()=>[o($,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[f("span",null,p(n(s)("page.cron.viewHistory.narrowButtonTips")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(c,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[2]||(t[2]=g=>v("enlarge"))},{icon:e(()=>[o(i,{size:18},{default:e(()=>[o(R,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[f("span",null,p(n(s)("page.cron.viewHistory.enlargeButtonTips")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"hover"},{trigger:e(()=>[o(c,{strong:"",secondary:"",size:"small",focusable:!1,onClick:t[3]||(t[3]=g=>v("bottom"))},{icon:e(()=>[o(i,{size:18},{default:e(()=>[o(D,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[f("span",null,p(n(s)("file.bottom.button")),1)]),_:1})]),_:1})):A("",!0)]),_:1})]),default:e(()=>[n(b)?(l(),a(F,{key:0,text:"",repeat:27,height:"16px"})):(l(),a(W,{key:1,ref_key:"logInstWrapRef",ref:h,"native-scrollbar":!1,style:{"padding-top":"1em",width:"100%",height:"600px","background-color":"transparent"}},{default:e(()=>[f("div",null,[n(k)?(l(),a(L,{key:1,ref_key:"logInstRef",ref:x,log:n(k),"line-height":1.5,"font-size":n(d),language:"naive-log",style:{width:"100%",height:"100%"}},null,8,["log","font-size"])):(l(),a(V,{key:0},{default:e(()=>[N(p(n(s)("common.noData")),1)]),_:1}))])]),_:1},512))]),_:1},8,["show"]))}}});export{Le as _};
